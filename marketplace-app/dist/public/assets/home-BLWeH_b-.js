import{a as E,b as U,j as e,d as k,L as c,r as m,O as A,B as C}from"./index-FVTY5sKH.js";import{u as N}from"./useQuery-DsZx8GVA.js";import{u as B,S as w}from"./show-card-DdIkBK1N.js";import{G as R}from"./globe-DqUT5fHj.js";import{P as T}from"./product-card-Pdo5-SPt.js";import{A as K}from"./auction-card-D137QEZZ.js";import{C as q}from"./chevron-right-HRo85rGP.js";import"./avatar-BgbrThQo.js";import"./format-D46ChU1D.js";import"./isTomorrow-B3a_VsBR.js";import"./card-CF4CqaN2.js";import"./badge-BTf7a5Ku.js";import"./package-dXPzRBiL.js";import"./clock-BQ-aHkQg.js";import"./circle-check-big-btKq8keq.js";function z({selectedCategory:u,onCategoryChange:a,categories:n=[]}){const{user:i}=E(),{settings:d}=U(),x=(i==null?void 0:i.userName)||(i==null?void 0:i.firstName)||"User",h=new Date().getFullYear();return e.jsxs("aside",{className:"hidden lg:flex lg:flex-col w-64 bg-background border-r border-border/40 h-full flex-shrink-0","data-testid":"sidebar-marketplace",children:[e.jsx("div",{className:"px-4 pt-8 pb-6",children:e.jsxs("h2",{className:"text-[28px] leading-tight font-bold text-foreground","data-testid":"text-greeting",children:["Hello ",x,"!"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4",children:[e.jsx("button",{onClick:()=>a("For You"),className:k("text-left py-2.5 text-base transition-colors w-full",u==="For You"?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":"category-for-you",children:"For You"}),n.map(r=>e.jsx("button",{onClick:()=>a(r.name),className:k("text-left py-2.5 text-base transition-colors w-full",u===r.name?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":`category-${r._id}`,children:r.name},r._id))]}),e.jsxs("div",{className:"px-4 pb-8 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-[13px] text-muted-foreground",children:[e.jsx(c,{href:"/privacy-policy","data-testid":"link-privacy",children:e.jsx("span",{className:"cursor-pointer",children:"Privacy"})}),e.jsx(c,{href:"/terms-of-service","data-testid":"link-terms",children:e.jsx("span",{className:"cursor-pointer",children:"Terms"})}),e.jsx(c,{href:"/contact","data-testid":"link-contact",children:e.jsx("span",{className:"cursor-pointer",children:"Contact"})}),e.jsx(c,{href:"/faq","data-testid":"link-faq",children:e.jsx("span",{className:"cursor-pointer",children:"FAQ"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[13px] text-muted-foreground pt-2",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{"data-testid":"text-language",children:"British English"})]}),e.jsxs("div",{className:"text-[13px] text-muted-foreground pt-1",children:["Â© ",h," ",d.app_name," Inc."]})]})]})}function ie(){var L;const{settings:u}=U(),{user:a}=E(),[n,i]=m.useState("For You");A("Live Shows");const{data:d}=N({queryKey:["/api/categories"],queryFn:()=>fetch("/api/categories").then(s=>s.json())}),x=(d==null?void 0:d.categories)||[],h=[{id:"for-you",label:"For You",categoryId:null},...x.map(s=>({id:s._id,label:s.name,categoryId:s._id}))],r=(a==null?void 0:a._id)||(a==null?void 0:a.id),p=h.find(s=>s.label===n),{data:f}=N({queryKey:["/api/products","trending","buy_now"],queryFn:async()=>{const s=new URLSearchParams({saletype:"buy_now",status:"active",limit:"10",sortBy:"views"});return(await fetch(`/api/products?${s.toString()}`)).json()}}),{data:j}=N({queryKey:["/api/products","trending","auction"],queryFn:async()=>{const s=new URLSearchParams({saletype:"auction",status:"active",limit:"10",sortBy:"views",featured:"true",type:"scheduled"});return(await fetch(`/api/products?${s.toString()}`)).json()}}),v=(f==null?void 0:f.products)||[],P=(j==null?void 0:j.products)||[],{data:b,fetchNextPage:S,hasNextPage:F,isFetchingNextPage:y,isLoading:$,refetch:g}=B({queryKey:["/api/rooms",n],queryFn:async({pageParam:s=1})=>{const o=[`page=${s}`,"limit=15",`category=${(p==null?void 0:p.categoryId)||"all"}`,"userid=",`currentUserId=${r||""}`,"title=","status=active"].join("&");return(await fetch(`/api/rooms?${o}`)).json()},getNextPageParam:(s,t)=>{const o=t.length,_=s.totalDoc||0,Y=Math.max(s.limits||20,1),M=Math.ceil(_/Y);return o<M?o+1:void 0},initialPageParam:1});m.useEffect(()=>{const s=()=>{document.hidden||(console.log("ðŸ“± Page visible - refreshing shows..."),g())},t=()=>{console.log("ðŸ“± Window focused - refreshing shows..."),g()};return document.addEventListener("visibilitychange",s),window.addEventListener("focus",t),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("focus",t)}},[g]),m.useEffect(()=>{console.log("ðŸ“± Homepage mounted - refreshing shows..."),g()},[]);const l=((L=b==null?void 0:b.pages)==null?void 0:L.flatMap(s=>s.rooms||[]))||[],I=m.useRef(null);return m.useEffect(()=>{const s=new IntersectionObserver(o=>{o[0].isIntersecting&&F&&!y&&S()},{threshold:0,rootMargin:"100px"}),t=I.current;return t&&s.observe(t),()=>{t&&s.unobserve(t)}},[F,y,S]),e.jsxs("div",{className:"flex flex-col h-screen bg-background","data-testid":"page-marketplace",children:[e.jsx("div",{className:"lg:hidden bg-white dark:bg-background sticky top-0 z-10 border-b border-border/50",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide","data-testid":"tabs-container-mobile",children:h.map(s=>e.jsxs("button",{onClick:()=>i(s.label),className:k("px-3 py-3.5 text-sm whitespace-nowrap flex-shrink-0 relative transition-colors",n===s.label?"text-primary font-semibold":"text-foreground font-normal"),"data-testid":`tab-${s.id}`,children:[s.label,n===s.label&&e.jsx("div",{className:"absolute bottom-0 left-3 right-3 h-0.5 bg-foreground dark:bg-primary rounded-full"})]},s.id))})}),e.jsx("div",{className:"flex flex-1 overflow-hidden h-full justify-center",children:e.jsxs("div",{className:"flex w-full lg:w-[90%] h-full",children:[e.jsx(z,{selectedCategory:n,onCategoryChange:i,categories:x}),e.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide bg-white dark:bg-background w-full h-full",children:e.jsx("div",{className:"w-full px-2 py-3 lg:p-6 space-y-6",children:$?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading shows..."})}):e.jsxs(e.Fragment,{children:[l.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Live Shows"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4","data-testid":"grid-giveaways",children:l.slice(0,12).map(s=>e.jsx(w,{show:s,currentUserId:r||"",variant:"grid"},s._id||s.id))})]}),v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Trending Products"}),e.jsx(c,{href:"/trending/products",children:e.jsxs(C,{variant:"ghost",size:"sm",className:"text-primary",children:["See all ",e.jsx(q,{className:"h-4 w-4 ml-1"})]})})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide pb-2",children:v.map(s=>e.jsx(T,{product:s,layout:"carousel"},s._id||s.id))})]}),l.slice(12,24).length>0&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4",children:l.slice(12,24).map(s=>e.jsx(w,{show:s,currentUserId:r||"",variant:"grid"},s._id||s.id))}),P.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Trending Auctions"}),e.jsx(c,{href:"/deals",children:e.jsxs(C,{variant:"ghost",size:"sm",className:"text-primary",children:["See all ",e.jsx(q,{className:"h-4 w-4 ml-1"})]})})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide pb-2",children:P.map(s=>e.jsx(K,{auction:s,layout:"carousel"},s._id||s.id))})]}),l.length===0&&v.length===0&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No content available at the moment"})}),l.slice(24).length>0&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4",children:l.slice(24).map(s=>e.jsx(w,{show:s,currentUserId:r||"",variant:"grid"},s._id||s.id))}),e.jsx("div",{ref:I,className:"h-20 flex items-center justify-center",children:y&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading more shows..."})})]})})})]})})]})}export{ie as default};
