import{c as J,f as W,u as X,r as u,a as Z,j as t,B as d,I as ee,q as l,n as E}from"./index-FVTY5sKH.js";import{u as F}from"./useQuery-DsZx8GVA.js";import{u as q}from"./useMutation-DKG1zDtN.js";import{T as te,a as se,b as Q,c as z}from"./tabs-BcVWc8Zy.js";import{S as ae,a as ie,b as re,c as oe,d as L}from"./select-D3ZFUKhx.js";import{P as M}from"./plus-CFqimBvi.js";import{S as ne}from"./search-zDcbIzzp.js";import{V as I}from"./video-DvAeHB0x.js";import{C as le}from"./chevron-left-CnSIvoVj.js";import{C as de}from"./chevron-right-HRo85rGP.js";import{f as ce}from"./format-D46ChU1D.js";import"./index-CoWBA0E_.js";import"./index-BaZiuLT8.js";import"./index-BdQq_4o_.js";import"./index-Cbw5mxKQ.js";import"./chevron-down-BD1mluAZ.js";import"./check-DWjWNqF1.js";import"./chevron-up-D8QnUA5s.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=J("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function $e(){const{toast:p}=W(),[,g]=X(),[j,R]=u.useState("upcoming"),[r,m]=u.useState(1),{user:s}=Z(),[f,w]=u.useState(""),[N,S]=u.useState(""),[h,C]=u.useState("all"),c=j==="upcoming"?"active":"inactive";u.useEffect(()=>{const e=setTimeout(()=>{S(f),m(1)},500);return()=>{clearTimeout(e)}},[f]);const{data:v}=F({queryKey:["/api/categories"],queryFn:async()=>{const e=await fetch("/api/categories");if(!e.ok)throw new Error("Failed to fetch categories");return e.json()}}),A=e=>{const a=[];return e.forEach(i=>{a.push(i),i.subCategories&&i.subCategories.length>0&&i.subCategories.forEach(o=>{a.push({...o,name:`${i.name} > ${o.name}`})})}),a},K=v!=null&&v.categories?A(v.categories):[],{data:n,isLoading:T}=F({queryKey:["/api/rooms",s==null?void 0:s.id,r,c,N,h],queryFn:async()=>{if(!(s!=null&&s.id))return{rooms:[],totalDoc:0,limits:15,pages:0};const e=new URLSearchParams({page:r.toString(),limit:"15",userid:s.id,currentUserId:s.id,category:h==="all"?"":h,title:N,status:c}),a=await fetch(`/api/rooms?${e.toString()}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch shows");return await a.json()},enabled:!!(s!=null&&s.id)}),y=(n==null?void 0:n.rooms)||[],b=Math.ceil(((n==null?void 0:n.totalDoc)||0)/((n==null?void 0:n.limits)||15)),k=q({mutationFn:async({showId:e,newRoomType:a})=>await E("PUT",`/api/rooms/${e}`,{roomType:a}),onMutate:async({showId:e,newRoomType:a})=>{await l.cancelQueries({queryKey:["/api/rooms"]});const i=l.getQueryData(["/api/rooms",s==null?void 0:s.id,r,c]);return l.setQueryData(["/api/rooms",s==null?void 0:s.id,r,c],o=>o&&{...o,rooms:o.rooms.map(x=>x._id===e?{...x,roomType:a}:x)}),{previousShows:i}},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/rooms"]}),p({title:"Room type updated",description:"Show privacy settings have been updated successfully."})},onError:(e,a,i)=>{i!=null&&i.previousShows&&l.setQueryData(["/api/rooms",s==null?void 0:s.id,r,c],i.previousShows),p({title:"Failed to update room type",description:e.message,variant:"destructive"})}}),P=q({mutationFn:async e=>await E("PUT",`/api/rooms/${e}`,{ended:!0}),onMutate:async e=>{await l.cancelQueries({queryKey:["/api/rooms"]});const a=l.getQueryData(["/api/rooms",s==null?void 0:s.id,r,c]);return l.setQueryData(["/api/rooms",s==null?void 0:s.id,r,c],i=>i&&{...i,rooms:i.rooms.map(o=>o._id===e?{...o,ended:!0}:o)}),{previousShows:a}},onSuccess:()=>{l.invalidateQueries({queryKey:["/api/rooms"]}),p({title:"Show cancelled",description:"The show has been cancelled successfully."})},onError:(e,a,i)=>{i!=null&&i.previousShows&&l.setQueryData(["/api/rooms",s==null?void 0:s.id,r,c],i.previousShows),p({title:"Failed to cancel show",description:e.message,variant:"destructive"})}}),V=e=>{const a=e.roomType==="private"?"public":"private";k.mutate({showId:e._id,newRoomType:a})},U=e=>{P.mutate(e)},D=e=>{const a=`${window.location.origin}/show/${e}`;navigator.clipboard.writeText(a),p({title:"Show link copied to clipboard"})},B=()=>{r>1&&m(r-1)},H=()=>{r<b&&m(r+1)},O=e=>{R(e),m(1)},Y=e=>{C(e),m(1)},G=()=>{w(""),S(""),C("all"),m(1)},_=e=>{const a=Date.now(),i=e.date<=a,o=e.started||e.ended,x=i&&o;return t.jsxs("div",{className:"border border-border rounded-lg p-4 mb-3 bg-card","data-testid":`show-card-${e._id}`,children:[t.jsx("div",{className:"flex items-start justify-between mb-3",children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("h3",{className:"text-base font-medium text-foreground","data-testid":`show-title-${e._id}`,children:[e.title," — ",ce(new Date(e.date),"M/d/yyyy · h:mm a")]}),t.jsx("button",{onClick:()=>D(e._id),className:"p-1 hover-elevate active-elevate-2 rounded","data-testid":`button-copy-link-${e._id}`,title:"Copy show link",children:t.jsx(me,{className:"h-4 w-4 text-muted-foreground"})})]}),e.category&&t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.category.name})]})}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(d,{variant:"default",size:"sm",onClick:()=>g(`/show/${e._id}`),"data-testid":`button-open-show-${e._id}`,children:"Open show"}),t.jsx(d,{variant:"outline",size:"sm",onClick:()=>g(`/schedule-show?edit=${e._id}`),"data-testid":`button-edit-show-${e._id}`,children:"Edit show"}),!x&&t.jsx(d,{variant:"destructive",size:"sm",onClick:()=>U(e._id),disabled:P.isPending,"data-testid":`button-cancel-show-${e._id}`,children:"Cancel Show"}),t.jsxs(d,{variant:"outline",size:"sm",onClick:()=>V(e),disabled:k.isPending,"data-testid":`button-private-mode-${e._id}`,children:[e.roomType==="private"?"Disable":"Enable"," Private Mode"]})]})]},e._id)},$=()=>b<=1?null:t.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-border",children:[t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",r," of ",b," (",(n==null?void 0:n.totalDoc)||0," total shows)"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(d,{variant:"outline",size:"sm",onClick:B,disabled:r===1,"data-testid":"button-previous-page",children:[t.jsx(le,{className:"h-4 w-4 mr-1"}),"Previous"]}),t.jsxs(d,{variant:"outline",size:"sm",onClick:H,disabled:r>=b,"data-testid":"button-next-page",children:["Next",t.jsx(de,{className:"h-4 w-4 ml-1"})]})]})]});return t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"border-b border-border bg-background px-6 py-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-2xl font-bold text-foreground","data-testid":"text-shows-title",children:"Shows"}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(d,{className:"bg-primary hover:bg-primary/90 text-primary-foreground",size:"sm",onClick:()=>g("/schedule-show"),"data-testid":"button-schedule-show",children:[t.jsx(M,{className:"h-4 w-4 mr-1"}),"Schedule a Show"]})})]})}),t.jsxs("div",{className:"flex-1 overflow-auto px-6 py-6",children:[t.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-3",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),t.jsx(ee,{type:"text",placeholder:"Search by title...",value:f,onChange:e=>w(e.target.value),className:"pl-9","data-testid":"input-search-shows"})]}),t.jsxs(ae,{value:h,onValueChange:Y,children:[t.jsx(ie,{className:"w-full sm:w-48","data-testid":"select-category",children:t.jsx(re,{placeholder:"All Categories"})}),t.jsxs(oe,{children:[t.jsx(L,{value:"all",children:"All Categories"}),K.map(e=>t.jsx(L,{value:e._id,children:e.name},e._id))]})]}),(f||h!=="all")&&t.jsx(d,{variant:"outline",size:"default",onClick:G,"data-testid":"button-clear-filters",children:"Clear Filters"})]}),t.jsxs(te,{value:j,onValueChange:O,className:"w-full",children:[t.jsxs(se,{className:"mb-4","data-testid":"tabs-shows",children:[t.jsx(Q,{value:"upcoming","data-testid":"tab-upcoming",children:"Upcoming"}),t.jsx(Q,{value:"past","data-testid":"tab-past",children:"Past"})]}),t.jsx(z,{value:"upcoming","data-testid":"content-upcoming",children:T?t.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((e,a)=>t.jsx("div",{className:"h-32 bg-muted rounded-lg animate-pulse"},a))}):y.length>0?t.jsxs("div",{children:[y.map(_),$()]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(I,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"No upcoming shows"}),t.jsxs(d,{onClick:()=>g("/schedule-show"),"data-testid":"button-create-first-show",children:[t.jsx(M,{className:"h-4 w-4 mr-2"}),"Schedule Your First Show"]})]})}),t.jsx(z,{value:"past","data-testid":"content-past",children:T?t.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((e,a)=>t.jsx("div",{className:"h-32 bg-muted rounded-lg animate-pulse"},a))}):y.length>0?t.jsxs("div",{children:[y.map(_),$()]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx(I,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),t.jsx("p",{className:"text-muted-foreground",children:"No past shows"})]})})]})]})]})}export{$e as default};
