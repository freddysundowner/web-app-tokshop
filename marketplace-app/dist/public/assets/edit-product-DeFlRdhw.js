import{g as N,u as w,a as P,f as k,j as t,B as m,m as I,q as f}from"./index-FVTY5sKH.js";import{u as b}from"./useQuery-DsZx8GVA.js";import{u as E}from"./useMutation-DKG1zDtN.js";import{I as C}from"./inventory-product-form-DHaSYoPD.js";import{A as T}from"./arrow-left-C3R-C2jj.js";import"./form-CqTjZ3qa.js";import"./card-CF4CqaN2.js";import"./textarea-CeR6uy7m.js";import"./select-D3ZFUKhx.js";import"./index-BdQq_4o_.js";import"./index-BaZiuLT8.js";import"./index-Cbw5mxKQ.js";import"./chevron-down-BD1mluAZ.js";import"./check-DWjWNqF1.js";import"./chevron-up-D8QnUA5s.js";import"./badge-BTf7a5Ku.js";import"./scroll-area-BXmfGVKf.js";import"./dialog-A2pFZcsY.js";import"./radio-group-UroE5lc1.js";import"./index-CoWBA0E_.js";import"./circle-tm_CQXKA.js";import"./image-D492slPc.js";import"./upload-tXxaR6JU.js";import"./search-zDcbIzzp.js";import"./save-DQ6UIs6d.js";function et(){const[,a]=N("/edit-product/:id"),[,r]=w(),{user:s}=P(),{toast:u}=k(),i=a==null?void 0:a.id,{data:o,isLoading:y,isError:v}=b({queryKey:["external-product",i],queryFn:async()=>{if(!i)throw new Error("Product ID required");const e=await fetch(`/api/products/${i}?userId=${s==null?void 0:s.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch product: ${e.status}`);return e.json()},enabled:!!i}),p=E({mutationFn:async e=>{var x,h;if(!i)throw new Error("Product ID required");const j=e.listingType==="giveaway";let d,c;j?(d=`/api/giveaways/${i}`,c="PUT"):(d=s!=null&&s.admin?`/api/admin/products/${i}`:`/api/products/${i}`,c="PATCH");const n={...e,shippingProfile:(x=e.shippingProfile)!=null&&x.trim()?e.shippingProfile:"skip",tokshow:e.tokshow&&e.tokshow!=="no-show"?e.tokshow:null,userId:s==null?void 0:s.id};e.listingType==="auction"&&(e.startingPrice!==void 0&&(n.price=e.startingPrice,n.startingPrice=e.startingPrice),(h=o==null?void 0:o.auction)!=null&&h._id&&(n.auction=o.auction._id));const l=await fetch(d,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!l.ok){const g=await l.json();throw new Error(g.message||"Failed to update product")}return l.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["external-products"]}),f.invalidateQueries({queryKey:["external-product",i]}),u({title:"Product Updated",description:"Your product has been updated successfully."}),r("/inventory")},onError:e=>{u({title:"Failed to Update Product",description:e.message,variant:"destructive"})}});return i?y?t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(I,{className:"h-8 w-8 animate-spin mx-auto"}),t.jsx("p",{className:"text-muted-foreground",children:"Loading product..."})]})})}):v||!o?t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Product Not Found"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"The product you're trying to edit doesn't exist."}),t.jsx(m,{onClick:()=>r("/inventory"),className:"mt-4",children:"Back to Inventory"})]})}):t.jsxs("div",{className:"space-y-6","data-testid":"page-edit-product",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs(m,{variant:"outline",onClick:()=>r("/inventory"),"data-testid":"button-back-to-inventory",className:"w-full sm:w-auto",children:[t.jsx(T,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"sm:inline",children:"Back to Inventory"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground","data-testid":"text-page-title",children:"Edit Product"}),t.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground","data-testid":"text-page-description",children:["Update product information: ",o.name]})]})]}),t.jsx(C,{mode:"edit",product:o,onSubmit:e=>p.mutate(e),onCancel:()=>r("/inventory"),isPending:p.isPending})]}):t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Invalid Product ID"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"No product ID provided."}),t.jsx(m,{onClick:()=>r("/inventory"),className:"mt-4",children:"Back to Inventory"})]})})}export{et as default};
