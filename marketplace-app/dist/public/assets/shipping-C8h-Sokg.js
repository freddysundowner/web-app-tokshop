import{c as Te,r as f,j as e,l as _e,B as S,f as Xs,x as Ys,n as $t,I as Oe,a as Dt,R as gs,A as Os,y as Ts,X as Ps,z as zs,C as Bs,D as As,E as qs,F as Es,G as Ms,H as Ls}from"./index-FVTY5sKH.js";import{u as Re}from"./useQuery-DsZx8GVA.js";import{u as ue}from"./useMutation-DKG1zDtN.js";import{C as q,a as Ie,d as Fe,b as U}from"./card-CF4CqaN2.js";import{B as $e}from"./badge-BTf7a5Ku.js";import{C as je}from"./checkbox-CNlG1UXm.js";import{T as It,a as Ft,b as Me}from"./tabs-BcVWc8Zy.js";import{S as et,a as st,b as tt,c as at,d as fs}from"./select-D3ZFUKhx.js";import{S as it,e as Ot,a as nt,b as lt,c as rt,d as Tt}from"./sheet-0oGlQBkt.js";import{S as Se}from"./separator-QabP-acS.js";import{R as Pt,C as zt,a as Bt}from"./index-BiLFhckE.js";import{D as He,a as Ze,b as Xe,c as Ye,d as ys,f as bs,e as At}from"./dialog-A2pFZcsY.js";import{A as qt,a as Et}from"./alert-_3QEPDXW.js";import{I as Mt}from"./info-DtDjUfLP.js";import{U as Us}from"./users-B8e37Vk3.js";import{P as Ns}from"./package-dXPzRBiL.js";import{C as js}from"./chevron-down-BD1mluAZ.js";import{R as Lt}from"./refresh-cw-DVmfdMZj.js";import{T as dt}from"./truck-DDM-Vnwo.js";import{P as Je}from"./printer-DfjmthyX.js";import{f as We}from"./format-D46ChU1D.js";import{P as fe}from"./package-2-s8_v8ape.js";import{E as Ut}from"./external-link-ClLRZYJp.js";import{D as Kt}from"./download-DKq0cGIH.js";import{M as Qt}from"./map-pin-jcALPDnh.js";import{D as Ks,a as Qs,b as Rs,c as Z,d as Ws}from"./dropdown-menu-BrJ5tGq0.js";import{C as Rt}from"./pagination-1EOLrp3H.js";import{S as Wt}from"./search-zDcbIzzp.js";import{C as Vs}from"./chevron-right-HRo85rGP.js";import{E as Gs}from"./ellipsis-Ds8nGjh8.js";import{E as Vt}from"./eye-BQkOkbVm.js";import{S as Gt}from"./square-pen-CAsDE1RN.js";import"./index-Cbw5mxKQ.js";import"./check-DWjWNqF1.js";import"./index-CoWBA0E_.js";import"./index-BaZiuLT8.js";import"./index-BdQq_4o_.js";import"./chevron-up-D8QnUA5s.js";import"./circle-tm_CQXKA.js";import"./chevron-left-CnSIvoVj.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Te("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=Te("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Te("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=Te("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=Te("Ship",[["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"iegodh"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76",key:"fp8vka"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M12 10v4",key:"1kjpxc"}],["path",{d:"M12 2v3",key:"qbqxhf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=Te("Unlink2",[["path",{d:"M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7A5 5 0 0 1 7 7h2",key:"1re2ne"}]]),Ht=Pt,Zt=zt,Xt=Bt,Yt=[{value:"PDF_4x6",label:"4 x 6 in. (Standard Thermal)",description:"Most common thermal printer format"},{value:"PDF",label:"8.5 x 11 in. (Letter Size)",description:"Standard paper format"},{value:"PNG",label:"PNG Image (4 x 6 in.)",description:"Compatible with Dymo printers"},{value:"ZPLII",label:"ZPL II (Zebra Format)",description:"For Zebra thermal printers"}];function ct({open:j,onOpenChange:w,orderCount:o,onConfirm:K,isPending:h}){const[x,a]=f.useState("PDF_4x6"),_=()=>{K(x)};return e.jsx(He,{open:j,onOpenChange:w,children:e.jsxs(Ze,{className:"max-w-md",children:[e.jsxs(Xe,{children:[e.jsxs(Ye,{children:["Generate ",o," Label",o!==1?"s":"","?"]}),e.jsx(ys,{children:"If you need to make additional changes to the shipment after creating these labels, you may be charged."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_e,{htmlFor:"label-size",className:"text-sm font-medium",children:["Label Size ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(et,{value:x,onValueChange:a,disabled:h,children:[e.jsx(st,{id:"label-size","data-testid":"select-label-size",children:e.jsx(tt,{placeholder:"Select label size"})}),e.jsx(at,{children:Yt.map(O=>e.jsx(fs,{value:O.value,"data-testid":`option-${O.value}`,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:O.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:O.description})]})},O.value))})]})]}),e.jsxs(qt,{children:[e.jsx(Mt,{className:"h-4 w-4"}),e.jsx(Et,{className:"text-sm",children:"To change label sizes after generation, please update each label individually."})]})]}),e.jsxs(bs,{className:"gap-2 sm:gap-0",children:[e.jsx(S,{variant:"outline",onClick:()=>w(!1),disabled:h,"data-testid":"button-cancel-label",children:"Cancel"}),e.jsx(S,{onClick:_,disabled:h,"data-testid":"button-confirm-label",children:h?"Generating...":`Generate Label${o!==1?"s":""}`})]})]})})}function Zs({order:j,bundle:w,children:o,currentTab:K}){var d,b,k;const h=!!w,x=(w==null?void 0:w.orders)||[],a=j||(x.length>0?x[0]:null);if(!a)return e.jsx(e.Fragment,{children:o});const[_,O]=f.useState(!1),[W,he]=f.useState([]),[B,g]=f.useState(!1),[i,u]=f.useState(!1),[y,Q]=f.useState(null),v=()=>!h||!x.length?{subtotal:0,tax:0,shipping:0,total:0,itemCount:0}:x.reduce((n,p)=>{const T=p.items&&p.items.length>0?p.items.reduce((ge,De)=>ge+(De.price||0)*(De.quantity||1),0):(p.total||0)+(p.servicefee||0),$=p.items?p.items.reduce((ge,De)=>ge+(De.quantity||1),0):1,Ne=p.total_shipping_cost??p.seller_shipping_fee_pay??p.shipping_fee??0;return{subtotal:n.subtotal+T,tax:n.tax+(p.tax||0),shipping:n.shipping+Ne,total:n.total+T+(p.tax||0)+Ne,itemCount:n.itemCount+$}},{subtotal:0,tax:0,shipping:0,total:0,itemCount:0}),te=()=>!h||!x.length?{length:"0",width:"0",height:"0"}:{length:"12",width:"12",height:"12"},ce=()=>!h||!x.length?"0":x.reduce((p,T)=>{const $=T.weight?parseFloat(T.weight.toString()):0;return p+$},0).toString(),V=()=>{if(a.items&&a.items.length>0){const n=a.items.reduce((p,T)=>p+(T.price||0)*(T.quantity||1),0);if(n>0)return n}return(a.total||0)+(a.servicefee||0)},X=()=>{var n,p,T;if(h)return te();if((n=a.giveaway)!=null&&n.length&&((p=a.giveaway)!=null&&p.width)&&((T=a.giveaway)!=null&&T.height))return{length:a.giveaway.length,width:a.giveaway.width,height:a.giveaway.height};if(a.items&&a.items.length>0){const $=a.items[0];if($.length&&$.width&&$.height)return{length:$.length,width:$.width,height:$.height}}return a.giveaway?{length:"8",width:"6",height:"2"}:{length:"10",width:"8",height:"3"}},Y=()=>h?ce():a.weight?a.weight.toString():"0",ae=()=>{var n,p;return((p=(n=a.giveaway)==null?void 0:n.shipping_profile)==null?void 0:p.scale)||"oz"},[N,ie]=f.useState(X()),[R,ye]=f.useState(Y()),xe=!!(N.length&&N.width&&N.height&&R),pe=xe&&_,{toast:ne}=Xs(),G=Ys(),E=Re({queryKey:["/api/shipping/profiles/estimate/rates",{weight:R,length:N.length,width:N.width,height:N.height,product:((d=a.giveaway)==null?void 0:d._id)||"",owner:a.seller._id,customer:a.customer._id,isBundle:h}],queryFn:async()=>{var T,$,Ne,ge;const n={weight:R,unit:ae(),product:((T=a.giveaway)==null?void 0:T._id)||((ge=(Ne=($=a.items)==null?void 0:$[0])==null?void 0:Ne.productId)==null?void 0:ge._id)||a._id,update:!0,owner:a.seller._id,customer:a.customer._id,length:parseFloat(N.length),width:parseFloat(N.width),height:parseFloat(N.height)},p=await fetch("/api/shipping/profiles/estimate/rates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!p.ok)throw new Error(`Failed to fetch shipping estimates: ${p.status}`);return await p.json()},enabled:pe,retry:1}),le=E.data||[],M=()=>{var n;G.invalidateQueries({queryKey:["/api/shipping/profiles/estimate/rates",{weight:R,length:N.length,width:N.width,height:N.height,product:((n=a.giveaway)==null?void 0:n._id)||"",owner:a.seller._id,customer:a.customer._id,isBundle:h}]}),ne({title:"Refreshing shipping estimates..."})},be=ue({mutationFn:async n=>{var $;const p={rate_id:n.objectId,order:h&&(($=x[0])==null?void 0:$.bundleId)||a._id,isBundle:h,shipping_fee:parseFloat(n.price),servicelevel:`${n.carrier} ${n.service}`,carrier:n.carrier,deliveryTime:n.deliveryTime,label_file_type:n.labelFileType};return await(await $t("POST","/api/shipping/profiles/buy/label",p)).json()},onSuccess:(n,p)=>{n.success&&n.data?(n.data.label_url&&window.open(n.data.label_url,"_blank"),K==="all"?G.invalidateQueries({queryKey:["external-orders"]}):G.invalidateQueries({queryKey:["/api/bundles"]}),G.invalidateQueries({queryKey:["/api/shipping/metrics"]}),ne({title:"Shipping label purchased successfully!",description:`${n.data.carrier} ${n.data.service} - $${n.data.cost}
Tracking: ${n.data.tracking_number}`}),console.log("Label purchase successful:",n.data),O(!1)):ne({title:"Label purchase failed",description:n.message||"Unable to purchase shipping label",variant:"destructive"})},onError:n=>{console.error("Label purchase error:",n),ne({title:"Failed to purchase shipping label",description:n.message||"An unexpected error occurred",variant:"destructive"})}}),ee=n=>{if(!n.objectId||n.objectId.trim()===""){ne({title:"Cannot purchase label",description:"Invalid shipping rate. Please refresh estimates and try again.",variant:"destructive"});return}Q(n),u(!0)},Pe=n=>{y&&(be.mutate({...y,labelFileType:n}),u(!1))};return e.jsxs(it,{open:_,onOpenChange:O,children:[e.jsx(Ot,{asChild:!0,children:o}),e.jsxs(nt,{className:"w-[600px] sm:max-w-[600px] overflow-y-auto",children:[e.jsxs(lt,{children:[e.jsx(rt,{className:"flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Us,{size:20}),"Ship Bundle - ",x.length," Orders"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ns,{size:20}),"Ship Order ",a.invoice||a._id.slice(-8)]})}),e.jsx(Tt,{children:h?`Manage bundle dimensions, get shipping estimates, and print labels for ${x.length} orders`:"Manage dimensions, get shipping estimates, and print labels"})]}),e.jsxs("div",{className:"mt-6 space-y-6 pb-6",children:[h?e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsx(Fe,{className:"text-sm",children:"Customer"})}),e.jsx(U,{children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"}),e.jsxs("span",{className:"font-medium",children:[a.customer.firstName," ",a.customer.lastName||""]})]})})]}),e.jsx(Ht,{open:B,onOpenChange:g,children:e.jsxs(q,{children:[e.jsx(Zt,{asChild:!0,children:e.jsx(Ie,{className:"pb-3 cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs(Fe,{className:"text-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Us,{size:16}),"Bundle Summary"]}),e.jsx(js,{className:`h-4 w-4 transition-transform ${B?"rotate-180":""}`})]})})}),e.jsx(Xt,{children:e.jsxs(U,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Orders in Bundle:"}),e.jsxs("span",{className:"font-medium",children:[x.length," orders"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Items:"}),e.jsxs("span",{children:[v().itemCount," items"]})]}),e.jsx(Se,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Subtotal:"}),e.jsxs("span",{className:"font-medium",children:["$",v().subtotal.toFixed(2)]})]}),v().tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Tax:"}),e.jsxs("span",{children:["$",v().tax.toFixed(2)]})]}),v().shipping>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Shipping:"}),e.jsxs("span",{children:["$",v().shipping.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bundle Total:"}),e.jsxs("span",{children:["$",v().total.toFixed(2)]})]})]})})]})})]}):e.jsxs(q,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsx(Fe,{className:"text-sm",children:"Order Details"})}),e.jsxs(U,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Customer:"}),e.jsxs("span",{className:"font-medium",children:[a.customer.firstName," ",a.customer.lastName||""]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Items:"}),e.jsxs("span",{children:[((b=a.giveaway)==null?void 0:b.name)||(a.items&&a.items.length>0?(k=a.items[0].productId)==null?void 0:k.name:"Unknown Item"),"(",a.giveaway?a.giveaway.quantity:a.items?a.items.reduce((n,p)=>n+(p.quantity||1),0):1," items)"]})]}),V()>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal:"}),e.jsxs("span",{className:"font-medium",children:["$",V().toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax:"}),e.jsx("span",{children:(a.tax??0)>0?`$${(a.tax??0).toFixed(2)}`:"—"})]}),(a.seller_shipping_fee_pay??a.shipping_fee??0)>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping:"}),e.jsxs("span",{children:["$",(a.seller_shipping_fee_pay??a.shipping_fee??0).toFixed(2)]})]}),V()+(a.tax||0)+(a.seller_shipping_fee_pay||a.shipping_fee||0)>0&&e.jsxs("div",{className:"flex justify-between text-sm font-semibold border-t pt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total:"}),e.jsxs("span",{children:["$",(V()+(a.tax||0)+(a.seller_shipping_fee_pay||a.shipping_fee||0)).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order Date:"}),e.jsx("span",{children:a.createdAt?We(new Date(a.createdAt),"MMM dd, yyyy"):"N/A"})]})]})]}),e.jsxs(q,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsxs(Fe,{className:"text-sm flex items-center gap-2",children:[e.jsx(Jt,{size:16}),h?"Bundle":"Package"," Dimensions & Weight"]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"length",className:"text-xs",children:"Length (in)"}),e.jsx(Oe,{id:"length",value:N.length,onChange:n=>ie({...N,length:n.target.value}),placeholder:"11","data-testid":"input-length"})]}),e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"width",className:"text-xs",children:"Width (in)"}),e.jsx(Oe,{id:"width",value:N.width,onChange:n=>ie({...N,width:n.target.value}),placeholder:"6","data-testid":"input-width"})]}),e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"height",className:"text-xs",children:"Height (in)"}),e.jsx(Oe,{id:"height",value:N.height,onChange:n=>ie({...N,height:n.target.value}),placeholder:"0.25","data-testid":"input-height"})]})]}),e.jsxs("div",{children:[e.jsx(_e,{htmlFor:"weight",className:"text-xs",children:"Weight (oz)"}),e.jsx(Oe,{id:"weight",value:R,onChange:n=>ye(n.target.value),placeholder:"1.5",className:"mt-1","data-testid":"input-weight"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(S,{onClick:M,variant:"outline",size:"sm",disabled:E.isLoading,"data-testid":"button-refresh-estimates",children:[e.jsx(Lt,{size:14,className:`mr-1 ${E.isLoading?"animate-spin":""}`}),E.isLoading?"Loading...":"Refresh Estimates"]})})]})]}),e.jsxs(q,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsxs(Fe,{className:"text-sm flex items-center gap-2",children:[e.jsx(dt,{size:16}),"Shipping Options"]})}),e.jsxs(U,{children:[E.error&&e.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsxs("p",{className:"text-sm text-destructive",children:["Failed to fetch shipping estimates: ",E.error.message]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please check package dimensions and weight, then try again."})]}),!xe&&le.length===0&&!E.error&&e.jsx("div",{className:"mb-4 p-3 bg-muted/50 border border-muted rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter package dimensions and weight above to automatically calculate shipping costs."})}),xe&&!E.isLoading&&le.length===0&&!E.error&&e.jsx("div",{className:"mb-4 p-3 bg-muted/50 border border-muted rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading shipping estimates based on your package dimensions..."})}),e.jsx("div",{className:"space-y-3",children:le.map((n,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($e,{variant:"outline",className:"text-xs",children:n.carrier}),e.jsx("span",{className:"font-medium text-sm",children:n.service})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.deliveryTime})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-bold text-lg",children:["$",n.price]})}),e.jsxs(S,{onClick:()=>ee(n),disabled:be.isPending,size:"sm","data-testid":`button-print-${n.carrier.toLowerCase()}-${n.service.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsx(Je,{size:14,className:"mr-1"}),be.isPending?"Purchasing...":"Buy Label"]})]})]},p))})]})]}),(a.tracking_number||h&&x.some(n=>n.tracking_number))&&e.jsxs(q,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsx(Fe,{className:"text-sm",children:"Current Shipping Status"})}),e.jsx(U,{children:h?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Bundle Status"}),x.filter(n=>n.tracking_number).map((n,p)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/50 rounded-md",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["Order #",n.invoice||n._id.slice(-8)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tracking: ",n.tracking_number]}),(n.seller_shipping_fee_pay??n.shipping_fee??0)>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Shipping Cost: $",(n.seller_shipping_fee_pay??n.shipping_fee??0).toFixed(2)]})]}),e.jsx($e,{variant:"outline",children:n.status})]},n._id))]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Tracking Number: ",a.tracking_number]}),(a.seller_shipping_fee_pay??a.shipping_fee??0)>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Shipping Cost: $",(a.seller_shipping_fee_pay??a.shipping_fee??0).toFixed(2)]})]}),e.jsx($e,{children:a.status})]})})]})]})]}),e.jsx(ct,{open:i,onOpenChange:u,orderCount:1,onConfirm:Pe,isPending:be.isPending})]})}const ea={unfulfilled:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipping:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",pickup:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"};function sa({open:j,onOpenChange:w,bundleOrders:o,onUnbundle:K,isPending:h}){const[x,a]=f.useState([]),_=o.flatMap(i=>{var u,y,Q;return i.giveaway?[{itemId:i._id,orderId:i._id,orderInvoice:((u=i.invoice)==null?void 0:u.toString())||i._id.slice(-8),productName:i.giveaway.name,productImage:(y=i.giveaway.images)==null?void 0:y[0],description:i.giveaway.description||"-",quantity:i.giveaway.quantity||1,weight:(Q=i.giveaway.shipping_profile)!=null&&Q.weight?`${i.giveaway.shipping_profile.weight} ${i.giveaway.shipping_profile.scale||""}`:"-",price:0,shipping:i.shipping_fee||0,orderType:"Giveaway",date:i.date?new Date(i.date).toLocaleDateString():"-",status:i.status||"unfulfilled"}]:i.items&&i.items.length>0?i.items.map((v,te)=>{var ce,V,X,Y,ae,N;return{itemId:v._id||`${i._id}-${te}`,orderId:i._id,orderInvoice:((ce=i.invoice)==null?void 0:ce.toString())||i._id.slice(-8),productName:((V=v.productId)==null?void 0:V.name)||"Item",productImage:(Y=(X=v.productId)==null?void 0:X.images)==null?void 0:Y[0],description:((N=(ae=v.productId)==null?void 0:ae.category)==null?void 0:N.name)||"-",quantity:v.quantity||1,weight:v.weight?`${v.weight} ${v.scale||""}`:"-",price:v.price||0,shipping:v.shipping_fee||0,orderType:i.ordertype||"Buy Now",date:i.date?new Date(i.date).toLocaleDateString():"-",status:i.status||"unfulfilled"}}):[]});f.useEffect(()=>{j&&a([])},[j]);const O=i=>{a(u=>u.includes(i)?u.filter(y=>y!==i):[...u,i])},W=()=>{x.length===_.length?a([]):a(_.map(i=>i.itemId))},he=()=>{if(x.length===0)return;const i=_.filter(u=>x.includes(u.itemId)).reduce((u,y)=>(u[y.orderId]||(u[y.orderId]=[]),u[y.orderId].push(y.itemId),u),{});K(i),a([]),w(!1)},B=()=>{a([]),w(!1)},g=i=>{i||a([]),w(i)};return e.jsx(He,{open:j,onOpenChange:g,children:e.jsxs(Ze,{className:"max-w-6xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Select Items to Unbundle"}),e.jsx(ys,{children:"Choose which items you want to unbundle from this bundle. Selected items will be removed."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_e,{className:"text-sm text-muted-foreground",children:[x.length," of ",_.length," items selected"]}),e.jsx(S,{variant:"outline",size:"sm",onClick:W,"data-testid":"button-select-all-items",children:x.length===_.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"overflow-x-auto border rounded-md",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground w-8",children:e.jsx(je,{checked:x.length===_.length&&_.length>0,onCheckedChange:W,"data-testid":"checkbox-select-all-header"})}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Listing"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Description"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Qty"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Weight"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Sale Price"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Shipping"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Order Type"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Status"})]})}),e.jsx("tbody",{children:_.map(i=>{const u=x.includes(i.itemId);return e.jsxs("tr",{className:`border-b cursor-pointer hover:bg-muted/30 ${u?"bg-primary/5":""}`,onClick:()=>O(i.itemId),"data-testid":`row-item-${i.itemId}`,children:[e.jsx("td",{className:"py-2 px-2",onClick:y=>y.stopPropagation(),children:e.jsx(je,{checked:u,onCheckedChange:()=>O(i.itemId),"data-testid":`checkbox-item-${i.itemId}`})}),e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[i.productImage?e.jsx("img",{src:i.productImage,alt:i.productName,className:"w-10 h-10 object-cover rounded"}):e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center",children:e.jsx(fe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i.productName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",i.orderInvoice]})]})]})}),e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:i.description}),e.jsx("td",{className:"py-2 px-2",children:i.quantity}),e.jsx("td",{className:"py-2 px-2",children:i.weight}),e.jsxs("td",{className:"py-2 px-2",children:["$",i.price.toFixed(2)]}),e.jsxs("td",{className:"py-2 px-2",children:["$",i.shipping.toFixed(2)]}),e.jsx("td",{className:"py-2 px-2",children:i.orderType}),e.jsx("td",{className:"py-2 px-2 text-xs text-muted-foreground",children:i.date}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${ea[i.status]||"bg-gray-100 text-gray-800"}`,children:i.status})})]},i.itemId)})})]})})]}),e.jsxs(bs,{children:[e.jsx(S,{variant:"outline",onClick:B,disabled:h,"data-testid":"button-cancel-unbundle",children:"Cancel"}),e.jsx(S,{onClick:he,disabled:x.length===0||h,"data-testid":"button-confirm-unbundle",children:h?"Unbundling...":`Unbundle ${x.length} Item${x.length!==1?"s":""}`})]})]})})}function ta({open:j,onOpenChange:w,order:o,onUnbundle:K,isPending:h}){const[x,a]=f.useState([]);f.useEffect(()=>{j&&a([])},[j,o]);const _=g=>{a(i=>i.includes(g)?i.filter(u=>u!==g):[...i,g])},O=()=>{o!=null&&o.items&&(x.length===o.items.length?a([]):a(o.items.map(g=>g._id).filter(g=>!!g)))},W=()=>{x.length!==0&&(K(x),a([]),w(!1))},he=()=>{a([]),w(!1)},B=g=>{g||a([]),w(g)};return o!=null&&o.items?e.jsx(He,{open:j,onOpenChange:B,children:e.jsxs(Ze,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Select Items to Unbundle"}),e.jsx(ys,{children:"Choose which items you want to split into separate orders. Selected items will be removed from this order and created as new individual orders."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_e,{className:"text-sm text-muted-foreground",children:[x.length," of ",o.items.length," selected"]}),e.jsx(S,{variant:"outline",size:"sm",onClick:O,"data-testid":"button-select-all-items",children:x.length===o.items.length?"Deselect All":"Select All"})]}),e.jsx(Se,{}),e.jsx("div",{className:"space-y-2",children:o.items.filter(g=>g._id).map(g=>{var y;const i=g._id,u=x.includes(i);return e.jsx(q,{className:`p-4 cursor-pointer transition-colors hover-elevate ${u?"ring-2 ring-primary":""}`,onClick:()=>_(i),"data-testid":`item-card-${i}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{checked:u,onCheckedChange:()=>_(i),onClick:Q=>Q.stopPropagation(),"data-testid":`checkbox-item-${i}`}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:((y=g.productId)==null?void 0:y.name)||"Item"})]}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:["Quantity: ",g.quantity||1]}),e.jsxs("div",{children:["Price: $",(g.price||0).toFixed(2)," each"]}),g.weight&&e.jsxs("div",{children:["Weight: ",g.weight,g.scale||"oz"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold",children:["$",((g.price||0)*(g.quantity||1)).toFixed(2)]})})]})})]})},i)})})]}),e.jsxs(bs,{className:"gap-2 sm:gap-0",children:[e.jsx(S,{variant:"outline",onClick:he,disabled:h,"data-testid":"button-cancel-unbundle",children:"Cancel"}),e.jsx(S,{onClick:W,disabled:x.length===0||h,"data-testid":"button-confirm-unbundle",children:h?"Unbundling...":`Unbundle ${x.length} Item${x.length!==1?"s":""}`})]})]})}):null}function aa({open:j,onOpenChange:w,order:o}){var y,Q,v,te,ce,V,X,Y,ae,N,ie,R,ye,xe,pe,ne,G,E,le;if(!o)return null;const K=o.tracking_number||((y=o.tracking_url)==null?void 0:y.split("=")[1]),h=o.label||o.shipping_label_url,x=o.carrier||"USPS",a=o.servicelevel||o.service||"Standard",_=o.shipping_fee||o.total_shipping_cost||0,O=o.seller_shipping_fee_pay||0,W=((v=(Q=o.giveaway)==null?void 0:Q.shipping_profile)==null?void 0:v.weight)||((ce=(te=o.items)==null?void 0:te[0])==null?void 0:ce.weight),he=((X=(V=o.giveaway)==null?void 0:V.shipping_profile)==null?void 0:X.scale)||((ae=(Y=o.items)==null?void 0:Y[0])==null?void 0:ae.scale)||"oz",B=((N=o.giveaway)==null?void 0:N.length)||((R=(ie=o.items)==null?void 0:ie[0])==null?void 0:R.length),g=((ye=o.giveaway)==null?void 0:ye.width)||((pe=(xe=o.items)==null?void 0:xe[0])==null?void 0:pe.width),i=((ne=o.giveaway)==null?void 0:ne.height)||((E=(G=o.items)==null?void 0:G[0])==null?void 0:E.height),u=(le=o.customer)==null?void 0:le.address;return e.jsx(it,{open:j,onOpenChange:w,children:e.jsxs(nt,{className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsx(lt,{children:e.jsxs(rt,{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5"}),"Shipment Details"]})}),e.jsxs("div",{className:"mt-6 space-y-6",children:[K&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium",children:"Tracking Information"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Tracking Number"}),e.jsx("p",{className:"font-mono text-sm font-medium",children:K})]}),o.tracking_url&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full",onClick:()=>window.open(o.tracking_url,"_blank"),"data-testid":"button-track-package",children:[e.jsx(Ut,{className:"h-4 w-4 mr-2"}),"Track Package"]})]})]}),h&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Shipping Label"}),e.jsxs(S,{variant:"outline",size:"sm",className:"w-full",onClick:()=>window.open(h,"_blank"),"data-testid":"button-download-label",children:[e.jsx(Kt,{className:"h-4 w-4 mr-2"}),"Download Label"]})]}),e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Service Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Carrier"}),e.jsx($e,{variant:"secondary",children:x})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Service"}),e.jsx("p",{className:"text-sm",children:a})]})]})]}),e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Shipping Costs"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Buyer Paid"}),e.jsxs("p",{className:"text-sm font-medium",children:["$",_.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Your Cost"}),e.jsxs("p",{className:"text-sm font-medium",children:["$",O.toFixed(2)]})]})]})]}),(W||B&&g&&i)&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Package Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[W&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Weight"}),e.jsxs("p",{className:"text-sm",children:[W," ",he]})]}),B&&g&&i&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Dimensions"}),e.jsxs("p",{className:"text-sm",children:[B," × ",g," × ",i,'"']})]})]})]})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium",children:"Shipping Address"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-4 space-y-1 text-sm",children:[(u.firstName||u.lastName)&&e.jsxs("p",{className:"font-medium",children:[u.firstName," ",u.lastName]}),u.addrress1&&e.jsx("p",{children:u.addrress1}),u.addrress2&&e.jsx("p",{children:u.addrress2}),e.jsxs("p",{children:[u.city,", ",u.state," ",u.zipcode]}),u.country&&e.jsx("p",{children:u.country})]})]})]}),e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Order Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Order ID"}),e.jsxs("p",{className:"font-mono",children:["#",o.invoice||o._id.slice(-8)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Status"}),e.jsx($e,{variant:"outline",children:o.status})]})]})]})]})]})})}const Qe={unfulfilled:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipping:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",pickup:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400"};function Qa(){const[j,w]=f.useState([]),[o,K]=f.useState([]),[h,x]=f.useState("all"),[a,_]=f.useState("all"),[O,W]=f.useState(""),[he,B]=f.useState(!1),[g,i]=f.useState(null),[u,y]=f.useState(!1),[Q,v]=f.useState(1),[te,ce]=f.useState(20),[V,X]=f.useState(!1),[Y,ae]=f.useState(null),[N,ie]=f.useState(!1),[R,ye]=f.useState(null),[xe,pe]=f.useState(!1),[ne,G]=f.useState(!1),[E,le]=f.useState(null),[M,be]=f.useState(null),[ee,Pe]=f.useState(null),{user:d}=Dt(),{toast:b}=Xs(),k=Ys(),n=ue({mutationFn:async({orderId:s,relist:l})=>{const c=await fetch(`/api/orders/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled",relist:l})});if(!c.ok)throw new Error("Failed to cancel order");return c.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["external-orders"]}),b({title:"Order cancelled successfully"}),i(null),y(!1)},onError:()=>{b({title:"Failed to cancel order",variant:"destructive"})}}),p=()=>{g&&n.mutate({orderId:g,relist:u})},T=s=>!(s.status==="cancelled"||s.status==="shipped"||s.status==="delivered"||s.status==="ended"||s.tracking_number||s.tracking_url),$=ue({mutationFn:async({orderId:s,itemIds:l})=>{const c=await fetch("/api/orders/unbundle/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:s,itemIds:l})});if(!c.ok)throw new Error("Failed to unbundle items");return c.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["external-orders"]}),b({title:"Items unbundled successfully",description:"Selected items have been created as separate orders"}),ye(null),ie(!1)},onError:()=>{b({title:"Failed to unbundle items",variant:"destructive"})}}),Ne=s=>{R&&s.length>0&&$.mutate({orderId:R,itemIds:s})},ge=s=>{v(s)},De=s=>{ce(s),v(1)},vs=()=>{v(1)},ot=s=>{x(s),vs()},mt=s=>{_(s),vs()},ze=s=>{s===h&&(ns(),gt(),os(),ts())},{data:I,isLoading:ut,error:es,isError:ss,refetch:ts}=Re({queryKey:["/api/shipping/metrics",d==null?void 0:d.id],enabled:!!(d!=null&&d.id),staleTime:0,refetchOnMount:!0}),{data:oe,isLoading:ht,error:as,isError:is,refetch:ns}=Re({queryKey:["external-orders",d==null?void 0:d.id,h,a,Q,te],queryFn:async()=>{const s=new URLSearchParams;d!=null&&d.id&&(d.seller===!1||d.seller===void 0?s.set("customer",d.id):s.set("userId",d.id)),h&&h!=="all"&&s.set("status",h),a&&a!=="all"&&s.set("customerId",a),s.set("page",Q.toString()),s.set("limit",te.toString());const l=await fetch(`/api/orders?${s.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`External API error: ${l.status}`);return l.json()},enabled:!!(d!=null&&d.id),staleTime:0,refetchOnMount:!0}),L=(oe==null?void 0:oe.orders)||[],xt=(oe==null?void 0:oe.total)||0,pt=(oe==null?void 0:oe.pages)||0,{data:ls,refetch:gt}=Re({queryKey:["external-orders",d==null?void 0:d.id,"all","all"],queryFn:async()=>{const s=new URLSearchParams;d!=null&&d.id&&(d.seller===!1||d.seller===void 0?s.set("customer",d.id):s.set("userId",d.id));const l=await fetch(`/api/orders?${s.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`External API error: ${l.status}`);return l.json()},enabled:!!(d!=null&&d.id),staleTime:0,refetchOnMount:!0}),A=(ls==null?void 0:ls.orders)||[],ft=gs.useMemo(()=>{if(!L||L.length===0)return[];const s=new Map;return L.forEach(l=>{l.customer&&l.customer._id&&s.set(l.customer._id,{_id:l.customer._id,firstName:l.customer.firstName,lastName:l.customer.lastName||""})}),Array.from(s.values()).sort((l,c)=>`${l.firstName} ${l.lastName}`.localeCompare(`${c.firstName} ${c.lastName}`))},[L]),{data:rs,isLoading:jt,error:ds,isError:cs,refetch:os}=Re({queryKey:["/api/bundles",d==null?void 0:d.id],queryFn:async()=>{if(!(d!=null&&d.id))throw new Error("User ID required");const s=await fetch(`/api/bundles?userId=${d.id}`);if(!s.ok)throw new Error("Failed to fetch bundles");return s.json()},enabled:!!(d!=null&&d.id),staleTime:0,refetchOnMount:!0});f.useEffect(()=>{const s=sessionStorage.getItem("openShipmentDrawer");if(s)try{const l=JSON.parse(s);le(l),G(!0),sessionStorage.removeItem("openShipmentDrawer")}catch(l){console.error("Failed to parse order from sessionStorage:",l),sessionStorage.removeItem("openShipmentDrawer")}},[]);const ms=(L==null?void 0:L.filter(s=>{var c;return(((c=s.items)==null?void 0:c.length)||0)<=1}))||[],ws=s=>{const l=(A==null?void 0:A.filter(D=>D.bundleId===s))||[];if(l.length===0)return"processing";const c=l.map(D=>D.status||"processing"),z=Array.from(new Set(c));return z.length===1?z[0]:c.some(D=>D==="cancelled")?"cancelled":c.some(D=>D==="shipped")?"shipped":c.some(D=>D==="ready_to_ship")?"ready_to_ship":"processing"};rs!=null&&rs.filter(s=>{const l=ws(s.id);return h==="all"?!0:l===h});const yt=(L==null?void 0:L.filter(s=>{var c;return(((c=s.items)==null?void 0:c.length)||0)>1}))||[],Ve=[...ms,...yt.map(s=>({bundleName:`Order #${s.invoice||s._id.slice(-8)}`,id:s._id,customerId:s.customer._id,customerName:`${s.customer.firstName} ${s.customer.lastName||""}`,createdAt:s.createdAt?new Date(s.createdAt):new Date,totalWeight:s.weight?`${s.weight} oz`:null,totalDimensions:null,trackingNumber:s.tracking_number||null,shippingCost:s.shipping_fee?s.shipping_fee.toString():null,shippedAt:null,isBundle:!0,isSingleOrder:!0}))].sort((s,l)=>{var D,re,se,Ae,qe,Ee;if(M&&ee){const ve="isBundle"in s&&s.isBundle,we="isBundle"in l&&l.isBundle;let de=0;if(M==="customer"){const J=ve?s.customerName:`${((D=s.customer)==null?void 0:D.firstName)||""} ${((re=s.customer)==null?void 0:re.lastName)||""}`,H=we?l.customerName:`${((se=l.customer)==null?void 0:se.firstName)||""} ${((Ae=l.customer)==null?void 0:Ae.lastName)||""}`;de=J.localeCompare(H)}else if(M==="orderDate"){const J=s.createdAt?new Date(s.createdAt).getTime():0,H=l.createdAt?new Date(l.createdAt).getTime():0;de=J-H}else if(M==="items"){const J=ve?0:s.giveaway?1:((qe=s.items)==null?void 0:qe.length)||0,H=we?0:l.giveaway?1:((Ee=l.items)==null?void 0:Ee.length)||0;de=J-H}else if(M==="total"){const J=ve?0:(s.total||0)+(s.tax||0)+(s.shipping_fee||0),H=we?0:(l.total||0)+(l.tax||0)+(l.shipping_fee||0);de=J-H}else if(M==="status"){const J=ve?"":s.status||"",H=we?"":l.status||"";de=J.localeCompare(H)}return ee==="asc"?de:-de}const c=s.createdAt?new Date(s.createdAt):new Date(0);return(l.createdAt?new Date(l.createdAt):new Date(0)).getTime()-c.getTime()}),ks=(s,l)=>{const c=L==null?void 0:L.find(z=>z._id===s);if(l&&(c==null?void 0:c.status)!=="processing"){b({title:"Only processing orders can be bundled",variant:"destructive"});return}w(l?[...j,s]:j.filter(z=>z!==s))},bt=s=>{if(s){const l=Ve.filter(c=>!("isBundle"in c)).map(c=>c).filter(c=>c.status==="processing").map(c=>c._id);w(l)}else w([])},Cs=s=>{o.includes(s)?K(o.filter(l=>l!==s)):K([...o,s])},Be=s=>{M===s?ee==="asc"?Pe("desc"):ee==="desc"&&(be(null),Pe(null)):(be(s),Pe("asc"))},Ss=ue({mutationFn:async s=>{if(!(d!=null&&d.id))throw new Error("User ID required");const l=await fetch("/api/orders/bundle/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,userId:d.id})});if(!l.ok){const c=await l.json().catch(()=>({message:"Failed to create bundle"}));throw new Error(c.message||"Failed to create bundle")}return l.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/bundles"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),w([]),W(""),B(!1),b({title:"Bundle created successfully"})},onError:s=>{b({title:"Failed to create bundle",description:s.message,variant:"destructive"})}}),us=ue({mutationFn:async({bundleId:s,orderIds:l})=>{if(!(d!=null&&d.id))throw new Error("User ID required");const c=await fetch(`/api/bundles/${s}?userId=${d.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:l?JSON.stringify({orderIds:l}):void 0});if(!c.ok)throw new Error("Failed to unbundle orders");return c.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/bundles"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),b({title:"Orders unbundled successfully"})},onError:()=>{b({title:"Failed to unbundle orders",variant:"destructive"})}}),hs=ue({mutationFn:async({bundleId:s,relist:l})=>{if(!(d!=null&&d.id))throw new Error("User ID required");const c=(A==null?void 0:A.filter(se=>se.bundleId===s))||[],z=c.map(se=>fetch(`/api/orders/${se._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled",relist:l})})),re=(await Promise.all(z)).filter(se=>!se.ok);if(re.length>0)throw new Error(`Failed to cancel ${re.length} orders in bundle`);return{cancelledOrders:c.length}},onSuccess:s=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/bundles"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),b({title:`Bundle cancelled - ${s.cancelledOrders} orders cancelled`}),i(null),y(!1)},onError:s=>{b({title:"Failed to cancel bundle",description:s.message,variant:"destructive"})}}),xs=ue({mutationFn:async s=>{const l=await fetch(`/api/orders/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"shipped"})});if(!l.ok){const c=await l.json().catch(()=>({message:"Failed to mark order as shipped"}));throw new Error(c.message||"Failed to mark order as shipped")}return l.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),b({title:"Order marked as shipped"})},onError:s=>{b({title:"Failed to mark order as shipped",description:s.message,variant:"destructive"})}}),ps=ue({mutationFn:async s=>{if(!(d!=null&&d.id))throw new Error("User ID required");const l=await fetch(`/api/orders/bundle/${s}/ship`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:d.id})});if(!l.ok){const c=await l.json().catch(()=>({error:"Failed to mark bundle as shipped"}));throw new Error(c.error||"Failed to mark bundle as shipped")}return l.json()},onSuccess:s=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/bundles"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),b({title:`Bundle shipped - ${s.shippedOrders} orders marked as shipped`})},onError:s=>{b({title:"Failed to ship bundle",description:s.message,variant:"destructive"})}}),Nt=()=>{if(j.length<2){b({title:"Select at least 2 orders to bundle",variant:"destructive"});return}B(!0)},vt=()=>{Ss.mutate({orderIds:j})},wt=s=>{ae(s),X(!0)},kt=async s=>{if(!Y)return;const l=Object.keys(s);try{for(const c of l){const z=s[c],D=await fetch("/api/orders/unbundle/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:c,itemIds:z})});if(!D.ok){const re=await D.json().catch(()=>({message:`Failed to unbundle items from order ${c}`}));throw new Error(re.message||`Failed to unbundle items from order ${c}`)}}k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/bundles"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),b({title:"Items unbundled successfully",description:`${Object.values(s).flat().length} items unbundled from ${l.length} order(s)`}),X(!1),ae(null)}catch(c){b({title:"Failed to unbundle items",description:c instanceof Error?c.message:"An error occurred",variant:"destructive"})}},Ct=s=>{hs.mutate({bundleId:s,relist:u})},_s=ue({mutationFn:async({orderIds:s,labelFileType:l})=>{if(!(d!=null&&d.id))throw new Error("User ID required");const c=await fetch("/api/shipping/bulk-labels",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderIds:s,labelFileType:l,userId:d.id})});if(!c.ok){const z=await c.json().catch(()=>({message:"Failed to purchase labels"}));throw new Error(z.message||"Failed to purchase labels")}return c.json()},onSuccess:s=>{k.invalidateQueries({queryKey:["external-orders"]}),k.invalidateQueries({queryKey:["/api/shipping/metrics"]}),w([]),pe(!1),b({title:`${s.successCount||j.length} label(s) purchased successfully`,description:s.failureCount?`${s.failureCount} label(s) failed`:void 0})},onError:s=>{b({title:"Failed to purchase labels",description:s.message,variant:"destructive"})}}),St=()=>{if(j.length===0){b({title:"No orders selected",description:"Please select at least one order to purchase labels",variant:"destructive"});return}pe(!0)},_t=s=>{_s.mutate({orderIds:j,labelFileType:s})};if(ut||ht||jt)return e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-48 mb-8"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:Array.from({length:6}).map((s,l)=>e.jsx("div",{className:"h-20 bg-muted rounded"},l))}),e.jsx("div",{className:"h-96 bg-muted rounded"})]})})});if(ss||is||cs){const s=[];return ss&&s.push("metrics"),is&&s.push("orders"),cs&&s.push("bundles"),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx(q,{className:"max-w-md mx-auto mt-8",children:e.jsx(U,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive text-5xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Failed to Load Shipping Data"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(as==null?void 0:as.message)||(es==null?void 0:es.message)||(ds==null?void 0:ds.message)||`Something went wrong while loading your ${s.join(", ")}. Please try again.`}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[ss&&e.jsx(S,{onClick:()=>ts(),variant:"outline",size:"sm","data-testid":"button-retry-metrics",children:"Retry Metrics"}),is&&e.jsx(S,{onClick:()=>ns(),variant:"outline",size:"sm","data-testid":"button-retry-orders",children:"Retry Orders"}),cs&&e.jsx(S,{onClick:()=>os(),variant:"outline",size:"sm","data-testid":"button-retry-bundles",children:"Retry Bundles"}),e.jsx(S,{onClick:()=>{ts(),ns(),os()},"data-testid":"button-retry-all",children:"Retry All"})]})]})})})})})}return e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground","data-testid":"text-shipments-title",children:"Shipments"}),e.jsxs("div",{className:"mt-1 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"View shipments by live show or marketplace"}),e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:[We(new Date,"MM/dd/yyyy 'at' h:mm a")," • Shipping Complete"]})]})]}),e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4",children:[e.jsx(q,{className:"border-2 border-accent bg-accent/10",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-total-sold",children:["$",(I==null?void 0:I.totalSold)||"0"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Sold"})]})}),e.jsx(q,{className:"border border-border",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-total-earned",children:["$",(I==null?void 0:I.totalEarned)||"0"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Earned (Paid Out)"})]})}),e.jsx(q,{className:"border border-border",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-shipping-spend",children:["$",(I==null?void 0:I.totalShippingSpend)||"0"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Shipping Spend"})]})}),e.jsx(q,{className:"border border-border",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-items-sold",children:(I==null?void 0:I.itemsSold)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Items sold"})]})}),e.jsx(q,{className:"border border-border",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-total-delivered",children:(I==null?void 0:I.totalDelivered)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Delivered"})]})}),e.jsx(q,{className:"border border-border",children:e.jsxs(U,{className:"p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-lg font-bold text-foreground","data-testid":"metric-pending-delivery",children:(I==null?void 0:I.pendingDelivery)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Pending Delivery"})]})})]})}),e.jsx("div",{className:"mb-6 space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(It,{value:h,onValueChange:ot,className:"w-full",children:e.jsxs(Ft,{className:"grid w-full grid-cols-3 sm:grid-cols-5",children:[e.jsx(Me,{value:"all","data-testid":"tab-all",onClick:()=>ze("all"),children:"All"}),e.jsx(Me,{value:"processing","data-testid":"tab-processing",onClick:()=>ze("processing"),children:"Need Label"}),e.jsx(Me,{value:"ready_to_ship","data-testid":"tab-ready-to-ship",onClick:()=>ze("ready_to_ship"),children:"Ready to Ship"}),e.jsx(Me,{value:"shipped","data-testid":"tab-shipped",onClick:()=>ze("shipped"),children:"Shipped"}),e.jsx(Me,{value:"cancelled","data-testid":"tab-cancelled",onClick:()=>ze("cancelled"),children:"Cancelled"})]})})}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs(et,{value:a,onValueChange:mt,children:[e.jsx(st,{"data-testid":"select-customer",children:e.jsx(tt,{placeholder:"Filter by customer..."})}),e.jsxs(at,{children:[e.jsx(fs,{value:"all",children:"All Customers"}),ft.map(s=>e.jsxs(fs,{value:s._id,children:[s.firstName," ",s.lastName]},s._id))]})]})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-full flex flex-col gap-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["1-",Ve.length," of ",Ve.length]}),j.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:[j.length," selected"]}),e.jsxs(He,{open:he,onOpenChange:B,children:[e.jsx(At,{asChild:!0,children:e.jsxs(S,{size:"sm",variant:"outline",onClick:Nt,disabled:j.length<2,"data-testid":"button-create-bundle",children:[e.jsx(fe,{size:14,className:"mr-1"}),e.jsx("span",{className:"hidden xs:inline",children:"Bundle "}),"(",j.length,")"]})}),e.jsxs(Ze,{children:[e.jsx(Xe,{children:e.jsx(Ye,{children:"Create Shipment Bundle"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bundleName",className:"text-sm font-medium",children:"Bundle Name"}),e.jsx(Oe,{id:"bundleName",value:O,onChange:s=>W(s.target.value),placeholder:"Enter bundle name",className:"mt-1","data-testid":"input-bundle-name"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(S,{variant:"outline",onClick:()=>B(!1),"data-testid":"button-cancel-bundle",children:"Cancel"}),e.jsx(S,{onClick:vt,disabled:Ss.isPending,"data-testid":"button-confirm-bundle",children:"Create Bundle"})]})]})]})]}),e.jsxs(S,{size:"sm",variant:"default",onClick:St,disabled:j.length===0,"data-testid":"button-buy-labels",children:[e.jsx(Je,{size:14,className:"mr-1"}),e.jsx("span",{className:"hidden xs:inline",children:"Buy Labels "}),"(",j.length,")"]})]})]}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsxs("div",{className:"relative",children:[e.jsx(Wt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),e.jsx(Oe,{placeholder:"Username, order ID, shipping carrier",className:"pl-10 w-full sm:w-80","data-testid":"input-search-shipments"})]})})]})}),e.jsx(q,{className:"shadow border border-border w-full",children:e.jsx(U,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse divide-y divide-border text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left w-10",children:e.jsx(je,{checked:j.length===ms.filter(s=>s.status==="processing").length&&ms.filter(s=>s.status==="processing").length>0,onCheckedChange:bt,"data-testid":"checkbox-select-all-shipments"})}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-muted-foreground uppercase whitespace-nowrap cursor-pointer select-none hover:bg-muted/80",onClick:()=>Be("customer"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Customer",M==="customer"?ee==="asc"?e.jsx(Ke,{size:14}):e.jsx(Le,{size:14}):e.jsx(Ue,{size:14,className:"opacity-50"})]})}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-muted-foreground uppercase whitespace-nowrap cursor-pointer select-none hover:bg-muted/80",onClick:()=>Be("orderDate"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Order Date",M==="orderDate"?ee==="asc"?e.jsx(Ke,{size:14}):e.jsx(Le,{size:14}):e.jsx(Ue,{size:14,className:"opacity-50"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-muted-foreground uppercase whitespace-nowrap cursor-pointer select-none hover:bg-muted/80",onClick:()=>Be("items"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Items",M==="items"?ee==="asc"?e.jsx(Ke,{size:14}):e.jsx(Le,{size:14}):e.jsx(Ue,{size:14,className:"opacity-50"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-muted-foreground uppercase whitespace-nowrap cursor-pointer select-none hover:bg-muted/80",onClick:()=>Be("total"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Total",M==="total"?ee==="asc"?e.jsx(Ke,{size:14}):e.jsx(Le,{size:14}):e.jsx(Ue,{size:14,className:"opacity-50"})]})}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-muted-foreground uppercase whitespace-nowrap",children:"Dimensions"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-muted-foreground uppercase whitespace-nowrap cursor-pointer select-none hover:bg-muted/80",onClick:()=>Be("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status",M==="status"?ee==="asc"?e.jsx(Ke,{size:14}):e.jsx(Le,{size:14}):e.jsx(Ue,{size:14,className:"opacity-50"})]})}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-muted-foreground uppercase whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:Ve.map(s=>{var c,z,D,re,se,Ae,qe,Ee,ve,we,de,J,H,$s;if("isBundle"in s&&s.isBundle){const t=s,m=t.isSingleOrder?(A==null?void 0:A.filter(r=>r._id===t.id))||[]:(A==null?void 0:A.filter(r=>r.bundleId===t.id))||[],F=t.isSingleOrder?((c=m[0])==null?void 0:c.status)||"processing":ws(t.id),ke=m.reduce((r,C)=>C.giveaway?r+1:C.items&&C.items.length>0?r+C.items.length:r,0),Ce=m.reduce((r,C)=>{const P=(C.total||0)+(C.tax||0)+(C.shipping_fee||0);return r+P},0);return e.jsxs(gs.Fragment,{children:[e.jsxs("tr",{"data-testid":`row-bundle-${t.id}`,children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx(je,{checked:j.includes(t.id),onCheckedChange:r=>ks(t.id,r),"data-testid":`checkbox-bundle-${t.id}`,disabled:F!=="processing",className:F!=="processing"?"opacity-50 cursor-not-allowed":""})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>Cs(t.id),className:"p-1 h-5 w-5 mr-1","data-testid":`button-expand-${t.id}`,children:o.includes(t.id)?e.jsx(js,{size:12}):e.jsx(Vs,{size:12})}),e.jsx("div",{children:e.jsx("div",{className:"text-sm font-medium text-foreground truncate",children:t.customerName})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:We(new Date(t.createdAt),"MMM dd, yyyy")})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-sm text-foreground font-medium",children:ke})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["$",Ce.toFixed(2)]})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("div",{children:t.totalWeight||"-"}),e.jsx("div",{className:"text-xs",children:(()=>{var C,P,Ge;const r=m[0];if(!r)return"-";if((C=r.giveaway)!=null&&C.length&&((P=r.giveaway)!=null&&P.width)&&((Ge=r.giveaway)!=null&&Ge.height))return`${r.giveaway.length}" × ${r.giveaway.width}" × ${r.giveaway.height}"`;if(r.items&&r.items.length>0){const me=r.items[0];if(me.length&&me.width&&me.height)return`${me.length}" × ${me.width}" × ${me.height}"`}return'12" × 12" × 12"'})()})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{children:[e.jsx($e,{className:`text-xs ${F==="processing"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400":F==="ready_to_ship"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":F==="shipped"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":F==="cancelled"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,"data-testid":`bundle-status-${F}`,children:F.replaceAll("_"," ").toUpperCase()}),(()=>{const r=m[0],C=r==null?void 0:r.tracking_number;return C?e.jsx("div",{className:"text-xs text-primary font-mono mt-1 cursor-pointer hover:bg-primary/10 px-1 py-0.5 rounded transition-colors",onClick:()=>{navigator.clipboard.writeText(C),b({title:"Copied!",description:"Bundle tracking number copied to clipboard"})},title:"Click to copy bundle tracking number","data-testid":`bundle-tracking-number-${t.id}`,children:C}):null})()]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(Ks,{children:[e.jsx(Qs,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm","data-testid":`button-bundle-menu-${t.id}`,children:e.jsx(Gs,{size:16})})}),e.jsxs(Rs,{align:"end",children:[((z=m[0])==null?void 0:z.status)==="processing"&&e.jsx(Zs,{bundle:{...t,orders:m},currentTab:h,children:e.jsxs(Z,{onSelect:r=>r.preventDefault(),children:[e.jsx(Vt,{size:14,className:"mr-2"}),"View Bundle Details"]})}),F==="ready_to_ship"&&e.jsxs(Z,{onClick:()=>ps.mutate(t.id),disabled:ps.isPending,"data-testid":`menu-ship-bundle-${t.id}`,children:[e.jsx(Js,{size:14,className:"mr-2"}),ps.isPending?"Shipping...":"Mark Bundle as Shipped"]}),(((D=m[0])==null?void 0:D.label)||((re=m[0])==null?void 0:re.tracking_number)||((se=m[0])==null?void 0:se.shipping_label_url))&&e.jsxs(Z,{onClick:()=>{const r=m[0],C=r.label??r.shipping_label_url??r.tracking_link;C?window.open(C,"_blank"):b({title:"No label found",description:"This bundle doesn't have a shipping label yet.",variant:"destructive"})},"data-testid":`menu-print-bundle-${t.id}`,children:[e.jsx(Je,{size:14,className:"mr-2"}),"Print Bundle Label"]}),(((Ae=m[0])==null?void 0:Ae.tracking_number)||((qe=m[0])==null?void 0:qe.tracking_url))&&e.jsxs(Z,{onClick:()=>{le(m[0]),G(!0)},"data-testid":`menu-shipment-details-${t.id}`,children:[e.jsx(fe,{size:14,className:"mr-2"}),"Shipment Details"]}),F==="processing"&&e.jsxs(Z,{onClick:()=>wt(t.id),disabled:us.isPending,"data-testid":`menu-unbundle-${t.id}`,children:[e.jsx(Hs,{size:14,className:"mr-2"}),us.isPending?"Unbundling...":"Unbundle Orders"]}),F!=="cancelled"&&F!=="shipped"&&!m.some(r=>r.tracking_number||r.tracking_url)&&e.jsxs(e.Fragment,{children:[e.jsx(Ws,{}),e.jsxs(Os,{onOpenChange:r=>{r||(i(null),y(!1))},children:[e.jsx(Ts,{asChild:!0,children:e.jsxs(Z,{onSelect:r=>r.preventDefault(),className:"text-red-600","data-testid":`menu-cancel-bundle-${t.id}`,onClick:()=>i(t.id),children:[e.jsx(Ps,{size:14,className:"mr-2"}),"Cancel Bundle"]})}),e.jsxs(zs,{children:[e.jsxs(Bs,{children:[e.jsx(As,{children:"Cancel Bundle"}),e.jsxs(qs,{children:["Are you sure you want to cancel bundle #",t.id.slice(-8),"? This will cancel all"," ",m.length," orders in this bundle. This action cannot be undone."]})]}),e.jsxs("div",{className:"flex items-center space-x-2 my-4",children:[e.jsx(je,{id:`relist-bundle-${t.id}`,checked:u,onCheckedChange:r=>y(r===!0),"data-testid":`checkbox-relist-bundle-${t.id}`}),e.jsx("label",{htmlFor:`relist-bundle-${t.id}`,className:"text-sm",children:"Relist these orders for future processing"})]}),e.jsxs(Es,{children:[e.jsx(Ms,{onClick:()=>{i(null),y(!1)},"data-testid":`button-keep-bundle-${t.id}`,children:"Keep Bundle"}),e.jsx(Ls,{onClick:()=>Ct(t.id),disabled:hs.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50","data-testid":`button-confirm-cancel-bundle-${t.id}`,children:hs.isPending?"Cancelling Bundle...":"Cancel Bundle"})]})]})]})]})]})]})})})]}),o.includes(t.id)&&e.jsx("tr",{className:"bg-muted/50","data-testid":`expanded-bundle-${t.id}`,children:e.jsx("td",{colSpan:7,className:"px-3 py-3",children:e.jsxs("div",{className:"bg-card rounded-lg p-4 border",children:[e.jsx("h4",{className:"font-medium text-sm mb-3 text-muted-foreground",children:"Items (Bundled)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Listing"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Description"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Qty"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Weight"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Sale Price"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Shipping"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Order Type"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Status"})]})}),e.jsx("tbody",{children:m.map(r=>{var C;return r.giveaway?e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.giveaway.images&&r.giveaway.images[0]?e.jsx("img",{src:r.giveaway.images[0],alt:r.giveaway.name,className:"w-10 h-10 object-cover rounded"}):e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center",children:e.jsx(fe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.giveaway.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",r.invoice||r._id.slice(-8)]})]})]})}),e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:r.giveaway.description||"-"}),e.jsx("td",{className:"py-2 px-2",children:r.giveaway.quantity||1}),e.jsx("td",{className:"py-2 px-2",children:(C=r.giveaway.shipping_profile)!=null&&C.weight?`${r.giveaway.shipping_profile.weight} ${r.giveaway.shipping_profile.scale||""}`:"-"}),e.jsx("td",{className:"py-2 px-2",children:"$0.00"}),e.jsxs("td",{className:"py-2 px-2",children:["$",(r.shipping_fee||0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-2",children:"Giveaway"}),e.jsx("td",{className:"py-2 px-2 text-xs text-muted-foreground",children:r.date?new Date(r.date).toLocaleDateString():"-"}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${Qe[r.status]||"bg-gray-100 text-gray-800"}`,children:r.status||"unfulfilled"})})]},r._id):r.items&&r.items.length>0?r.items.map((P,Ge)=>{var me,Ds,Is,Fs;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[(me=P.productId)!=null&&me.images&&P.productId.images[0]?e.jsx("img",{src:P.productId.images[0],alt:P.productId.name,className:"w-10 h-10 object-cover rounded"}):e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center",children:e.jsx(fe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((Ds=P.productId)==null?void 0:Ds.name)||"Item"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",r.invoice||r._id.slice(-8)]})]})]})}),e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:((Fs=(Is=P.productId)==null?void 0:Is.category)==null?void 0:Fs.name)||"-"}),e.jsx("td",{className:"py-2 px-2",children:P.quantity||1}),e.jsx("td",{className:"py-2 px-2",children:P.weight?`${P.weight} ${P.scale||""}`:"-"}),e.jsxs("td",{className:"py-2 px-2",children:["$",(P.price||0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-2",children:["$",(P.shipping_fee||0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-2",children:r.tokshow?"Show":"Marketplace"}),e.jsx("td",{className:"py-2 px-2 text-xs text-muted-foreground",children:r.date?new Date(r.date).toLocaleDateString():"-"}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${Qe[r.status]||"bg-gray-100 text-gray-800"}`,children:r.status||"unfulfilled"})})]},`${r._id}-${Ge}`)}):null})})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-border flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Total orders: ",m.length]}),e.jsxs("span",{className:"font-medium text-foreground",children:["Total value: $",Ce.toFixed(2)]})]})]})})})]},t.id)}else{const t=s;return e.jsxs(gs.Fragment,{children:[e.jsxs("tr",{"data-testid":`row-shipment-${t._id}`,children:[e.jsx("td",{className:"px-3 py-3",children:e.jsx(je,{checked:j.includes(t._id),onCheckedChange:m=>ks(t._id,m),"data-testid":`checkbox-shipment-${t._id}`,disabled:t.status!=="processing",className:t.status!=="processing"?"opacity-50 cursor-not-allowed":""})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>Cs(t._id),className:"p-1 h-5 w-5 mr-1","data-testid":`button-expand-${t._id}`,children:o.includes(t._id)?e.jsx(js,{size:12}):e.jsx(Vs,{size:12})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center",children:[t.status==="delivered"&&e.jsx("div",{className:"text-xs bg-accent text-accent-foreground px-1 rounded mr-1",children:"NEW"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[((Ee=t.customer)==null?void 0:Ee.firstName)||"Unknown"," ",((ve=t.customer)==null?void 0:ve.lastName)||""]})]})})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:t.createdAt?We(new Date(t.createdAt),"MMM dd, yyyy"):We(new Date(t.date||0),"MMM dd, yyyy")})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-sm text-foreground font-medium",children:t.giveaway?1:((we=t.items)==null?void 0:we.length)||0})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["$",t.giveaway?((t.total||0)+(t.tax||0)+(t.shipping_fee||0)).toFixed(2):t.items&&t.items.length>0?(t.items.reduce((F,ke)=>{const Ce=ke.quantity||0,r=ke.price||0;return F+Ce*r},0)+(t.tax||0)+(t.shipping_fee||0)).toFixed(2):"0.00"]})})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("div",{className:"text-xs",children:(J=(de=t.giveaway)==null?void 0:de.shipping_profile)!=null&&J.weight?`${t.giveaway.shipping_profile.weight}${t.giveaway.shipping_profile.scale||"oz"}`:t.items&&t.items.length>0&&t.items[0].weight?`${t.items[0].weight}${t.items[0].scale||"oz"}`:"-"}),e.jsx("div",{className:"text-xs",children:t.giveaway?"Giveaway":t.items&&t.items.length>0&&t.items[0].height&&t.items[0].width&&t.items[0].length?`${t.items[0].height}×${t.items[0].width}×${t.items[0].length}"`:"-"})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{children:[e.jsx($e,{className:`${Qe[t.status]} text-xs`,"data-testid":`shipment-status-${t.status}`,children:t.status==="delivered"?"Delivered":t.status?t.status.replaceAll("_"," ").charAt(0).toUpperCase()+t.status.replaceAll("_"," ").slice(1):"Unknown"}),t.tracking_number&&e.jsx("div",{className:"text-xs text-primary font-mono mt-1 cursor-pointer hover:bg-primary/10 px-1 py-0.5 rounded transition-colors",onClick:()=>{navigator.clipboard.writeText(t.tracking_number),b({title:"Copied!",description:"Tracking number copied to clipboard"})},title:"Click to copy tracking number","data-testid":`tracking-number-${t._id}`,children:t.tracking_number})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(Ks,{children:[e.jsx(Qs,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm","data-testid":`button-order-menu-${t._id}`,children:e.jsx(Gs,{size:16})})}),e.jsxs(Rs,{align:"end",children:[!t.giveaway&&t.items&&t.items.length>1&&e.jsxs(Z,{onClick:()=>{ye(t._id),ie(!0)},"data-testid":`menu-unbundle-${t._id}`,children:[e.jsx(Hs,{size:14,className:"mr-2"}),"View & Unbundle"]}),t.status==="processing"&&e.jsx(Zs,{order:t,currentTab:h,children:e.jsxs(Z,{onSelect:m=>m.preventDefault(),children:[e.jsx(Gt,{size:14,className:"mr-2"}),"Edit Shipment"]})}),t.status==="ready_to_ship"&&e.jsxs(Z,{onClick:()=>xs.mutate(t._id),disabled:xs.isPending,"data-testid":`menu-ship-${t._id}`,children:[e.jsx(Js,{size:14,className:"mr-2"}),xs.isPending?"Shipping...":"Mark as Shipped"]}),t.tracking_number&&e.jsxs(Z,{onClick:()=>{const m=t.label??t.shipping_label_url??t.tracking_link;m?window.open(m,"_blank"):b({title:"No label found",description:"This order doesn't have a shipping label yet.",variant:"destructive"})},"data-testid":`menu-print-${t._id}`,children:[e.jsx(Je,{size:14,className:"mr-2"}),"Print Label"]}),(t.tracking_number||t.tracking_url)&&e.jsxs(Z,{onClick:()=>{le(t),G(!0)},"data-testid":`menu-shipment-details-${t._id}`,children:[e.jsx(fe,{size:14,className:"mr-2"}),"Shipment Details"]}),T(t)&&e.jsxs(e.Fragment,{children:[e.jsx(Ws,{}),e.jsxs(Os,{onOpenChange:m=>{m||(i(null),y(!1))},children:[e.jsx(Ts,{asChild:!0,children:e.jsxs(Z,{onSelect:m=>m.preventDefault(),className:"text-red-600","data-testid":`menu-cancel-${t._id}`,onClick:()=>i(t._id),children:[e.jsx(Ps,{size:14,className:"mr-2"}),"Cancel Order"]})}),e.jsxs(zs,{children:[e.jsxs(Bs,{children:[e.jsx(As,{children:"Cancel Order"}),e.jsxs(qs,{children:["Are you sure you want to cancel order #",t.invoice||t._id.slice(-8),"? This action cannot be undone."]})]}),e.jsxs("div",{className:"flex items-center space-x-2 my-4",children:[e.jsx(je,{id:`relist-${t._id}`,checked:u,onCheckedChange:m=>y(m===!0),"data-testid":`checkbox-relist-${t._id}`}),e.jsx("label",{htmlFor:`relist-${t._id}`,className:"text-sm",children:"Relist this order for future processing"})]}),e.jsxs(Es,{children:[e.jsx(Ms,{onClick:()=>{i(null),y(!1)},"data-testid":`button-keep-order-${t._id}`,children:"Keep Order"}),e.jsx(Ls,{onClick:p,disabled:n.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50","data-testid":`button-confirm-cancel-${t._id}`,children:n.isPending?"Cancelling...":"Cancel Order"})]})]})]})]})]})]})})})]}),o.includes(t._id)&&e.jsx("tr",{className:"bg-muted/50","data-testid":`expanded-row-${t._id}`,children:e.jsx("td",{colSpan:7,className:"px-3 py-3",children:e.jsxs("div",{className:"bg-card rounded-lg p-4 border",children:[e.jsx("h4",{className:"font-medium text-sm mb-3 text-muted-foreground",children:"Items in this shipment:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Listing"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Description"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Qty"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Weight"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Sale Price"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Shipping"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Order Type"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-2 font-medium text-muted-foreground",children:"Status"})]})}),e.jsx("tbody",{children:t.giveaway?e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.giveaway.images&&t.giveaway.images[0]?e.jsx("img",{src:t.giveaway.images[0],alt:t.giveaway.name,className:"w-10 h-10 object-cover rounded"}):e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center",children:e.jsx(fe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.giveaway.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",t.invoice||t._id.slice(-8)]})]})]})}),e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:t.giveaway.description||"-"}),e.jsx("td",{className:"py-2 px-2",children:t.giveaway.quantity||1}),e.jsx("td",{className:"py-2 px-2",children:(H=t.giveaway.shipping_profile)!=null&&H.weight?`${t.giveaway.shipping_profile.weight} ${t.giveaway.shipping_profile.scale||""}`:"-"}),e.jsx("td",{className:"py-2 px-2",children:"$0.00"}),e.jsxs("td",{className:"py-2 px-2",children:["$",(t.shipping_fee||0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-2",children:"Giveaway"}),e.jsx("td",{className:"py-2 px-2 text-xs text-muted-foreground",children:t.date?new Date(t.date).toLocaleDateString():"-"}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${Qe[t.status]||"bg-gray-100 text-gray-800"}`,children:t.status||"unfulfilled"})})]}):t.items&&t.items.length>0?t.items.map((m,F)=>{var ke,Ce,r,C;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[(ke=m.productId)!=null&&ke.images&&m.productId.images[0]?e.jsx("img",{src:m.productId.images[0],alt:m.productId.name,className:"w-10 h-10 object-cover rounded"}):e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center",children:e.jsx(fe,{size:16,className:"text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((Ce=m.productId)==null?void 0:Ce.name)||"Item"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["#",t.invoice||t._id.slice(-8)]})]})]})}),e.jsx("td",{className:"py-2 px-2 text-muted-foreground",children:((C=(r=m.productId)==null?void 0:r.category)==null?void 0:C.name)||"-"}),e.jsx("td",{className:"py-2 px-2",children:m.quantity||1}),e.jsx("td",{className:"py-2 px-2",children:m.weight?`${m.weight} ${m.scale||""}`:"-"}),e.jsxs("td",{className:"py-2 px-2",children:["$",(m.price||0).toFixed(2)]}),e.jsxs("td",{className:"py-2 px-2",children:["$",(m.shipping_fee||0).toFixed(2)]}),e.jsx("td",{className:"py-2 px-2",children:t.tokshow?"Show":"Marketplace"}),e.jsx("td",{className:"py-2 px-2 text-xs text-muted-foreground",children:t.date?new Date(t.date).toLocaleDateString():"-"}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${Qe[t.status]||"bg-gray-100 text-gray-800"}`,children:t.status||"unfulfilled"})})]},`${t._id}-${F}`)}):e.jsx("tr",{className:"border-b",children:e.jsx("td",{colSpan:9,className:"py-4 px-2 text-center text-muted-foreground",children:"No items available"})})})]})}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-border flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Total items:"," ",(($s=t.items)==null?void 0:$s.reduce((m,F)=>m+(F.quantity||0),0))||1]}),e.jsxs("span",{className:"font-medium text-foreground",children:["Total value: $",((t.total||0)+(t.tax||0)+(t.shipping_fee||0)).toFixed(2)]})]})]})})})]},t._id)}})})]})})})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Rt,{currentPage:Q,totalPages:pt,totalItems:xt,itemsPerPage:te,itemsPerPageOptions:[10,20,50,100],onPageChange:ge,onItemsPerPageChange:De,showingText:"shipping items",className:"bg-white dark:bg-gray-950 rounded-lg border p-4"})}),e.jsx(sa,{open:V,onOpenChange:X,bundleOrders:Y?[A==null?void 0:A.find(s=>s._id===Y)].filter(Boolean):[],onUnbundle:kt,isPending:us.isPending}),e.jsx(ta,{open:N,onOpenChange:ie,order:R&&L.find(s=>s._id===R)||null,onUnbundle:Ne,isPending:$.isPending}),e.jsx(ct,{open:xe,onOpenChange:pe,orderCount:j.length,onConfirm:_t,isPending:_s.isPending}),e.jsx(aa,{open:ne,onOpenChange:G,order:E})]})})}export{Qa as default};
