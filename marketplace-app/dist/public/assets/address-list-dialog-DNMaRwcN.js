import{a as $,f as z,r as n,j as e,m as h,B as d,n as D}from"./index-FVTY5sKH.js";import{D as P,a as M,b as I,c as q}from"./dialog-A2pFZcsY.js";import{u as B}from"./useQuery-DsZx8GVA.js";import{AddAddressDialog as H}from"./add-address-dialog-M47ojcPW.js";import{M as C}from"./map-pin-jcALPDnh.js";import{C as R}from"./circle-check-B-MitUmb.js";import{T as K}from"./trash-2-CSnPCayR.js";import"./react-country-state-city-DuU_Cl-F.js";function Z({open:f,onOpenChange:o,onSuccess:p}){const{user:a,refreshUserData:c}=$(),{toast:r}=z(),[S,l]=n.useState(!1),[_,g]=n.useState(null),[j,N]=n.useState(null),[y,v]=n.useState(null),m=(a==null?void 0:a._id)||(a==null?void 0:a.id),{data:w,isLoading:u,refetch:x}=B({queryKey:[`/api/address/all/${m}`],enabled:!!m&&f}),E=s=>{g(s),l(!0)},k=()=>{g(null),l(!0)},F=async()=>{l(!1),await x(),await c()},T=async s=>{if(a){v(s);try{await D("PATCH",`/api/address/${s}`,{primary:!0,userId:m}),r({title:"Default Address Set",description:"This address is now your default."}),await x(),await c()}catch(t){console.error("Failed to set default address:",t);let i="Failed to set default address. Please try again.";t!=null&&t.message&&(i=t.message),r({title:"Error",description:i,variant:"destructive"})}finally{v(null)}}},L=async s=>{if(a){N(s);try{await D("DELETE",`/api/address/${s}`,{}),r({title:"Address Deleted",description:"Your address has been removed."}),await x(),await c()}catch(t){console.error("Failed to delete address:",t);let i="Failed to delete address. Please try again.";t!=null&&t.message&&(i=t.message),r({title:"Error",description:i,variant:"destructive"})}finally{N(null)}}},b=Array.isArray(w)?w:[],A=b.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(P,{open:f,onOpenChange:o,children:e.jsxs(M,{className:"sm:max-w-[500px]","data-testid":"dialog-addresses",children:[e.jsx(I,{children:e.jsx(q,{children:"Shipping Addresses"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[u&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-8 w-8 mx-auto mb-3 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading addresses..."})]}),!u&&A&&b.map(s=>e.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-4 bg-muted/30",children:[e.jsx(C,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[s.primary&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),e.jsx("p",{className:"font-medium text-sm",children:"Default Address"})]}),e.jsx("p",{className:"text-sm font-medium",children:s.name||"Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.addrress1||s.address1}),s.addrress2&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.addrress2}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.city,", ",s.state," ",s.zipcode||s.zip]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.countryCode}),s.phone&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Phone: ",s.phone]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>E(s),className:"h-7 text-xs","data-testid":`button-edit-address-${s._id}`,children:"Edit"}),!s.primary&&e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>T(s._id),disabled:y===s._id,className:"h-7 text-xs","data-testid":`button-set-default-address-${s._id}`,children:y===s._id?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-3 w-3 mr-1 animate-spin"}),"Setting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Set as Default"]})})]})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>L(s._id),disabled:j===s._id,className:"text-destructive hover:text-destructive hover:bg-destructive/10","data-testid":`button-delete-address-${s._id}`,children:j===s._id?e.jsx(h,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"})})]},s._id)),!u&&!A&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No addresses added yet"})]}),e.jsx("button",{onClick:k,className:"text-sm text-primary hover:underline","data-testid":"link-add-new-address",children:"Add new shipping address"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{variant:"default",className:"flex-1 bg-secondary text-secondary-foreground rounded-full",onClick:()=>o(!1),"data-testid":"button-cancel-address-list",children:"Cancel"}),e.jsx(d,{variant:"default",className:"flex-1 bg-primary text-primary-foreground rounded-full",onClick:()=>{o(!1),p&&p()},"data-testid":"button-save-address-list",children:"Save"})]})]})}),e.jsx(H,{open:S,onOpenChange:l,onSuccess:F,address:_})]})}export{Z as AddressListDialog,Z as default};
