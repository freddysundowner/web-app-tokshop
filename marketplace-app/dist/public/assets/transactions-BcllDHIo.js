import{a as U,r as m,j as e,I as V,B as c,X as C}from"./index-FVTY5sKH.js";import{u as F}from"./useQuery-DsZx8GVA.js";import{C as K,a as O,d as Q,c as W,b as X}from"./card-CF4CqaN2.js";import{T as G,a as J,b as S,c as x,d as Y,e as u}from"./table-BQRAvstp.js";import{B as T}from"./badge-BTf7a5Ku.js";import{S as Z,a as D,b as ee,c as se,d as p}from"./select-D3ZFUKhx.js";import{D as te,a as ae,b as re,c as ne}from"./dialog-A2pFZcsY.js";import{C as R}from"./credit-card-BDFvtuhf.js";import{S as ie}from"./search-zDcbIzzp.js";import{E as le}from"./eye-BQkOkbVm.js";import{C as ce}from"./chevron-left-CnSIvoVj.js";import{C as de}from"./chevron-right-HRo85rGP.js";import{P as oe}from"./printer-DfjmthyX.js";import"./index-BdQq_4o_.js";import"./index-BaZiuLT8.js";import"./index-Cbw5mxKQ.js";import"./chevron-down-BD1mluAZ.js";import"./check-DWjWNqF1.js";import"./chevron-up-D8QnUA5s.js";function Pe(){const{user:me}=U(),[d,g]=m.useState(""),[l,k]=m.useState("all"),[o,f]=m.useState(1),[r,z]=m.useState(null),[P,j]=m.useState(!1),A=20,b=s=>{k(s),f(1)},{data:a,isLoading:L}=F({queryKey:["user-transactions",o,l],queryFn:async()=>{const s=new URLSearchParams({page:o.toString(),limit:A.toString()});l&&l!=="all"&&s.append("status",l);const t=await fetch(`/api/user/transactions?${s.toString()}`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch transactions");const n=await t.json();return n.success?n.data:n}}),{data:i}=F({queryKey:["public-settings"],queryFn:async()=>{const s=await fetch("/api/public/settings",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch settings");const t=await s.json();return t.success?t.data:t}}),_=(a==null?void 0:a.transactions)||(a==null?void 0:a.data)||[],h=(a==null?void 0:a.pages)||(a==null?void 0:a.totalPages)||1,$=(a==null?void 0:a.total)||(a==null?void 0:a.totalRecords)||0,E=(i==null?void 0:i.support_email)||"",B=(i==null?void 0:i.stripe_fee)||"0",M=(i==null?void 0:i.extra_charges)||"0",v=_.filter(s=>{var n,y,w;if(!d)return!0;const t=d.toLowerCase();return((n=s._id)==null?void 0:n.toLowerCase().includes(t))||((y=s.type)==null?void 0:y.toLowerCase().includes(t))||((w=s.status)==null?void 0:w.toLowerCase().includes(t))}),H=s=>{z(s),j(!0)},N=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},I=s=>{const n={completed:{label:"Completed",variant:"default"},pending:{label:"Pending",variant:"secondary"},failed:{label:"Failed",variant:"destructive"},refunded:{label:"Refunded",variant:"outline"}}[s==null?void 0:s.toLowerCase()]||{label:s||"Unknown",variant:"outline"};return e.jsx(T,{variant:n.variant,"data-testid":`badge-status-${s}`,children:n.label})},q=s=>{const n={payment:{label:"Payment",variant:"default"},refund:{label:"Refund",variant:"secondary"},payout:{label:"Payout",variant:"outline"}}[s==null?void 0:s.toLowerCase()]||{label:s||"Unknown",variant:"outline"};return e.jsx(T,{variant:n.variant,children:n.label})};return e.jsxs("div",{className:"py-4 sm:py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2","data-testid":"text-transactions-title",children:[e.jsx(R,{className:"h-5 w-5 sm:h-6 sm:w-6"}),"My Transactions"]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-muted-foreground",children:"View your transaction history and receipts"})]}),e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Transaction History"}),e.jsx(W,{children:"All your payments, refunds, and payouts"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1 sm:flex-initial sm:w-64",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(V,{placeholder:"Search transactions...",value:d,onChange:s=>g(s.target.value),className:"pl-9 pr-9","data-testid":"input-search"}),d&&e.jsx(c,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>g(""),"data-testid":"button-clear-search",children:e.jsx(C,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs(Z,{value:l,onValueChange:b,children:[e.jsx(D,{className:"w-full sm:w-[180px]","data-testid":"select-status-filter",children:e.jsx(ee,{placeholder:"Filter by status"})}),e.jsxs(se,{children:[e.jsx(p,{value:"all",children:"All Status"}),e.jsx(p,{value:"completed",children:"Completed"}),e.jsx(p,{value:"pending",children:"Pending"}),e.jsx(p,{value:"failed",children:"Failed"}),e.jsx(p,{value:"refunded",children:"Refunded"})]})]}),l!=="all"&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>b("all"),"data-testid":"button-clear-filter",className:"w-full sm:w-auto",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Clear Filter"]})]})]})}),e.jsx(X,{children:L?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:d||l!=="all"?"No transactions found":"No transactions yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(S,{children:[e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Amount"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Y,{children:v.map(s=>e.jsxs(S,{"data-testid":`row-transaction-${s._id}`,children:[e.jsx(u,{className:"font-medium",children:N(s.createdAt)}),e.jsx(u,{children:q(s.type)}),e.jsx(u,{children:I(s.status)}),e.jsxs(u,{className:"text-right font-medium",children:["$",(parseFloat(s.amount)||0).toFixed(2)]}),e.jsx(u,{className:"text-right",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>H(s),"data-testid":`button-view-receipt-${s._id}`,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Receipt"]})})]},s._id))})]})}),h>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Showing page ",o," of ",h," (",$," total)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>f(s=>Math.max(1,s-1)),disabled:o===1,"data-testid":"button-prev-page",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>f(s=>Math.min(h,s+1)),disabled:o===h,"data-testid":"button-next-page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx(de,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(te,{open:P,onOpenChange:j,children:e.jsxs(ae,{className:"max-w-md",children:[e.jsx(re,{children:e.jsx(ne,{children:"Transaction Receipt"})}),r&&e.jsxs("div",{id:"receipt-content-user-transactions",className:"space-y-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Receipt"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Transaction ID: ",e.jsx("span",{className:"font-mono",children:r._id})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N(r.createdAt)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:r.type||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize",children:r.status||"N/A"})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total:"}),e.jsxs("span",{children:["$",(parseFloat(r.total)||0).toFixed(2)]})]}),(()=>{const s=parseFloat(r.stripe_fee)||0,t=parseFloat(r.extra_charges)||0,n=s+t;return n>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Service Charge (",B,"% + ",M,"%):"]}),e.jsxs("span",{className:"text-destructive",children:["-$",n.toFixed(2)]})]})})(),r.serviceFee&&parseFloat(r.serviceFee)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Service Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",parseFloat(r.serviceFee).toFixed(2)]})]}),r.shippingFee&&parseFloat(r.shippingFee)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",parseFloat(r.shippingFee).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Amount:"}),e.jsxs("span",{children:["$",(parseFloat(r.amount)||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground border-t pt-4",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsxs("p",{children:["For support, please contact ",E]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>j(!1),"data-testid":"button-close-receipt",children:"Close"}),e.jsxs(c,{onClick:()=>{const s=document.getElementById("receipt-content-user-transactions");if(s){const t=window.open("","_blank");t&&(t.document.write(`
                      <html>
                        <head>
                          <title>Receipt</title>
                          <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .space-y-4 > * + * { margin-top: 1rem; }
                            .space-y-2 > * + * { margin-top: 0.5rem; }
                            .flex { display: flex; }
                            .justify-between { justify-content: space-between; }
                            .items-center { align-items: center; }
                            .text-center { text-align: center; }
                            .border-b { border-bottom: 1px solid #ddd; padding-bottom: 1rem; }
                            .border-t { border-top: 1px solid #ddd; padding-top: 1rem; }
                            .text-muted-foreground { color: #666; }
                            .font-mono { font-family: monospace; }
                            .font-bold { font-weight: bold; }
                            .font-medium { font-weight: 500; }
                            .text-lg { font-size: 1.125rem; }
                            .text-2xl { font-size: 1.5rem; }
                            .text-xs { font-size: 0.75rem; }
                            .text-sm { font-size: 0.875rem; }
                            .capitalize { text-transform: capitalize; }
                            .text-destructive { color: #dc2626; }
                          </style>
                        </head>
                        <body>
                          ${s.innerHTML}
                        </body>
                      </html>
                    `),t.document.close(),t.print())}},"data-testid":"button-print",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})})]})}export{Pe as default};
