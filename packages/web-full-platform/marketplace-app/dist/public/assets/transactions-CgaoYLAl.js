import{a as V,r as u,d as F,j as e,B as c,X as S}from"./index-GnvmivW0.js";import{C as K,a as O,c as Q,d as W,b as X}from"./card-Bsqf9o7h.js";import{T as G,a as J,b as T,c as p,d as Y,e as h}from"./table-DMJOUqQh.js";import{B as P}from"./badge-CL9MXKGS.js";import{I as Z}from"./input-CDJz7BeV.js";import{S as D,a as ee,b as se,c as te,d as f}from"./select-EUq1_viI.js";import{D as ae,a as re,b as ne,c as ie}from"./dialog-D1L4tMGI.js";import{C as R}from"./credit-card-B0WsppBV.js";import{S as le}from"./search-DE1AZ4db.js";import{E as ce}from"./eye-MrtS8r4d.js";import{C as oe}from"./chevron-left-BnuQCvWV.js";import{C as de}from"./chevron-right-CXw-mF7y.js";import{P as me}from"./printer-Cmv9hO84.js";import"./index-BdQq_4o_.js";import"./index-CmYyiKyk.js";import"./index-Vue-pIA6.js";import"./chevron-down-tcDKR_mK.js";import"./check-DoxmrmEj.js";import"./chevron-up-Cda9uppk.js";function Ae(){const{user:xe}=V(),[o,v]=u.useState(""),[l,k]=u.useState("all"),[d,g]=u.useState(1),[r,z]=u.useState(null),[A,b]=u.useState(!1),L=20,N=s=>{k(s),g(1)},{data:a,isLoading:$}=F({queryKey:["user-transactions",d,l],queryFn:async()=>{const s=new URLSearchParams({page:d.toString(),limit:L.toString()});l&&l!=="all"&&s.append("status",l);const t=await fetch(`/api/user/transactions?${s.toString()}`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch transactions");const n=await t.json();return n.success?n.data:n}}),{data:i}=F({queryKey:["public-settings"],queryFn:async()=>{const s=await fetch("/api/public/settings",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch settings");const t=await s.json();return t.success?t.data:t}}),_=(a==null?void 0:a.transactions)||(a==null?void 0:a.data)||[],j=(a==null?void 0:a.pages)||(a==null?void 0:a.totalPages)||1,E=(a==null?void 0:a.total)||(a==null?void 0:a.totalRecords)||0,B=(i==null?void 0:i.support_email)||"",M=(i==null?void 0:i.stripe_fee)||"0",H=(i==null?void 0:i.extra_charges)||"0",y=_.filter(s=>{var n,m,x;if(!o)return!0;const t=o.toLowerCase();return((n=s._id)==null?void 0:n.toLowerCase().includes(t))||((m=s.type)==null?void 0:m.toLowerCase().includes(t))||((x=s.status)==null?void 0:x.toLowerCase().includes(t))}),I=s=>{z(s),b(!0)},w=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},q=s=>{const n={completed:{label:"Completed",variant:"default"},pending:{label:"Pending",variant:"secondary"},failed:{label:"Failed",variant:"destructive"},refunded:{label:"Refunded",variant:"outline"}}[s==null?void 0:s.toLowerCase()]||{label:s||"Unknown",variant:"outline"};return e.jsx(P,{variant:n.variant,"data-testid":`badge-status-${s}`,children:n.label})},U=s=>{const n={payment:{label:"Payment",variant:"default"},refund:{label:"Refund",variant:"secondary"},payout:{label:"Payout",variant:"outline"}}[s==null?void 0:s.toLowerCase()]||{label:s||"Unknown",variant:"outline"};return e.jsx(P,{variant:n.variant,children:n.label})};return e.jsxs("div",{className:"py-4 sm:py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2","data-testid":"text-transactions-title",children:[e.jsx(R,{className:"h-5 w-5 sm:h-6 sm:w-6"}),"My Transactions"]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-muted-foreground",children:"View your transaction history and receipts"})]}),e.jsxs(K,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Transaction History"}),e.jsx(W,{children:"All your payments, refunds, and payouts"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1 sm:flex-initial sm:w-64",children:[e.jsx(le,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search transactions...",value:o,onChange:s=>v(s.target.value),className:"pl-9 pr-9","data-testid":"input-search"}),o&&e.jsx(c,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>v(""),"data-testid":"button-clear-search",children:e.jsx(S,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs(D,{value:l,onValueChange:N,children:[e.jsx(ee,{className:"w-full sm:w-[180px]","data-testid":"select-status-filter",children:e.jsx(se,{placeholder:"Filter by status"})}),e.jsxs(te,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"completed",children:"Completed"}),e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"failed",children:"Failed"}),e.jsx(f,{value:"refunded",children:"Refunded"})]})]}),l!=="all"&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>N("all"),"data-testid":"button-clear-filter",className:"w-full sm:w-auto",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Clear Filter"]})]})]})}),e.jsx(X,{children:$?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:o||l!=="all"?"No transactions found":"No transactions yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(T,{children:[e.jsx(p,{children:"Date"}),e.jsx(p,{children:"Type"}),e.jsx(p,{children:"Status"}),e.jsx(p,{className:"text-right",children:"Amount"}),e.jsx(p,{className:"text-right",children:"Actions"})]})}),e.jsx(Y,{children:y.map(s=>e.jsxs(T,{"data-testid":`row-transaction-${s._id}`,children:[e.jsx(h,{className:"font-medium",children:w(s.createdAt)}),e.jsx(h,{children:U(s.type)}),e.jsx(h,{children:q(s.status)}),e.jsxs(h,{className:"text-right font-medium",children:["$",(parseFloat(s.amount)||0).toFixed(2)]}),e.jsx(h,{className:"text-right",children:e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>I(s),"data-testid":`button-view-receipt-${s._id}`,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Receipt"]})})]},s._id))})]})}),j>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Showing page ",d," of ",j," (",E," total)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.max(1,s-1)),disabled:d===1,"data-testid":"button-prev-page",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.min(j,s+1)),disabled:d===j,"data-testid":"button-next-page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx(de,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(ae,{open:A,onOpenChange:b,children:e.jsxs(re,{className:"max-w-md",children:[e.jsx(ne,{children:e.jsx(ie,{children:"Transaction Receipt"})}),r&&e.jsxs("div",{id:"receipt-content-user-transactions",className:"space-y-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Receipt"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Transaction ID: ",e.jsx("span",{className:"font-mono",children:r._id})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w(r.createdAt)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:r.type||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize",children:r.status||"N/A"})]})]}),e.jsx("div",{className:"border-t pt-4 space-y-2 text-sm",children:(()=>{if(!(r.type==="sale"||r.type==="purchase"||r.type==="order"))return e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[e.jsx("span",{children:"Amount:"}),e.jsxs("span",{children:["$",(parseFloat(r.amount)||0).toFixed(2)]})]});const t=parseFloat(r.stripe_fee)||0,n=parseFloat(r.extra_charges)||0,m=parseFloat(r.serviceFee)||0,x=parseFloat(r.shippingFee)||0,C=t+n;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total:"}),e.jsxs("span",{children:["$",(parseFloat(r.total)||0).toFixed(2)]})]}),C>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Service Charge (",M,"% + ",H,"%):"]}),e.jsxs("span",{className:"text-destructive",children:["-$",C.toFixed(2)]})]}),m>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Service Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",m.toFixed(2)]})]}),x>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",x.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Amount:"}),e.jsxs("span",{children:["$",(parseFloat(r.amount)||0).toFixed(2)]})]})]})})()}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground border-t pt-4",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsxs("p",{children:["For support, please contact ",B]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>b(!1),"data-testid":"button-close-receipt",children:"Close"}),e.jsxs(c,{onClick:()=>{const s=document.getElementById("receipt-content-user-transactions");if(s){const t=window.open("","_blank");t&&(t.document.write(`
                      <html>
                        <head>
                          <title>Receipt</title>
                          <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .space-y-4 > * + * { margin-top: 1rem; }
                            .space-y-2 > * + * { margin-top: 0.5rem; }
                            .flex { display: flex; }
                            .justify-between { justify-content: space-between; }
                            .items-center { align-items: center; }
                            .text-center { text-align: center; }
                            .border-b { border-bottom: 1px solid #ddd; padding-bottom: 1rem; }
                            .border-t { border-top: 1px solid #ddd; padding-top: 1rem; }
                            .text-muted-foreground { color: #666; }
                            .font-mono { font-family: monospace; }
                            .font-bold { font-weight: bold; }
                            .font-medium { font-weight: 500; }
                            .text-lg { font-size: 1.125rem; }
                            .text-2xl { font-size: 1.5rem; }
                            .text-xs { font-size: 0.75rem; }
                            .text-sm { font-size: 0.875rem; }
                            .capitalize { text-transform: capitalize; }
                            .text-destructive { color: #dc2626; }
                          </style>
                        </head>
                        <body>
                          ${s.innerHTML}
                        </body>
                      </html>
                    `),t.document.close(),t.print())}},"data-testid":"button-print",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})})]})}export{Ae as default};
