import{a as E,b as I,d as y,j as e,e as F,L as i,r as v,a8 as Y,B as P}from"./index-GnvmivW0.js";import{u as z}from"./useInfiniteQuery-BODxHCl1.js";import{G as R}from"./globe-B-ijZil2.js";import{u as T,g as H}from"./use-api-config-kum11Yvc.js";import{S as N}from"./show-card-DLyViQGC.js";import{P as Q}from"./product-card-BswFql_j.js";import{A as G}from"./auction-card-RSd_wyBe.js";import{C as S}from"./chevron-right-CXw-mF7y.js";import"./avatar-T6GBhCEI.js";import"./user-badge-QQMJS_dE.js";import"./circle-check-big-CLZG244L.js";import"./star-Dvv0yNqt.js";import"./en-US-Cc-9gH5A.js";import"./isTomorrow-DSpd_Oy4.js";import"./constructNow-BkTMlMS8.js";import"./isSameDay-bd8GA9bu.js";import"./format-Crz72tIO.js";import"./card-Bsqf9o7h.js";import"./badge-CL9MXKGS.js";import"./package-DWwkENv3.js";import"./clock-C8Dw1EBc.js";function V({selectedCategory:c,onCategoryChange:o,categories:n=[]}){const{user:r}=E(),{settings:h,theme:p}=I(),u=(r==null?void 0:r._id)||(r==null?void 0:r.id),{data:l}=y({queryKey:[`/api/profile/${u}`],enabled:!!u,staleTime:0}),a=l||r,g=(a==null?void 0:a.userName)||(a==null?void 0:a.firstName)||"User",f=new Date().getFullYear(),j=p.seo_title||p.app_name||h.app_name||"App";return e.jsxs("aside",{className:"hidden lg:flex lg:flex-col w-64 bg-background border-r border-border/40 h-full flex-shrink-0","data-testid":"sidebar-marketplace",children:[e.jsx("div",{className:"px-4 pt-8 pb-6",children:e.jsxs("h2",{className:"text-[28px] leading-tight font-bold text-foreground break-words","data-testid":"text-greeting",children:["Hello ",g,"!"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4",children:[e.jsx("button",{onClick:()=>o("For You"),className:F("text-left py-2.5 text-base transition-colors w-full",c==="For You"?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":"category-for-you",children:"For You"}),n.map(d=>e.jsx("button",{onClick:()=>o(d.name),className:F("text-left py-2.5 text-base transition-colors w-full",c===d.name?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":`category-${d._id}`,children:d.name},d._id))]}),e.jsxs("div",{className:"px-4 pb-8 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-[13px] text-muted-foreground",children:[e.jsx(i,{href:"/knowledge-base","data-testid":"link-knowledge-base",children:e.jsx("span",{className:"cursor-pointer",children:"Knowledge Base"})}),e.jsx(i,{href:"/privacy-policy","data-testid":"link-privacy",children:e.jsx("span",{className:"cursor-pointer",children:"Privacy"})}),e.jsx(i,{href:"/terms-of-service","data-testid":"link-terms",children:e.jsx("span",{className:"cursor-pointer",children:"Terms"})}),e.jsx(i,{href:"/contact","data-testid":"link-contact",children:e.jsx("span",{className:"cursor-pointer",children:"Contact"})}),e.jsx(i,{href:"/faq","data-testid":"link-faq",children:e.jsx("span",{className:"cursor-pointer",children:"FAQ"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[13px] text-muted-foreground pt-2",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{"data-testid":"text-language",children:"British English"})]}),e.jsxs("div",{className:"text-[13px] text-muted-foreground pt-1",children:["Â© ",f," ",j," Inc."]})]})]})}function O(){const{theme:c}=I(),{externalApiUrl:o}=T(),n=c.seo_title||c.app_name||"App",r=H(c.app_logo||c.header_logo,o);return e.jsx("footer",{className:"border-t border-border py-12 bg-muted/20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-8",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-6 text-sm text-muted-foreground",children:[e.jsx(i,{href:"/privacy-policy",className:"hover:text-foreground transition-colors","data-testid":"link-privacy",children:"Privacy Policy"}),e.jsx(i,{href:"/terms-of-service",className:"hover:text-foreground transition-colors","data-testid":"link-terms",children:"Terms of Service"}),e.jsx(i,{href:"/contact",className:"hover:text-foreground transition-colors","data-testid":"link-contact",children:"Contact"}),e.jsx(i,{href:"/faq",className:"hover:text-foreground transition-colors","data-testid":"link-faq",children:"FAQ"}),e.jsx(i,{href:"/help-center",className:"hover:text-foreground transition-colors","data-testid":"link-help-center",children:"Help Center"})]}),e.jsx("div",{className:"flex items-center justify-center",children:r?e.jsx("img",{src:r,alt:n,className:"h-8 w-auto object-contain","data-testid":"img-footer-logo"}):e.jsx("div",{className:"h-6 w-6 bg-black rounded-full flex items-center justify-center p-1",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"text-primary",children:e.jsx("path",{d:"M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"})})})})]})})})}function ge(){var $;const{settings:c}=I(),{user:o}=E(),[n,r]=v.useState("For You");Y("Live Shows");const{data:h}=y({queryKey:["/api/categories"],queryFn:()=>fetch("/api/categories").then(s=>s.json())}),p=(h==null?void 0:h.categories)||[],u=[{id:"for-you",label:"For You",categoryId:null},...p.map(s=>({id:s._id,label:s.name,categoryId:s._id}))],l=(o==null?void 0:o._id)||(o==null?void 0:o.id),a=u.find(s=>s.label===n),{data:g}=y({queryKey:["/api/products","trending","buy_now"],queryFn:async()=>{const s=new URLSearchParams({saletype:"buy_now",status:"active",limit:"10",sortBy:"views",featured:"true"});return(await fetch(`/api/products?${s.toString()}`)).json()}}),{data:f}=y({queryKey:["/api/products","trending","auction"],queryFn:async()=>{const s=new URLSearchParams({saletype:"auction",status:"active",limit:"10",sortBy:"views",featured:"true",type:"scheduled"});return(await fetch(`/api/products?${s.toString()}`)).json()}}),j=(g==null?void 0:g.products)||[],d=(f==null?void 0:f.products)||[],{data:w}=y({queryKey:["/api/rooms","featured",n,l],queryFn:async()=>{const t=["page=1","live=","featured=true","ownerUsername=","limit=15",`category=${(a==null?void 0:a.categoryId)||""}`,"userid=",`currentUserId=${l||""}`,"title=","status=active"].join("&");return(await fetch(`/api/rooms?${t}`)).json()}}),q=(w==null?void 0:w.rooms)||[],{data:k,fetchNextPage:C,hasNextPage:L,isFetchingNextPage:_,isLoading:M,refetch:b}=z({queryKey:["/api/rooms",n],queryFn:async({pageParam:s=1})=>{const x=[`page=${s}`,"limit=15",`category=${(a==null?void 0:a.categoryId)||"all"}`,"userid=",`currentUserId=${l||""}`,"title=","status=active"].join("&");return(await fetch(`/api/rooms?${x}`)).json()},getNextPageParam:(s,t)=>{const x=t.length,A=s.totalDoc||0,B=Math.max(s.limits||20,1),K=Math.ceil(A/B);return x<K?x+1:void 0},initialPageParam:1});v.useEffect(()=>{const s=()=>{document.hidden||(console.log("ðŸ“± Page visible - refreshing shows..."),b())},t=()=>{console.log("ðŸ“± Window focused - refreshing shows..."),b()};return document.addEventListener("visibilitychange",s),window.addEventListener("focus",t),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("focus",t)}},[b]),v.useEffect(()=>{console.log("ðŸ“± Homepage mounted - refreshing shows..."),b()},[]);const m=(($=k==null?void 0:k.pages)==null?void 0:$.flatMap(s=>s.rooms||[]))||[],U=v.useRef(null);return v.useEffect(()=>{const s=new IntersectionObserver(x=>{x[0].isIntersecting&&L&&!_&&C()},{threshold:0,rootMargin:"100px"}),t=U.current;return t&&s.observe(t),()=>{t&&s.unobserve(t)}},[L,_,C]),e.jsxs("div",{className:"flex flex-col h-screen bg-background","data-testid":"page-marketplace",children:[e.jsx("div",{className:"lg:hidden bg-white dark:bg-background sticky top-0 z-10 border-b border-border/50",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide","data-testid":"tabs-container-mobile",children:u.map(s=>e.jsxs("button",{onClick:()=>r(s.label),className:F("px-3 py-3.5 text-sm whitespace-nowrap flex-shrink-0 relative transition-colors",n===s.label?"text-primary font-semibold":"text-foreground font-normal"),"data-testid":`tab-${s.id}`,children:[s.label,n===s.label&&e.jsx("div",{className:"absolute bottom-0 left-3 right-3 h-0.5 bg-foreground dark:bg-primary rounded-full"})]},s.id))})}),e.jsx("div",{className:"flex flex-1 overflow-hidden h-full justify-center",children:e.jsxs("div",{className:"flex w-full lg:w-[90%] h-full",children:[e.jsx(V,{selectedCategory:n,onCategoryChange:r,categories:p}),e.jsxs("main",{className:"flex-1 overflow-y-auto scrollbar-hide bg-white dark:bg-background w-full h-full",children:[e.jsx("div",{className:"w-full px-2 py-3 lg:p-6 space-y-6",children:M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading shows..."})}):e.jsxs(e.Fragment,{children:[q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Featured Shows"}),e.jsx(i,{href:"/featured/shows",children:e.jsxs(P,{variant:"ghost",size:"sm",className:"text-primary",children:["See all ",e.jsx(S,{className:"h-4 w-4 ml-1"})]})})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide pb-2","data-testid":"featured-shows-carousel",children:q.map(s=>e.jsx("div",{className:"flex-shrink-0 w-52 sm:w-60",children:e.jsx(N,{show:s,currentUserId:l||"",variant:"grid"})},s._id||s.id))})]}),m.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Live Shows"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4","data-testid":"grid-giveaways",children:m.slice(0,12).map(s=>e.jsx(N,{show:s,currentUserId:l||"",variant:"grid"},s._id||s.id))})]}),j.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Trending Products"}),e.jsx(i,{href:"/trending/products",children:e.jsxs(P,{variant:"ghost",size:"sm",className:"text-primary",children:["See all ",e.jsx(S,{className:"h-4 w-4 ml-1"})]})})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide pb-2",children:j.map(s=>e.jsx(Q,{product:s,layout:"carousel"},s._id||s.id))})]}),m.slice(12,24).length>0&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4",children:m.slice(12,24).map(s=>e.jsx(N,{show:s,currentUserId:l||"",variant:"grid"},s._id||s.id))}),d.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Trending Auctions"}),e.jsx(i,{href:"/deals",children:e.jsxs(P,{variant:"ghost",size:"sm",className:"text-primary",children:["See all ",e.jsx(S,{className:"h-4 w-4 ml-1"})]})})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto scrollbar-hide pb-2",children:d.map(s=>e.jsx(G,{auction:s,layout:"carousel"},s._id||s.id))})]}),m.length===0&&j.length===0&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No content available at the moment"})}),m.slice(24).length>0&&e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4",children:m.slice(24).map(s=>e.jsx(N,{show:s,currentUserId:l||"",variant:"grid"},s._id||s.id))}),e.jsx("div",{ref:U,className:"h-20 flex items-center justify-center",children:_&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading more shows..."})})]})}),e.jsx(O,{})]})]})})]})}export{ge as default};
