import{u as Ie,a as Me,e as Le,b as Ae,r as N,j as e,q as Ce}from"./index-sx6K5zvX.js";import{u as Ue}from"./useQuery-BbAFWd3P.js";import{u as ke}from"./useMutation-CvlU_VR_.js";import{C as S,b as Qe,a as E,c as B,d as q}from"./card-y7XVqkDr.js";import{B as Q}from"./button-BhKWRVKT.js";import{B as $e}from"./badge-CnP4rDPZ.js";import{I as Re}from"./input-D9aLazCK.js";import{T as Ve,a as ze,b as U}from"./tabs-BFEhDEaE.js";import{S as Pe,a as Te,b as Oe,c as _e,d as C}from"./select-C7m4p16O.js";import{c as fe,f as g,a as Ge}from"./pricing-DCyf_yea.js";import{C as He}from"./pagination-B73znb0A.js";import{S as Je,a as Ke,b as We,c as Ye,d as Xe}from"./sheet-D885dNqh.js";import{S as D}from"./separator-GUgqmzB4.js";import{g as Ee}from"./firebase-chat-hwWO3jd5.js";import{P as je}from"./package-vaCfuI3Q.js";import{M as Be}from"./message-square-D33FmQ-H.js";import{T as Fe}from"./truck-DsoUBxdC.js";import{I as qe}from"./info-Dkeoc8ZV.js";import{f as de}from"./format-D46ChU1D.js";import{S as Ze}from"./search-CokuAmim.js";import"./index-UxBk8lm-.js";import"./index-DI5236x7.js";import"./index-CLz3BQaN.js";import"./index-BdQq_4o_.js";import"./index-BVScwSuZ.js";import"./index-yIM9ZdYr.js";import"./chevron-down-D9nmsT4r.js";import"./check-y82geyed.js";import"./chevron-up-BQLqsJm2.js";import"./chevron-left-Z_N2qaLO.js";import"./chevron-right-BMekTT0X.js";import"./index-BvxB2yyY.js";function et({order:s,open:ce,onOpenChange:y,onCancelOrder:R,onViewShipment:f,onMessageBuyer:Ne,cancelLoading:I=!1}){var Y,X,Z,d,w,ee,te,O,_,se,ae,re,ne,ie,t,r;const[,oe]=Ie(),{user:i}=Me(),{toast:k}=Le(),{settings:M}=Ae(),[V,z]=N.useState(!1);if(!s)return null;const p=(X=(Y=s.items)==null?void 0:Y[0])==null?void 0:X.productId;(Z=p==null?void 0:p.images)!=null&&Z[0]||(w=(d=s.giveaway)==null?void 0:d.images)!=null&&w[0],p!=null&&p.name||(ee=s.giveaway)!=null&&ee.name;const me=((te=p==null?void 0:p.category)==null?void 0:te.name)||((_=(O=s.giveaway)==null?void 0:O.category)==null?void 0:_.name)||"N/A",b=!!s.giveaway||s.ordertype==="giveaway",a=fe(s),j=s.tax||0,G=s.shipping_fee||0,P=a+j+G,H=M.commission_rate||0,L=a*H/100,h=s.seller_shipping_fee_pay||0,J=2.9,T=.3,K=P*(J/100)+T,xe=a-L-K-h,W=()=>{const n=s.status||"processing",c={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},o=s.label?"Label Created":n.charAt(0).toUpperCase()+n.slice(1);return e.jsx($e,{className:c[n]||c.processing,"data-testid":"badge-order-status",children:o})},A=s.date?new Date(s.date):s.createdAt?new Date(s.createdAt):new Date,ue=de(A,"dd MMM yyyy"),he=de(A,"h:mm a"),pe=((se=s.customer)==null?void 0:se.userName)||`${((ae=s.customer)==null?void 0:ae.firstName)||""} ${((re=s.customer)==null?void 0:re.lastName)||""}`.trim()||"Unknown",$=async()=>{var o,x,u,m,l;const n=(o=s.customer)==null?void 0:o._id,c=(i==null?void 0:i._id)||(i==null?void 0:i.id);if(!n||!c){k({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{z(!0);const v={firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",userName:(i==null?void 0:i.userName)||"",profilePhoto:(i==null?void 0:i.profilePhoto)||""},F={firstName:((x=s.customer)==null?void 0:x.firstName)||"",lastName:((u=s.customer)==null?void 0:u.lastName)||"",userName:((m=s.customer)==null?void 0:m.userName)||"",profilePhoto:((l=s.customer)==null?void 0:l.profilePhoto)||""},le=await Ee(c,n,v,F);oe(`/inbox/${le}`)}catch(v){console.error("Error creating chat:",v),k({title:"Error",description:"Failed to open chat. Please try again.",variant:"destructive"})}finally{z(!1)}};return e.jsx(Je,{open:ce,onOpenChange:y,children:e.jsxs(Ke,{className:"w-full sm:max-w-lg overflow-y-auto","data-testid":"sheet-order-details",children:[e.jsx(We,{className:"pb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Ye,{className:"text-2xl",children:"Order"}),e.jsxs(Xe,{className:"text-lg text-muted-foreground mt-1","data-testid":"text-order-id",children:["#",s.invoice||s._id.slice(-8)]})]})})}),e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{children:W()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Items"}),e.jsx("div",{className:"space-y-3",children:s.items&&s.items.length>0?s.items.map((n,c)=>{var m,l;const o=n.productId,x=((m=o==null?void 0:o.images)==null?void 0:m[0])||"",u=(o==null?void 0:o.name)||"Product";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:x?e.jsx("img",{src:x,alt:u,className:"w-full h-full object-cover","data-testid":`img-product-${c}`}):e.jsx(je,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-foreground","data-testid":`text-product-name-${c}`,children:u}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",n.quantity||1," × ",g(n.price||0)]})]}),!b&&e.jsx("button",{className:"text-xs text-primary font-medium whitespace-nowrap","data-testid":`button-view-receipt-${c}`,children:"View receipt"})]}),c<(((l=s.items)==null?void 0:l.length)||0)-1&&e.jsx(D,{})]},c)}):s.giveaway?e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:(ne=s.giveaway.images)!=null&&ne[0]?e.jsx("img",{src:s.giveaway.images[0],alt:s.giveaway.name,className:"w-full h-full object-cover","data-testid":"img-product-giveaway"}):e.jsx(je,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-foreground","data-testid":"text-product-name-giveaway",children:s.giveaway.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Giveaway Item"})]})]}):null})]}),e.jsxs("button",{onClick:$,disabled:V,className:"w-full flex items-center justify-between p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"button-message-buyer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-foreground"})}),e.jsx("span",{className:"font-medium text-foreground",children:V?"Loading...":"Message the buyer"})]}),e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),(s.tracking_number||s.label)&&e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsx("p",{className:"font-medium text-foreground mb-3",children:"This order is attached to a shipment."}),s.tracking_number&&e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipment"}),e.jsxs("span",{className:"text-primary font-medium","data-testid":"text-tracking-number",children:["#",s.tracking_number]})]}),((ie=s.customer)==null?void 0:ie.address)&&e.jsxs("div",{className:"flex justify-between text-sm mb-3",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ship to"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.customer.address.addrress1}),e.jsxs("p",{className:"text-muted-foreground",children:[s.customer.address.city,", ",s.customer.address.state," ",s.customer.address.zipcode]})]})]}),f&&e.jsxs(Q,{variant:"outline",className:"w-full",onClick:()=>f(s),"data-testid":"button-view-shipment",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]}),e.jsx(D,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Order details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order date"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-date",children:ue})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order time"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-time",children:he})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Buyer"}),e.jsx("span",{className:"text-primary font-medium","data-testid":"text-buyer-name",children:pe})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category"}),e.jsx("span",{className:"text-foreground","data-testid":"text-category",children:me})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("span",{className:"text-foreground","data-testid":"text-quantity",children:((r=(t=s.items)==null?void 0:t[0])==null?void 0:r.quantity)||1})]}),s.tokshow&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Show"}),e.jsx("span",{className:"text-foreground",children:s.tokshow.title||s.tokshow.name||s.tokshow._id})]})]})]}),e.jsx(D,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Buyer paid"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground","data-testid":"text-price",children:g(a)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taxes paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-tax",children:g(j)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-shipping-fee",children:g(G)})]}),e.jsx(D,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Order total"}),e.jsx("span",{"data-testid":"text-order-total",children:g(P)})]})]})]}),e.jsx(D,{}),b?e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Giveaway Item"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a giveaway item. No payment was collected and there are no earnings for this order."})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Your earnings"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Earnings became available for payout on ",de(new Date(A.getTime()+864e5),"dd MMM yyyy"),"."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground",children:g(a)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Commission"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",H.toFixed(1),"% of sale price)"]})]}),e.jsxs("span",{className:"text-foreground",children:["-",g(L)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Payment Processing Fee"}),e.jsx(qe,{className:"w-3 h-3 text-muted-foreground"})]}),e.jsxs("span",{className:"text-foreground",children:["-",g(K)]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-0",children:["(",J,"% of order total + $",T.toFixed(2),")"]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsxs("span",{className:"text-foreground",children:["-",g(h)]})]}),e.jsx(D,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Net earnings"}),e.jsx("span",{"data-testid":"text-net-earnings",children:g(xe)})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[R&&s.status!=="cancelled"&&s.status!=="delivered"&&s.status!=="shipped"&&!s.tracking_number&&!s.tracking_url&&e.jsx(Q,{variant:"destructive",className:"flex-1",onClick:()=>R(s._id),disabled:I,"data-testid":"button-cancel-order",children:I?"Cancelling...":"Cancel order"}),f&&(s.tracking_number||s.label)&&e.jsxs(Q,{variant:"outline",className:"flex-1",onClick:()=>f(s),"data-testid":"button-view-shipment-footer",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]})]})]})})}const tt={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},De={processing:1,shipped:2,delivered:3,ended:4,cancelled:5};function Mt(){const[s,ce]=N.useState(""),[y,R]=N.useState("all"),[f,Ne]=N.useState("all"),[I,oe]=N.useState("newest"),[i,k]=N.useState(1),[M,V]=N.useState(20),[z,p]=N.useState(null),[me,b]=N.useState(!1),{user:a}=Me(),{toast:j}=Le(),{settings:G}=Ae(),[,P]=Ie(),[H,L]=N.useState(null),{data:h,isLoading:J,error:T,isError:K,refetch:xe}=Ue({queryKey:["external-orders",a==null?void 0:a.id,y,f,i,M],queryFn:async()=>{const t=new URLSearchParams;a!=null&&a.id&&(console.log("User seller status:",a.seller),t.set("userId",a.id)),y&&y!=="all"&&t.set("status",y),f&&f!=="all"&&t.set("customerId",f),t.set("page",i.toString()),t.set("limit",M.toString());const r=await fetch(`/api/orders?${t.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`External API error: ${r.status}`);return r.json()},enabled:!!(a!=null&&a.id),staleTime:0,refetchOnMount:!0});ke({mutationFn:async t=>{const r=await fetch(`/api/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"shipped"})});if(!r.ok)throw new Error("Failed to mark order as shipped");return r.json()},onSuccess:()=>{Ce.invalidateQueries({queryKey:["external-orders"]}),j({title:"Order marked as shipped"})},onError:()=>{j({title:"Failed to mark order as shipped",variant:"destructive"})}});const W=ke({mutationFn:async t=>{const r=await fetch(`/api/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})});if(!r.ok)throw new Error("Failed to cancel order");return r.json()},onSuccess:()=>{Ce.invalidateQueries({queryKey:["external-orders"]}),j({title:"Order cancelled"}),b(!1)},onError:()=>{j({title:"Failed to cancel order",variant:"destructive"})}}),A=t=>{window.confirm("Are you sure you want to cancel this order?")&&W.mutate(t)},ue=async t=>{var c,o,x,u,m;const r=(c=t.customer)==null?void 0:c._id,n=(a==null?void 0:a._id)||(a==null?void 0:a.id);if(!r||!n){j({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{L(t._id);const l={firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",userName:(a==null?void 0:a.userName)||"",profilePhoto:(a==null?void 0:a.profilePhoto)||""},v={firstName:((o=t.customer)==null?void 0:o.firstName)||"",lastName:((x=t.customer)==null?void 0:x.lastName)||"",userName:((u=t.customer)==null?void 0:u.userName)||"",profilePhoto:((m=t.customer)==null?void 0:m.profilePhoto)||""},F=await Ee(n,r,l,v);P("/inbox/"+F)}catch(l){console.error("Failed to create chat:",l),j({title:"Error",description:"Failed to start chat. Please try again.",variant:"destructive"})}finally{L(null)}},he=t=>{k(t)},pe=t=>{V(t),k(1)},$=()=>{k(1)},Y=t=>{R(t),$()},X=t=>{Ne(t),$()},Z=t=>{oe(t),$()},d=(h==null?void 0:h.orders)||[],w=Ge,ee=t=>{if(t.giveaway||t.ordertype==="giveaway")return 0;const r=fe(t),n=G.commission_rate||0,c=r*n/100,m=(r+(t.tax||0)+(t.shipping_fee||0))*(2.9/100)+.3,l=t.seller_shipping_fee_pay||0;return r-c-m-l},te=(d==null?void 0:d.reduce((t,r)=>(r.customer&&!t.find(n=>n._id===r.customer._id)&&t.push(r.customer),t),[]))||[],O=(d==null?void 0:d.filter(t=>{var x,u,m,l;const r=`${((x=t.customer)==null?void 0:x.firstName)||""} ${((u=t.customer)==null?void 0:u.lastName)||""}`.trim(),n=((m=t.invoice)==null?void 0:m.toString())||t._id.slice(-8),c=((l=t.giveaway)==null?void 0:l.name)||"";return s===""||r.toLowerCase().includes(s.toLowerCase())||n.toLowerCase().includes(s.toLowerCase())||c.toLowerCase().includes(s.toLowerCase())}).sort((t,r)=>{switch(I){case"newest":const n=t.date?new Date(t.date):new Date(t.createdAt||0);return(r.date?new Date(r.date):new Date(r.createdAt||0)).getTime()-n.getTime();case"oldest":const o=t.date?new Date(t.date):new Date(t.createdAt||0),x=r.date?new Date(r.date):new Date(r.createdAt||0);return o.getTime()-x.getTime();case"amount-high":return w(r)-w(t);case"amount-low":return w(t)-w(r);case"status":const u=De[t.status]||999,m=De[r.status]||999;return u-m;default:return 0}}))||[],_=(h==null?void 0:h.total)||0,se=(h==null?void 0:h.pages)||0,ae=(d==null?void 0:d.reduce((t,r)=>t+w(r),0))||0,re=(d==null?void 0:d.filter(t=>t.status==="processing").length)||0,ne=(d==null?void 0:d.filter(t=>t.status==="shipped").length)||0,ie=(d==null?void 0:d.filter(t=>t.status==="delivered"||t.status==="ended").length)||0;return J?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-32 mb-8"}),e.jsx("div",{className:"grid grid-cols-5 gap-4 mb-8",children:Array.from({length:5}).map((t,r)=>e.jsx("div",{className:"h-24 bg-muted rounded"},r))}),e.jsx("div",{className:"h-96 bg-muted rounded"})]})})}):K?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx(S,{className:"max-w-md mx-auto mt-8",children:e.jsx(Qe,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive text-5xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Failed to Load Orders"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(T==null?void 0:T.message)||"Something went wrong while loading your orders. Please try again."}),e.jsx(Q,{onClick:()=>xe(),"data-testid":"button-retry-orders",children:"Try Again"})]})})})})}):e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground","data-testid":"text-orders-title",children:"Orders"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and track all your customer orders"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4 mb-8",children:[e.jsx(S,{children:e.jsxs(E,{className:"pb-2",children:[e.jsx(B,{children:"Total Orders"}),e.jsx(q,{className:"text-2xl","data-testid":"metric-total-orders",children:_})]})}),(a==null?void 0:a.seller)!==!1&&e.jsx(S,{children:e.jsxs(E,{className:"pb-2",children:[e.jsx(B,{children:"Current Page Revenue"}),e.jsx(q,{className:"text-2xl","data-testid":"metric-total-revenue",children:g(ae)})]})}),(a==null?void 0:a.seller)!==!1&&e.jsx(S,{children:e.jsxs(E,{className:"pb-2",children:[e.jsx(B,{children:"Processing"}),e.jsx(q,{className:"text-2xl text-orange-600","data-testid":"metric-processing",children:re})]})}),e.jsx(S,{children:e.jsxs(E,{className:"pb-2",children:[e.jsx(B,{children:"Shipping"}),e.jsx(q,{className:"text-2xl text-blue-600","data-testid":"metric-shipping",children:ne})]})}),e.jsx(S,{children:e.jsxs(E,{className:"pb-2",children:[e.jsx(B,{children:"Delivered"}),e.jsx(q,{className:"text-2xl text-green-600","data-testid":"metric-delivered",children:ie})]})})]}),e.jsx(Ve,{value:y,onValueChange:Y,className:"mb-6",children:e.jsxs(ze,{className:`grid w-full ${(a==null?void 0:a.seller)===!1?"grid-cols-3":"grid-cols-3 sm:grid-cols-5"}`,children:[e.jsx(U,{value:"all","data-testid":"tab-all",children:"All"}),(a==null?void 0:a.seller)!==!1&&e.jsx(U,{value:"processing","data-testid":"tab-processing",children:"Need Label"}),(a==null?void 0:a.seller)!==!1&&e.jsx(U,{value:"ready_to_ship","data-testid":"tab-ready-to-ship",children:"Ready to Ship"}),e.jsx(U,{value:"shipped","data-testid":"tab-shipped",children:"Shipped"}),e.jsx(U,{value:"cancelled","data-testid":"tab-cancelled",children:"Cancelled"})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),e.jsx(Re,{placeholder:"Search orders...",value:s,onChange:t=>ce(t.target.value),className:"pl-10","data-testid":"input-search-orders"})]}),(a==null?void 0:a.seller)!==!1&&e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs(Pe,{value:f,onValueChange:X,children:[e.jsx(Te,{"data-testid":"select-customer",children:e.jsx(Oe,{placeholder:"Filter by customer..."})}),e.jsxs(_e,{children:[e.jsx(C,{value:"all",children:"All Customers"}),te.map(t=>e.jsxs(C,{value:t._id,children:[t.firstName," ",t.lastName]},t._id))]})]})}),e.jsxs(Pe,{value:I,onValueChange:Z,children:[e.jsx(Te,{className:"w-full sm:w-48","data-testid":"select-sort-orders",children:e.jsx(Oe,{placeholder:"Sort by"})}),e.jsxs(_e,{children:[e.jsx(C,{value:"newest",children:"Newest First"}),e.jsx(C,{value:"oldest",children:"Oldest First"}),e.jsx(C,{value:"amount-high",children:"Amount: High to Low"}),e.jsx(C,{value:"amount-low",children:"Amount: Low to High"}),e.jsx(C,{value:"status",children:"Status"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",O.length," of ",_," orders"]})]}),e.jsx(S,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Sales Channel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Earnings status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:O.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-12 text-center",children:[e.jsx(je,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No orders found"}),e.jsx("p",{className:"text-muted-foreground",children:s||y!=="all"?"Try adjusting your search or filters":"Orders will appear here when customers make purchases"})]})}):O.map(t=>{var F,le,ye,we,be,ve;const r=((F=t.giveaway)==null?void 0:F.name)||((we=(ye=(le=t.items)==null?void 0:le[0])==null?void 0:ye.productId)==null?void 0:we.name)||"N/A",n=t.invoice||t._id.slice(-8),c=((be=t.customer)==null?void 0:be.userName)||"Unknown",o=t.giveaway?1:((ve=t.items)==null?void 0:ve.length)||0,x=t.date?new Date(t.date):new Date(t.createdAt||Date.now()),u=fe(t),m=ee(t),l=t.status||"processing",v=l==="delivered"||l==="ended"?"Completed":"In Transit";return e.jsxs("tr",{className:"hover:bg-muted/50 cursor-pointer transition-colors","data-testid":`row-order-${t._id}`,onClick:()=>{p(t),b(!0)},children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:r}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Order #",n]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-muted-foreground",children:de(x,"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-primary cursor-pointer hover:underline",onClick:ge=>{var Se;ge.stopPropagation(),(Se=t.customer)!=null&&Se._id&&P("/profile/"+t.customer._id)},children:c})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:o}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:t.tokshow?"Show":"Marketplace"}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:["US$",u.toFixed(2)]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx($e,{className:tt[l],"data-testid":`order-status-${l}`,children:l==="processing"?"In Transit":l.charAt(0).toUpperCase()+l.slice(1)})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",m.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:v}),e.jsx(qe,{className:"w-3 h-3"})]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx(Q,{variant:"ghost",size:"icon","data-testid":`button-message-customer-${t._id}`,disabled:H===t._id,onClick:ge=>{ge.stopPropagation(),ue(t)},children:e.jsx(Be,{size:16})})})]},t._id)})})]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(He,{currentPage:i,totalPages:se,totalItems:_,itemsPerPage:M,itemsPerPageOptions:[10,20,50,100],onPageChange:he,onItemsPerPageChange:pe,showingText:"orders",className:"bg-white dark:bg-gray-950 rounded-lg border p-4"})})]}),e.jsx(et,{order:z,open:me,onOpenChange:b,onCancelOrder:A,cancelLoading:W.isPending,onViewShipment:t=>{sessionStorage.setItem("openShipmentDrawer",JSON.stringify(t)),b(!1),P("/shipping")},onMessageBuyer:t=>{j({title:"Messaging feature coming soon!"})}})]})}export{Mt as default};
