import{c as F,e as R,u as D,r as N,a as K,j as e,q as d,k as S}from"./index-sx6K5zvX.js";import{u as U}from"./useQuery-BbAFWd3P.js";import{u as C}from"./useMutation-CvlU_VR_.js";import{B as l}from"./button-BhKWRVKT.js";import{T as A,a as V,b as k,c as T}from"./tabs-BFEhDEaE.js";import{P}from"./plus-C4q9dHNM.js";import{V as _}from"./video-C3MDcR9i.js";import{C as B}from"./chevron-left-Z_N2qaLO.js";import{C as I}from"./chevron-right-BMekTT0X.js";import{f as H}from"./format-D46ChU1D.js";import"./index-UxBk8lm-.js";import"./index-DI5236x7.js";import"./index-CLz3BQaN.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=F("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function ne(){const{toast:m}=R(),[,p]=D(),[v,$]=N.useState("upcoming"),[o,g]=N.useState(1),{user:s}=K(),c=v==="upcoming"?"active":"inactive",{data:r,isLoading:y}=U({queryKey:["/api/rooms",s==null?void 0:s.id,o,c],queryFn:async()=>{if(!(s!=null&&s.id))return{rooms:[],totalDoc:0,limits:15,pages:0};const t=new URLSearchParams({page:o.toString(),limit:"15",userid:s.id,currentUserId:s.id,category:"",title:"",status:c}),a=await fetch(`/api/rooms?${t.toString()}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch shows");return await a.json()},enabled:!!(s!=null&&s.id)}),h=(r==null?void 0:r.rooms)||[],x=Math.ceil(((r==null?void 0:r.totalDoc)||0)/((r==null?void 0:r.limits)||15)),b=C({mutationFn:async({showId:t,newRoomType:a})=>await S("PUT",`/api/rooms/${t}`,{roomType:a}),onMutate:async({showId:t,newRoomType:a})=>{await d.cancelQueries({queryKey:["/api/rooms"]});const i=d.getQueryData(["/api/rooms",s==null?void 0:s.id,o,c]);return d.setQueryData(["/api/rooms",s==null?void 0:s.id,o,c],n=>n&&{...n,rooms:n.rooms.map(u=>u._id===t?{...u,roomType:a}:u)}),{previousShows:i}},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/rooms"]}),m({title:"Room type updated",description:"Show privacy settings have been updated successfully."})},onError:(t,a,i)=>{i!=null&&i.previousShows&&d.setQueryData(["/api/rooms",s==null?void 0:s.id,o,c],i.previousShows),m({title:"Failed to update room type",description:t.message,variant:"destructive"})}}),f=C({mutationFn:async t=>await S("PUT",`/api/rooms/${t}`,{ended:!0}),onMutate:async t=>{await d.cancelQueries({queryKey:["/api/rooms"]});const a=d.getQueryData(["/api/rooms",s==null?void 0:s.id,o,c]);return d.setQueryData(["/api/rooms",s==null?void 0:s.id,o,c],i=>i&&{...i,rooms:i.rooms.map(n=>n._id===t?{...n,ended:!0}:n)}),{previousShows:a}},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/rooms"]}),m({title:"Show cancelled",description:"The show has been cancelled successfully."})},onError:(t,a,i)=>{i!=null&&i.previousShows&&d.setQueryData(["/api/rooms",s==null?void 0:s.id,o,c],i.previousShows),m({title:"Failed to cancel show",description:t.message,variant:"destructive"})}}),Q=t=>{const a=t.roomType==="private"?"public":"private";b.mutate({showId:t._id,newRoomType:a})},q=t=>{f.mutate(t)},L=t=>{const a=`${window.location.origin}/show/${t}`;navigator.clipboard.writeText(a),m({title:"Show link copied to clipboard"})},M=()=>{o>1&&g(o-1)},z=()=>{o<x&&g(o+1)},E=t=>{$(t),g(1)},j=t=>{const a=Date.now(),i=t.date<=a,n=t.started||t.ended,u=i&&n;return e.jsxs("div",{className:"border border-border rounded-lg p-4 mb-3 bg-card","data-testid":`show-card-${t._id}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("h3",{className:"text-base font-medium text-foreground","data-testid":`show-title-${t._id}`,children:[t.title," — ",H(new Date(t.date),"M/d/yyyy · h:mm a")]}),e.jsx("button",{onClick:()=>L(t._id),className:"p-1 hover-elevate active-elevate-2 rounded","data-testid":`button-copy-link-${t._id}`,title:"Copy show link",children:e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})})]}),t.category&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.category.name})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(l,{variant:"default",size:"sm",onClick:()=>p(`/show/${t._id}`),"data-testid":`button-open-show-${t._id}`,children:"Open show"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>p(`/schedule-show?edit=${t._id}`),"data-testid":`button-edit-show-${t._id}`,children:"Edit show"}),!u&&e.jsx(l,{variant:"destructive",size:"sm",onClick:()=>q(t._id),disabled:f.isPending,"data-testid":`button-cancel-show-${t._id}`,children:"Cancel Show"}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Q(t),disabled:b.isPending,"data-testid":`button-private-mode-${t._id}`,children:[t.roomType==="private"?"Disable":"Enable"," Private Mode"]})]})]},t._id)},w=()=>x<=1?null:e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",o," of ",x," (",(r==null?void 0:r.totalDoc)||0," total shows)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:M,disabled:o===1,"data-testid":"button-previous-page",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:z,disabled:o>=x,"data-testid":"button-next-page",children:["Next",e.jsx(I,{className:"h-4 w-4 ml-1"})]})]})]});return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b border-border bg-background px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground","data-testid":"text-shows-title",children:"Shows"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{className:"bg-yellow-400 hover:bg-yellow-500 text-black dark:bg-yellow-500 dark:hover:bg-yellow-600",size:"sm",onClick:()=>p("/schedule-show"),"data-testid":"button-schedule-show",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Schedule a Show"]})})]})}),e.jsx("div",{className:"flex-1 overflow-auto px-6 py-6",children:e.jsxs(A,{value:v,onValueChange:E,className:"w-full",children:[e.jsxs(V,{className:"mb-4","data-testid":"tabs-shows",children:[e.jsx(k,{value:"upcoming","data-testid":"tab-upcoming",children:"Upcoming"}),e.jsx(k,{value:"past","data-testid":"tab-past",children:"Past"})]}),e.jsx(T,{value:"upcoming","data-testid":"content-upcoming",children:y?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,a)=>e.jsx("div",{className:"h-32 bg-muted rounded-lg animate-pulse"},a))}):h.length>0?e.jsxs("div",{children:[h.map(j),w()]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No upcoming shows"}),e.jsxs(l,{onClick:()=>p("/schedule-show"),"data-testid":"button-create-first-show",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Schedule Your First Show"]})]})}),e.jsx(T,{value:"past","data-testid":"content-past",children:y?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,a)=>e.jsx("div",{className:"h-32 bg-muted rounded-lg animate-pulse"},a))}):h.length>0?e.jsxs("div",{children:[h.map(j),w()]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No past shows"})]})})]})})]})}export{ne as default};
