const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/buy-now-dialog-B3KMFRJV.js","assets/index-GnvmivW0.js","assets/index-B0C4fpEQ.css","assets/dialog-D1L4tMGI.js","assets/badge-CL9MXKGS.js","assets/separator-Datc7ShZ.js","assets/alert-BCAR44i4.js","assets/useMutation-DAKVWGzI.js","assets/chevron-right-CXw-mF7y.js","assets/plus-CxBznHFO.js","assets/credit-card-B0WsppBV.js","assets/map-pin-Dn0fBe7g.js","assets/add-payment-dialog-DoThKuX2.js","assets/index-QZHL2phQ.js","assets/add-address-dialog-BRDWlqBi.js","assets/input-CDJz7BeV.js","assets/label-CbaFYhHW.js","assets/react-country-state-city-4XimWX2C.js","assets/react-country-state-city-BZfUZqIr.css","assets/payment-method-list-dialog-DU4kJKqj.js","assets/trash-2-V4a6hNaj.js","assets/address-list-dialog-DBVChEdX.js","assets/circle-check-jk63TU7f.js","assets/make-offer-dialog-BV_W-Hrq.js","assets/dollar-sign-BPAh4ytq.js"])))=>i.map(i=>d[i]);
import{p as Ie,u as $e,a as Ae,b as qe,g as Le,r as i,d as T,j as e,B as f,L as pe,x as ge,q as h,y as je,a9 as k}from"./index-GnvmivW0.js";import{u as ze}from"./useMutation-DAKVWGzI.js";import{A as Te,a as Ke,b as Me}from"./avatar-T6GBhCEI.js";import{C as G}from"./card-Bsqf9o7h.js";import{S as ye}from"./separator-Datc7ShZ.js";import{g as Re}from"./firebase-chat-DdFjaliD.js";import{A as Be}from"./arrow-left-CUbNyMTb.js";import{S as U}from"./shopping-bag-DVKU65dg.js";import{C as Qe}from"./chevron-left-BnuQCvWV.js";import{C as Ve}from"./chevron-right-CXw-mF7y.js";import{M as Ye}from"./message-circle-BazjP4NK.js";import{S as We}from"./star-Dvv0yNqt.js";import{S as Ge}from"./shield-TxVeUbf2.js";import{F as Ue}from"./flag-kVKTLwg_.js";import{C as H}from"./chevron-down-tcDKR_mK.js";import{C as He}from"./credit-card-B0WsppBV.js";const Je=i.lazy(()=>k(()=>import("./buy-now-dialog-B3KMFRJV.js").then(F=>F.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Xe=i.lazy(()=>k(()=>import("./add-payment-dialog-DoThKuX2.js"),__vite__mapDeps([12,1,2,3,13]))),Ze=i.lazy(()=>k(()=>import("./add-address-dialog-BRDWlqBi.js"),__vite__mapDeps([14,1,2,3,15,16,17,18]))),Ee=i.lazy(()=>k(()=>import("./payment-method-list-dialog-DU4kJKqj.js"),__vite__mapDeps([19,1,2,3,4,12,13,10,20]))),es=i.lazy(()=>k(()=>import("./address-list-dialog-DBVChEdX.js"),__vite__mapDeps([21,1,2,3,14,15,16,17,18,11,22,20]))),ss=i.lazy(()=>k(()=>import("./make-offer-dialog-BV_W-Hrq.js"),__vite__mapDeps([23,1,2,3,15,24])));function ws(){var le,de,ce,ue,me;const[,F]=Ie("/product/:productId"),[,j]=$e(),{user:n,refreshUserData:y}=Ae(),{settings:be}=qe(),{toast:b}=Le(),[K,M]=i.useState(0),[ve,J]=i.useState(!1),[X,R]=i.useState(!1),[Z,D]=i.useState(!1),[E,I]=i.useState(!1),[ee,$]=i.useState(!1),[se,A]=i.useState(!1),[C,ts]=i.useState(1),[te,Ne]=i.useState(!1),[we,v]=i.useState(!1),[ae,oe]=i.useState(!1),[c,q]=i.useState(null),p=F==null?void 0:F.productId;i.useEffect(()=>{v(!1),q(null)},[p]);const Se=!!p,{data:t,isLoading:_e}=T({queryKey:["/api/products",p],queryFn:async()=>{const s=await fetch(`/api/products/${p}`);if(!s.ok)throw new Error("Failed to fetch product");const r=await s.json();return r.product||r},enabled:Se}),re=t!=null&&t.ownerId&&typeof t.ownerId=="object"?t.ownerId:null,l=((le=t==null?void 0:t.ownerId)==null?void 0:le._id)||(t==null?void 0:t.ownerId),ke=!!(l&&!re),{data:Fe}=T({queryKey:["/api/profile",l],queryFn:async()=>{if(!l)return null;const s=await fetch(`/api/profile/${l}`);if(!s.ok)return null;const r=await s.json();return r.data||r},enabled:ke}),o=re||Fe,u=(n==null?void 0:n._id)||(n==null?void 0:n.id)||(n==null?void 0:n.id),N=(n==null?void 0:n.defaultpaymentmethod)||null,d=(n==null?void 0:n.address)||null,B=d&&d.zipcode&&d.state&&d.city,L=!!(t&&p&&B&&u),{data:a,isLoading:Q}=T({queryKey:["/api/shipping/estimate",p,B,u],queryFn:async()=>{var s,r;if(!t||!u)return null;try{const g=await fetch("/api/shipping/estimate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({weight:t.shipping_profile.weight,unit:t.shipping_profile.scale,product:p,owner:((s=t.ownerId)==null?void 0:s._id)||t.ownerId,customer:u,tokshow:((r=t.tokshow)==null?void 0:r._id)||t.tokshow||null,buying_label:!1})});return g.ok?g.json():null}catch(g){return console.error("Failed to fetch shipping estimate:",g),null}},enabled:L,staleTime:0,gcTime:0,refetchOnMount:"always",retry:!1}),Ce=!!l,{data:V}=T({queryKey:["/api/products","seller-products",l,p],queryFn:async()=>{if(!l)return{products:[]};const s=new URLSearchParams({userid:l,roomid:"",type:"",saletype:"",category:"",page:"1",limit:"50",featured:"true",status:"active"}),r=await fetch(`/api/products?${s.toString()}`);return r.ok?r.json():{products:[]}},enabled:Ce}),Y=ze({mutationFn:async()=>{var xe,fe;if(!t)throw new Error("Product not found");const s=t._id||t.id,r=parseFloat((a==null?void 0:a.amount)||"0"),S=(c!==null?c:t.price||0)*C,z=S+r;if(c!==null){const he={product:s,seller:l,buyer:u,quantity:C,subtotal:parseFloat(S.toFixed(2)),shippingFee:parseFloat(r.toFixed(2)),tax:0,bundleId:(a==null?void 0:a.bundleId)||"",rate_id:(a==null?void 0:a.rate_id)||"",servicelevel:((xe=a==null?void 0:a.servicelevel)==null?void 0:xe.name)||(a==null?void 0:a.servicelevel)||"",totalWeightOz:parseFloat((a==null?void 0:a.totalWeightOz)||"0"),seller_shipping_fee_pay:parseFloat((a==null?void 0:a.seller_shipping_fee_pay)||"0")};return t.tokshow&&(he.tokshow=t.tokshow),{...await(await je("POST","/api/offers",he)).json(),isOffer:!0}}const _={product:s,seller:l,buyer:u,quantity:C,subtotal:parseFloat(S.toFixed(2)),shippingFee:parseFloat(r.toFixed(2)),tax:0,total:parseFloat(z.toFixed(2)),color:"",size:"",bundleId:(a==null?void 0:a.bundleId)||"",rate_id:(a==null?void 0:a.rate_id)||"",servicelevel:((fe=a==null?void 0:a.servicelevel)==null?void 0:fe.name)||(a==null?void 0:a.servicelevel)||"",totalWeightOz:parseFloat((a==null?void 0:a.totalWeightOz)||"0"),seller_shipping_fee_pay:parseFloat((a==null?void 0:a.seller_shipping_fee_pay)||"0"),status:"processing"};return t.tokshow&&(_.tokshow=t.tokshow),a!=null&&a.carrierAccount&&(_.carrierAccount=a.carrierAccount),await(await je("POST",`/api/orders/${s}`,_)).json()},onSuccess:s=>{var g,S,z,_;if(s!=null&&s.isOffer){console.log("Offer created, response:",s),b({title:"Offer Sent!",description:"Your offer has been sent to the seller. You can track it in My Offers."}),h.invalidateQueries({queryKey:["/api/offers"]}),h.invalidateQueries({queryKey:["/api/products"]}),v(!1),q(null);return}console.log("Order created, response:",s);const r=((S=(g=s==null?void 0:s.data)==null?void 0:g.newOrder)==null?void 0:S._id)||((z=s==null?void 0:s.newOrder)==null?void 0:z._id)||((_=s==null?void 0:s.order)==null?void 0:_._id)||(s==null?void 0:s._id);console.log("Extracted order ID:",r),b({title:"Purchase Successful!",description:"Your order has been placed"}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:["/api/rooms"]}),h.invalidateQueries({queryKey:["/api/products"]}),v(!1),r?(console.log("Navigating to thank you page:",`/thank-you/${r}`),j(`/thank-you/${r}`)):(console.error("No order ID found in response, going to purchases"),j("/purchases"))},onError:s=>{b({title:c!==null?"Offer Failed":"Purchase Failed",description:(s==null?void 0:s.message)||"Please try again later",variant:"destructive"})}}),Oe=async()=>{if(!n){b({title:"Please log in",description:"You need to be logged in to message",variant:"destructive"});return}if(w){j("/inbox");return}if(!o){b({title:"Error",description:"Seller information not available",variant:"destructive"});return}J(!0);try{const s=(n==null?void 0:n._id)||(n==null?void 0:n.id),r=await Re(s,l);j(`/inbox/${r}`)}catch{b({title:"Failed to open chat",description:"Please try again later",variant:"destructive"})}finally{J(!1)}};if(_e)return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-96 bg-muted rounded-lg"}),e.jsx("div",{className:"h-20 bg-muted rounded-lg"}),e.jsx("div",{className:"h-40 bg-muted rounded-lg"})]})})});if(!t)return e.jsx("div",{className:"min-h-screen bg-background p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"Product not found"}),e.jsx(f,{onClick:()=>j("/"),className:"mt-4",children:"Go Home"})]})});const x=t.images||[],Pe=(o==null?void 0:o.firstName)||(o==null?void 0:o.userName)||"Seller",De=(o==null?void 0:o.userName)||"user",W=(o==null?void 0:o.averagereviews)||(o==null?void 0:o.rating),O=o==null?void 0:o.reviewCount,P=o==null?void 0:o.soldCount;(de=o==null?void 0:o.following)!=null&&de.length||(o==null||o.followingCount),(ce=o==null?void 0:o.followers)!=null&&ce.length||(o==null||o.followersCount);const ne=((ue=V==null?void 0:V.products)==null?void 0:ue.filter(s=>(s._id||s.id)!==p))||[],m=(a==null?void 0:a.amount)||((me=a==null?void 0:a[0])==null?void 0:me.amount)||t.shipping_fee||null,ie=(n==null?void 0:n._id)||(n==null?void 0:n.id),w=ie&&ie===l;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-background border-b border-border p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-4",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>window.history.back(),"data-testid":"button-back",children:e.jsx(Be,{className:"h-5 w-5"})}),e.jsx("h1",{className:"font-semibold truncate flex-1",children:t.productName||"Product"})]})}),e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-6 grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"aspect-square bg-muted rounded-lg overflow-hidden mb-4 relative",children:[x.length>0&&x[K]?e.jsx("img",{src:x[K],alt:t.productName,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(U,{className:"w-12 h-12 text-muted-foreground/40"})}),x.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 bg-background/80 hover:bg-background",onClick:()=>M(s=>(s-1+x.length)%x.length),"data-testid":"button-prev-image",children:e.jsx(Qe,{className:"h-5 w-5"})}),e.jsx(f,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-background/80 hover:bg-background",onClick:()=>M(s=>(s+1)%x.length),"data-testid":"button-next-image",children:e.jsx(Ve,{className:"h-5 w-5"})})]})]}),x.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-2",children:x.slice(0,4).map((s,r)=>e.jsx("button",{onClick:()=>M(r),className:`aspect-square rounded-lg overflow-hidden border-2 ${K===r?"border-primary":"border-transparent"}`,"data-testid":`thumbnail-${r}`,children:e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"})},r))})]}),we?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b",children:[e.jsx("div",{className:"w-12 h-12 flex-shrink-0 rounded-lg overflow-hidden bg-muted",children:x.length>0?e.jsx("img",{src:x[0],alt:t.productName||t.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-muted-foreground/40"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"font-bold text-base leading-tight mb-1 truncate","data-testid":"text-product-title",children:t.productName||t.name}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-quantity",children:t.quantity>0?`${t.quantity} available`:"Out of stock"})]})]}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>Ne(!te),className:"w-full flex items-center justify-between py-3 px-0 text-left border-b","data-testid":"button-option-dropdown",children:[e.jsx("span",{className:"text-sm font-medium",children:"Option"}),e.jsx(H,{className:`h-4 w-4 text-muted-foreground transition-transform ${te?"rotate-180":""}`})]})}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-0 border-b",children:[e.jsx("span",{className:"text-sm font-medium",children:c!==null?"Your Offer":"Price"}),e.jsx("div",{className:"flex items-center gap-2","data-testid":"text-product-price",children:c!==null?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-muted-foreground line-through text-sm",children:["US$",(t.price||0).toFixed(2)]}),e.jsxs("span",{className:"font-semibold text-green-600",children:["US$",c.toFixed(2)]})]}):e.jsxs("span",{className:"font-semibold",children:["US$",(t.price||0).toFixed(2)]})})]}),e.jsx("div",{className:"border-b",children:e.jsxs("button",{onClick:()=>{N?I(!0):D(!0)},className:"w-full flex items-center justify-between py-3 px-0 text-left hover:bg-muted/50 transition-colors","data-testid":"button-payment-method",children:[e.jsx("span",{className:"text-sm font-medium",children:"Payment"}),e.jsxs("div",{className:"flex items-center gap-2",children:[N?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[N.brand," •••• ",N.last4]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Add payment"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]})]})}),e.jsx("div",{className:"border-b",children:e.jsxs("button",{onClick:()=>{d?A(!0):$(!0)},className:"w-full flex items-center justify-between py-3 px-0 text-left hover:bg-muted/50 transition-colors","data-testid":"button-shipping-address",children:[e.jsx("span",{className:"text-sm font-medium",children:"Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-right text-sm max-w-[200px]",children:[e.jsx("div",{className:"font-medium truncate",children:d.name||"User"}),e.jsxs("div",{className:"text-muted-foreground truncate",children:[d.city&&`${d.city}, `,d.state," ",d.zipcode]})]})}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Add address"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]})]})}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["US$",((c!==null?c:t.price||0)*C).toFixed(2)]})]}),B&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Shipping"}),m!==null?e.jsxs("span",{className:"font-medium",children:["US$",(typeof m=="string"?parseFloat(m):m).toFixed(2)]}):e.jsx(ge,{className:"h-4 w-4 animate-spin"})]}),e.jsx(ye,{}),e.jsxs("div",{className:"flex justify-between text-base font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{"data-testid":"text-total-price",children:["US$",((c!==null?c:t.price||0)*C+(m?typeof m=="string"?parseFloat(m):m:0)).toFixed(2)]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>{v(!1),q(null)},"data-testid":"button-checkout-back",children:"Back"}),e.jsx(f,{className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground font-semibold",disabled:w||!N||!d||Y.isPending,onClick:()=>Y.mutate(),"data-testid":"button-checkout",children:Y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4 animate-spin mr-2"}),"Processing..."]}):c!==null?"Make Offer":"Check out"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2","data-testid":"text-product-title",children:t.productName||t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[e.jsx("span",{"data-testid":"text-quantity",children:t.quantity>0?`${t.quantity} Available`:"Out of Stock"}),t.condition&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:t.condition})]})]}),e.jsxs("p",{className:"text-3xl font-bold","data-testid":"text-product-price",children:["US$",(t.price||0).toFixed(2),m!==null&&e.jsxs("span",{className:"text-sm text-muted-foreground font-normal",children:[" ","+ US$",(typeof m=="string"?parseFloat(m):m).toFixed(2)," shipping + taxes"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"flex-1 bg-primary hover:bg-primary/90 text-primary-foreground disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"button-buy-now",disabled:w||L&&Q,onClick:()=>{w||v(!0)},children:w?"Your Product":Q&&L?"Loading...":"Buy Now"}),t.offer&&!w&&e.jsx(f,{size:"sm",className:"bg-secondary hover:bg-secondary/90 text-secondary-foreground","data-testid":"button-make-offer",disabled:L&&Q,onClick:()=>oe(!0),children:"Make Offer"})]}),e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(pe,{href:`/profile/${l}`,children:e.jsxs("div",{className:"flex items-center justify-between p-4 border-b cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Te,{className:"h-12 w-12",children:[e.jsx(Ke,{src:o==null?void 0:o.profilePhoto}),e.jsx(Me,{children:Pe.charAt(0).toUpperCase()})]}),e.jsx("p",{className:"font-semibold text-lg","data-testid":"text-seller-name",children:De})]}),e.jsx(f,{variant:"ghost",size:"icon",className:"rounded-full",onClick:s=>{s.preventDefault(),s.stopPropagation(),Oe()},disabled:ve,"data-testid":"button-message-icon",children:e.jsx(Ye,{className:"h-5 w-5"})})]})}),e.jsxs("div",{className:"grid grid-cols-3 divide-x bg-muted/30",children:[W!=null&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 text-xl font-bold mb-1",children:[e.jsx(We,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}),W.toFixed(1)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rating"})]}),O!=null&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold mb-1",children:O>=1e3?`${(O/1e3).toFixed(1)}K`:O}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reviews"})]}),P!=null&&e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-xl font-bold mb-1",children:P>=1e3?`${(P/1e3).toFixed(1)}K`:P}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sold"})]})]})]}),e.jsxs(G,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Product Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[t.condition&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Condition"}),e.jsx("span",{className:"font-medium","data-testid":"text-condition",children:t.condition})]}),t.category&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category"}),e.jsx("span",{className:"font-medium",children:typeof t.category=="object"?t.category.name:t.category})]}),t.productType&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type"}),e.jsx("span",{className:"font-medium",children:t.productType})]})]}),t.description&&e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-description",children:t.description})})]}),e.jsx(f,{variant:"outline",className:"w-full",onClick:()=>j(`/profile/${l}`),"data-testid":"button-view-profile",children:"View Profile"}),e.jsxs(G,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Buyer Protections"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[be.app_name," Buyer Guarantee"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive your purchase on time and as described or we'll make it right."})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.createdAt&&e.jsxs("span",{className:"text-muted-foreground",children:["Created on ",new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700","data-testid":"button-report",children:[e.jsx(Ue,{className:"h-4 w-4 mr-1"}),"Report Listing"]})]})]})]}),ne.length>0&&e.jsxs("div",{className:"max-w-6xl mx-auto px-4 md:px-6 py-8",children:[e.jsx(ye,{className:"mb-6"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"More from the Seller"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:ne.slice(0,15).map(s=>{var r;return e.jsx(pe,{href:`/product/${s._id}`,children:e.jsxs("div",{className:"cursor-pointer group","data-testid":`related-product-${s._id}`,children:[e.jsx("div",{className:"aspect-square bg-muted rounded-lg overflow-hidden mb-2 relative",children:(r=s.images)!=null&&r[0]?e.jsx("img",{src:s.images[0],alt:s.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(U,{className:"w-12 h-12 text-muted-foreground/40"})})}),e.jsx("p",{className:"font-medium text-sm truncate","data-testid":`product-name-${s._id}`,children:s.name||"No Title"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["US$",(s.price||0).toFixed(2)]})]})},s._id)})})]}),X&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Je,{open:X,onOpenChange:R,product:t,onOpenPaymentMethods:()=>{R(!1),N?I(!0):D(!0)},onOpenShippingAddresses:()=>{R(!1),d?A(!0):$(!0)}})}),Z&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Xe,{open:Z,onOpenChange:D,onSuccess:async()=>{D(!1),await h.invalidateQueries({queryKey:[`/api/users/paymentmethod/default/${u}`]}),await y()}})}),E&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ee,{open:E,onOpenChange:async s=>{I(s),s||(await h.invalidateQueries({queryKey:[`/api/users/paymentmethod/default/${u}`]}),await y())},onSuccess:async()=>{I(!1),await h.invalidateQueries({queryKey:[`/api/users/paymentmethod/default/${u}`]}),await y()}})}),ee&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(Ze,{open:ee,onOpenChange:$,onSuccess:async()=>{$(!1),await h.invalidateQueries({queryKey:[`/api/address/default/address/${u}`]}),await y()}})}),se&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(es,{open:se,onOpenChange:async s=>{A(s),s||(await h.invalidateQueries({queryKey:[`/api/address/default/address/${u}`]}),await y())},onSuccess:async()=>{A(!1),await h.invalidateQueries({queryKey:[`/api/address/default/address/${u}`]}),await y()}})}),ae&&e.jsx(i.Suspense,{fallback:e.jsx("div",{}),children:e.jsx(ss,{open:ae,onOpenChange:oe,product:t,shippingEstimate:a,onContinueWithOffer:s=>{q(s),v(!0)}})})]})}export{ws as default};
