import{e as Ee,a as Le,b as Oe,u as _e,r as i,j as e,q as Me}from"./index-sx6K5zvX.js";import{C as k,b as F,a as ae,d as ne,c as re}from"./card-y7XVqkDr.js";import{B as j}from"./button-BhKWRVKT.js";import{I as m}from"./input-D9aLazCK.js";import{L as o}from"./label-BJe6VCdD.js";import{u as ie}from"./useQuery-BbAFWd3P.js";import{u as le}from"./useMutation-CvlU_VR_.js";import{S as T,a as V,b as W,c as K,d as g}from"./select-C7m4p16O.js";import{C as Be,S as oe,a as Ie}from"./city-BO9769IJ.js";import{L as H}from"./loader-circle-B7f4O2pk.js";import{C as Ye}from"./clock-DaytCKWc.js";import{C as $e}from"./circle-alert-B9CUXtyD.js";import{C as ze}from"./check-y82geyed.js";import{M as Re}from"./map-pin-CyryTmSF.js";import{A as Te}from"./arrow-right-DlnuLXK7.js";import{C as Ve}from"./credit-card-dlBmie7d.js";import{C as We}from"./circle-check-dbnmriGo.js";import"./index-BdQq_4o_.js";import"./index-CLz3BQaN.js";import"./index-BVScwSuZ.js";import"./index-DI5236x7.js";import"./index-yIM9ZdYr.js";import"./chevron-down-D9nmsT4r.js";import"./chevron-up-BQLqsJm2.js";const b=[{id:"address",title:"Address",description:"Shipping information"},{id:"bank",title:"Bank Account",description:"Payout setup"},{id:"complete",title:"Complete",description:"Finish setup"}];function ft(){const{toast:c}=Ee(),{user:s}=Le(),{settings:J}=Oe(),[,q]=_e(),[p,v]=i.useState("address"),[y,de]=i.useState(""),[P,ce]=i.useState(""),[D,Q]=i.useState(""),[d,Z]=i.useState(""),[E,G]=i.useState(""),[h,U]=i.useState(""),[S,L]=i.useState(""),[N,ue]=i.useState(""),[O,me]=i.useState(""),[X,pe]=i.useState([]),[_,A]=i.useState([]),[ee,te]=i.useState([]),[M,he]=i.useState(""),[B,xe]=i.useState(""),[I,fe]=i.useState(""),[Y,je]=i.useState(""),[C,ge]=i.useState(""),x=(s==null?void 0:s._id)||(s==null?void 0:s.id),{data:be,isLoading:ve}=ie({queryKey:[`/api/profile/${x}`],enabled:!!x}),{data:n,isLoading:ye}=ie({queryKey:[`/api/address/default/address/${x}`],enabled:!!x});i.useEffect(()=>{const t=Be.getAllCountries();pe(t);const a=t.find(l=>l.isoCode==="US");if(a&&!D){Q(a.name),Z(a.isoCode);const l=oe.getStatesOfCountry(a.isoCode);A(l)}},[]),i.useEffect(()=>{if(d){const t=oe.getStatesOfCountry(d);A(t)}},[d]),i.useEffect(()=>{if(d&&h){const t=Ie.getCitiesOfState(d,h);te(t)}},[d,h]),i.useEffect(()=>{n!=null&&n.address&&v("bank")},[n]);const Se=t=>{const a=X.find(l=>l.isoCode===t);a&&(Q(a.name),Z(a.isoCode),G(""),U(""),L(""),te([]))},Ne=t=>{const a=_.find(l=>l.isoCode===t);a&&(G(a.name),U(a.isoCode),L(""))},$=le({mutationFn:async t=>{const a=await fetch("/api/address",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!a.ok){const l=await a.json();throw new Error(l.message||"Failed to save address")}return a.json()},onSuccess:()=>{c({title:"Address Saved",description:"Your address has been saved successfully"}),Me.invalidateQueries({queryKey:["/api/address/default/address"]}),v("bank")},onError:t=>{c({title:"Error",description:t.message||"Failed to save address",variant:"destructive"})}}),Ce=t=>{if(t.preventDefault(),!y||!D||!E||!S||!N||!O){c({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}const a={name:s!=null&&s.firstName&&(s!=null&&s.lastName)?`${s.firstName} ${s.lastName}`:"Default",addrress1:y,addrress2:P,country:D,city:S,countryCode:d,zipcode:N,state:E,stateCode:h,userId:x,phone:O.trim().replace(/\s/g,""),email:(s==null?void 0:s.email)||"",primary:!1,applying:!1};$.mutate(a)},z=le({mutationFn:async t=>{const a=await fetch(`/api/stripe/connect/${x}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const l=await a.json();throw new Error(l.error||l.message||"Failed to create Stripe account")}return a.json()},onSuccess:t=>{if(t.success===!1){c({title:"Error",description:t.error||"Failed to create Stripe account",variant:"destructive"});return}c({title:"Bank Account Connected",description:"Your bank account has been connected successfully."}),v("complete")},onError:t=>{c({title:"Error",description:t.message,variant:"destructive"})}}),we=t=>{if(t.preventDefault(),!M||!B||!I||!Y||!C){c({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}const a=new Date(C),l=new Date,f=l.getFullYear()-a.getFullYear(),w=l.getMonth()-a.getMonth();if(!(f>18||f===18&&w>=0)){c({title:"Age Requirement",description:"You must be at least 18 years old to become a seller.",variant:"destructive"});return}const R=new Date(C),r=(n==null?void 0:n.address)||(s==null?void 0:s.address),De={country:"US",currency:"usd",account_number:M,city:(r==null?void 0:r.city)||S,state:(r==null?void 0:r.state)||E,day:R.getDate().toString(),month:(R.getMonth()+1).toString(),year:R.getFullYear().toString(),ssn_last_4:I,line1:(r==null?void 0:r.addrress1)||(r==null?void 0:r.address1)||y,line2:(r==null?void 0:r.addrress2)||(r==null?void 0:r.address2)||P||"",postal_code:(r==null?void 0:r.zipcode)||N,countryCode:(r==null?void 0:r.countryCode)||d,phone:Y,routing_number:B,email:(s==null?void 0:s.email)||"",name:(s==null?void 0:s.firstName)||"",first_name:(s==null?void 0:s.firstName)||"",last_name:(s==null?void 0:s.lastName)||"",create_address:!r,account_holder_name:`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()};z.mutate(De)},ke=()=>{s!=null&&s.seller?q("/seller/hub"):(c({title:"Application Submitted",description:"Your seller application is being reviewed. You'll be notified once approved."}),q("/marketplace"))};if(ye||ve)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-primary"})});const u=be||s,Fe=u==null?void 0:u.applied_seller,qe=u==null?void 0:u.seller;if(Fe&&!qe)return e.jsx("div",{className:"py-4 sm:py-6 lg:py-8 w-full","data-testid":"page-seller-review",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsx(k,{className:"max-w-2xl mx-auto",children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-6 py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-20 w-20 rounded-full bg-yellow-500/10 flex items-center justify-center",children:e.jsx(Ye,{className:"h-10 w-10 text-yellow-600"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"Application Under Review"}),e.jsx("p",{className:"text-muted-foreground text-base mb-2",children:"Your seller application is currently being reviewed by our team."}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["We'll notify you via email at ",e.jsx("span",{className:"font-medium text-foreground",children:u==null?void 0:u.email})," once your account is approved."]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx($e,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1 text-sm",children:"What happens next?"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Our team typically reviews applications within 1-2 business days. Once approved, you'll be able to list products, host live shows, and start selling on ",J.app_name,"."]})]})]})}),e.jsx("div",{className:"flex flex-col gap-3 pt-4",children:e.jsx(j,{onClick:()=>q("/marketplace"),variant:"outline",size:"lg","data-testid":"button-back-to-marketplace",children:"Return to Marketplace"})})]})})})})});const Pe=n!=null&&n.address?b.findIndex(t=>t.id===p):b.findIndex(t=>t.id===p);return e.jsxs("div",{className:"py-4 sm:py-6 lg:py-8 w-full","data-testid":"page-seller-setup",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2","data-testid":"heading-seller-setup",children:"Complete Seller Setup"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Set up your seller account to start selling on ",J.app_name]})]}),e.jsx("div",{className:"mb-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between",children:b.map((t,a)=>{if(t.id==="address"&&(n!=null&&n.address))return null;const l=t.id===p,f=a<Pe||t.id==="address"&&(n==null?void 0:n.address),w=n!=null&&n.address&&t.id!=="address"?a-1:a,se=n!=null&&n.address?b.length-1:b.length;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`flex items-center justify-center h-10 w-10 rounded-full border-2 transition-colors ${f?"bg-green-500 border-green-500 text-white":l?"bg-primary border-primary text-primary-foreground":"bg-background border-muted-foreground/30 text-muted-foreground"}`,children:f?e.jsx(ze,{className:"h-5 w-5"}):e.jsx("span",{className:"text-sm font-semibold",children:w+1})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:`text-xs sm:text-sm font-medium ${l?"text-foreground":"text-muted-foreground"}`,children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:t.description})]})]}),w<se-1&&e.jsx("div",{className:`h-0.5 flex-1 mx-2 transition-colors ${f?"bg-green-500":"bg-muted"}`})]},t.id)})})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[p==="address"&&!(n!=null&&n.address)&&e.jsxs(k,{children:[e.jsxs(ae,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"Shipping Address"]}),e.jsx(re,{children:"Enter your primary shipping address for order fulfillment"})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:Ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"street-address",children:"Street Address *"}),e.jsx(m,{id:"street-address",placeholder:"123 Main Street",value:y,onChange:t=>de(t.target.value),required:!0,"data-testid":"input-street-address"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"street-address-2",children:"Street Address 2 (Optional)"}),e.jsx(m,{id:"street-address-2",placeholder:"Apt, Suite, Unit, etc.",value:P,onChange:t=>ce(t.target.value),"data-testid":"input-street-address-2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"country",children:"Country *"}),e.jsxs(T,{value:d,onValueChange:Se,required:!0,children:[e.jsx(V,{id:"country","data-testid":"select-country",children:e.jsx(W,{placeholder:"Select country"})}),e.jsx(K,{className:"max-h-[200px]",children:X.map(t=>e.jsx(g,{value:t.isoCode,children:t.name},t.isoCode))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"state",children:"State/Province *"}),e.jsxs(T,{value:h,onValueChange:Ne,required:!0,disabled:!d,children:[e.jsx(V,{id:"state","data-testid":"select-state",children:e.jsx(W,{placeholder:"Select state/province"})}),e.jsx(K,{className:"max-h-[200px]",children:_.length>0?_.map(t=>e.jsx(g,{value:t.isoCode,children:t.name},t.isoCode)):e.jsx(g,{value:"none",disabled:!0,children:"No states available"})})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"city",children:"City *"}),e.jsxs(T,{value:S,onValueChange:t=>L(t),required:!0,disabled:!h,children:[e.jsx(V,{id:"city","data-testid":"select-city",children:e.jsx(W,{placeholder:"Select city"})}),e.jsx(K,{className:"max-h-[200px]",children:ee.length>0?ee.map(t=>e.jsx(g,{value:t.name,children:t.name},t.name)):e.jsx(g,{value:"none",disabled:!0,children:"No cities available"})})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"zip",children:"ZIP/Postal Code *"}),e.jsx(m,{id:"zip",placeholder:"10001",value:N,onChange:t=>ue(t.target.value),required:!0,"data-testid":"input-zip"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"phone",children:"Phone Number *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 123-4567",value:O,onChange:t=>me(t.target.value),required:!0,"data-testid":"input-phone"})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx(j,{type:"submit",className:"flex-1",disabled:$.isPending,"data-testid":"button-save-address",children:$.isPending?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:["Continue",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})})})]})})]}),p==="bank"&&e.jsxs(k,{children:[e.jsxs(ae,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Where do you want to withdraw your earnings to?"]}),e.jsx(re,{children:"Enter your bank account details to receive seller payouts"})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"account-number",children:"Account Number *"}),e.jsx(m,{id:"account-number",placeholder:"000123456789",value:M,onChange:t=>he(t.target.value),required:!0,"data-testid":"input-account-number"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"routing-number",children:"Routing Number *"}),e.jsx(m,{id:"routing-number",placeholder:"110000000",value:B,onChange:t=>xe(t.target.value),required:!0,"data-testid":"input-routing-number"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"ssn-last4",children:"SSN Last 4 Digits *"}),e.jsx(m,{id:"ssn-last4",placeholder:"0000",maxLength:4,value:I,onChange:t=>fe(t.target.value.replace(/\D/g,"")),required:!0,"data-testid":"input-ssn-last4"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"bank-phone",children:"Phone Number *"}),e.jsx(m,{id:"bank-phone",type:"tel",placeholder:"+17297409480",value:Y,onChange:t=>je(t.target.value),required:!0,"data-testid":"input-bank-phone"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"dob",children:"Date of Birth *"}),e.jsx(m,{id:"dob",type:"date",value:C,onChange:t=>ge(t.target.value),required:!0,"data-testid":"input-dob"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[!(n!=null&&n.address)&&e.jsx(j,{variant:"outline",onClick:()=>v("address"),type:"button","data-testid":"button-back",children:"Back"}),e.jsx(j,{type:"submit",className:"flex-1",disabled:z.isPending,"data-testid":"button-save-bank",children:z.isPending?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save and Continue"})]})]})})]}),p==="complete"&&e.jsx(k,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-16 w-16 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(We,{className:"h-8 w-8 text-white"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Setup Complete!"}),e.jsx("p",{className:"text-muted-foreground",children:s!=null&&s.seller?"Your seller account is ready. Start listing products and hosting shows!":"Your application has been submitted. An admin will review your account and contact you soon."})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx(j,{onClick:ke,size:"lg","data-testid":"button-finish-setup",children:s!=null&&s.seller?"Go to Seller Hub":"Return to Marketplace"}),!(s!=null&&s.seller)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We'll email you at ",e.jsx("span",{className:"font-medium",children:s==null?void 0:s.email})," once your account is approved."]})]})]})})})]})]})}export{ft as default};
