import{Q as ae,a as ie}from"./useQuery-DsZx8GVA.js";import{a1 as W,a2 as re,a3 as ne,f as oe,j as s,L as T,d as $,q as ce}from"./index-FVTY5sKH.js";import{A as H,a as q,b as J}from"./avatar-BgbrThQo.js";import{t as le,m as G,a as X,f as C}from"./format-D46ChU1D.js";import{B as K,i as de,a as ue}from"./isTomorrow-B3a_VsBR.js";var me=class extends ae{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:W()})}getOptimisticResult(e){return e.behavior=W(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var f,N;const{state:i}=e,a=super.createResult(e,t),{isFetching:n,isRefetching:c,isError:r,isRefetchError:l}=a,o=(N=(f=i.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:N.direction,d=r&&o==="forward",x=n&&o==="forward",g=r&&o==="backward",y=n&&o==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ne(t,i.data),hasPreviousPage:re(t,i.data),isFetchNextPageError:d,isFetchingNextPage:x,isFetchPreviousPageError:g,isFetchingPreviousPage:y,isRefetchError:l&&!d&&!g,isRefetching:c&&!x&&!y}}};function Ae(e,t){return ie(e,me)}function fe(e){return+le(e)<Date.now()}function pe(e,t){const a=Ne(e);let n;if(a.date){const o=be(a.date,2);n=ve(o.restDateString,o.year)}if(!n||isNaN(n.getTime()))return new Date(NaN);const c=n.getTime();let r=0,l;if(a.time&&(r=je(a.time),isNaN(r)))return new Date(NaN);if(a.timezone){if(l=ye(a.timezone),isNaN(l))return new Date(NaN)}else{const o=new Date(c+r),d=new Date(0);return d.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),d.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),d}return new Date(c+r+l)}const w={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},he=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,xe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ge=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ne(e){const t={},i=e.split(w.dateTimeDelimiter);let a;if(i.length>2)return t;if(/:/.test(i[0])?a=i[0]:(t.date=i[0],a=i[1],w.timeZoneDelimiter.test(t.date)&&(t.date=e.split(w.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){const n=w.timezone.exec(a);n?(t.time=a.replace(n[1],""),t.timezone=n[1]):t.time=a}return t}function be(e,t){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(i);if(!a)return{year:NaN,restDateString:""};const n=a[1]?parseInt(a[1]):null,c=a[2]?parseInt(a[2]):null;return{year:c===null?n:c*100,restDateString:e.slice((a[1]||a[2]).length)}}function ve(e,t){if(t===null)return new Date(NaN);const i=e.match(he);if(!i)return new Date(NaN);const a=!!i[4],n=j(i[1]),c=j(i[2])-1,r=j(i[3]),l=j(i[4]),o=j(i[5])-1;if(a)return Te(t,l,o)?De(t,l,o):new Date(NaN);{const d=new Date(0);return!we(t,c,r)||!Pe(t,n)?new Date(NaN):(d.setUTCFullYear(t,c,Math.max(n,r)),d)}}function j(e){return e?parseInt(e):1}function je(e){const t=e.match(xe);if(!t)return NaN;const i=S(t[1]),a=S(t[2]),n=S(t[3]);return $e(i,a,n)?i*G+a*X+n*1e3:NaN}function S(e){return e&&parseFloat(e.replace(",","."))||0}function ye(e){if(e==="Z")return 0;const t=e.match(ge);if(!t)return 0;const i=t[1]==="+"?-1:1,a=parseInt(t[2]),n=t[3]&&parseInt(t[3])||0;return Ce(a,n)?i*(a*G+n*X):NaN}function De(e,t,i){const a=new Date(0);a.setUTCFullYear(e,0,4);const n=a.getUTCDay()||7,c=(t-1)*7+i+1-n;return a.setUTCDate(a.getUTCDate()+c),a}const ke=[31,null,31,30,31,30,31,31,30,31,30,31];function ee(e){return e%400===0||e%4===0&&e%100!==0}function we(e,t,i){return t>=0&&t<=11&&i>=1&&i<=(ke[t]||(ee(e)?29:28))}function Pe(e,t){return t>=1&&t<=(ee(e)?366:365)}function Te(e,t,i){return t>=1&&t<=53&&i>=0&&i<=6}function $e(e,t,i){return e===24?t===0&&i===0:i>=0&&i<60&&t>=0&&t<60&&e>=0&&e<25}function Ce(e,t){return t>=0&&t<=59}const V=()=>s.jsx("div",{className:"absolute inset-0 grid grid-cols-8 grid-rows-12 gap-0",children:Array.from({length:96}).map((e,t)=>s.jsx("div",{className:"flex items-center justify-center",style:{opacity:.1+Math.random()*.3},children:s.jsx("svg",{viewBox:"0 0 200 200",className:"w-full h-full text-gray-600",children:s.jsx("path",{fill:"currentColor",d:"M100 30 L170 100 L100 170 L30 100 Z"})})},t))});function Ee({show:e,currentUserId:t,variant:i="grid",categoryName:a,showHostInfo:n=!0}){var O,U,A,E,Y,_,z,L,B,Q,Z;const{toast:c}=oe(),r=e._id||e.id||"",l=((O=e.viewers)==null?void 0:O.length)||e.viewersCount||0,o=((U=e.owner)==null?void 0:U.userName)||((E=(A=e.owner)==null?void 0:A.firstName)==null?void 0:E.trim())||"Host",d=(Y=e.owner)!=null&&Y.profilePhoto&&e.owner.profilePhoto.trim()?e.owner.profilePhoto:"",x=((_=e.owner)==null?void 0:_._id)||((z=e.owner)==null?void 0:z.id)||"",g=((L=e.shipping_settings)==null?void 0:L.freePickupEnabled)===!0,y=((B=e.shipping_settings)==null?void 0:B.shippingCostMode)==="buyer_pays_up_to",P=t===x,f=((Q=e.invitedhostIds)==null?void 0:Q.includes(t))||!1,N=((Z=e.invitedhostIds)==null?void 0:Z.length)||0,u=e.date?typeof e.date=="string"?pe(e.date):e.date:null,I=e.started===!0,p=I,M=u?fe(u):!1,R=!I&&M,D=!u||M?null:de(u)?`Today, ${C(u,"h:mm a")}`:ue(u)?`Tomorrow, ${C(u,"h:mm a")}`:C(u,"MMM d, h:mm a"),F=async v=>{v.preventDefault(),v.stopPropagation();try{const m=e.invitedhostIds||[],h=m.includes(t),k=h?m.filter(se=>se!==t):[...m,t];(await fetch(`/api/rooms/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({invitedhostIds:k})})).ok&&(c({title:h?"Notification Removed":"Notification Set",description:h?"You won't be notified about this show":"We'll notify you when the show starts!"}),ce.invalidateQueries({queryKey:["/api/rooms"]}))}catch{c({title:"Error",description:"Failed to update notification.",variant:"destructive"})}},te=()=>{var h,k;const v=((h=e.owner)==null?void 0:h.firstName)||"",m=((k=e.owner)==null?void 0:k.lastName)||"";return v&&m?`${v.charAt(0)}${m.charAt(0)}`.toUpperCase():o.charAt(0).toUpperCase()},b=a||(typeof e.category=="object"&&e.category?e.category.name:e.category);return i==="profile"?s.jsxs("div",{className:"group cursor-pointer","data-testid":`show-${r}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2 px-0.5",children:[s.jsxs(H,{className:"h-5 w-5 flex-shrink-0",children:[s.jsx(q,{src:d}),s.jsx(J,{className:"text-xs",children:te()})]}),s.jsx("span",{className:"text-xs font-medium text-foreground truncate",children:o})]}),s.jsxs("div",{className:"relative",children:[s.jsx(T,{href:`/show/${r}`,children:s.jsxs("div",{className:"relative aspect-[3/4] bg-gray-800 rounded-lg overflow-hidden mb-2",children:[e.thumbnail?s.jsx("img",{src:e.thumbnail,alt:e.title,className:"absolute inset-0 w-full h-full object-cover"}):s.jsx(V,{}),s.jsxs("div",{className:"absolute top-1.5 left-1.5 flex flex-col gap-1",children:[p&&s.jsxs("div",{className:"bg-red-600 text-white text-xs px-2 py-0.5 font-bold rounded flex items-center gap-1","data-testid":`badge-live-${r}`,children:["Live - ",l]}),!p&&D&&s.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black text-xs px-2 py-0.5 rounded font-medium","data-testid":`badge-date-${r}`,children:D})]})]})}),s.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 z-10",children:[!p&&l>0&&s.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black text-xs px-1.5 py-0.5 rounded font-semibold","data-testid":`badge-viewers-${r}`,children:l}),t&&!P&&s.jsx("button",{className:"bg-white/90 backdrop-blur-sm text-black rounded p-1 hover:bg-white transition-colors","data-testid":`button-bookmark-${r}`,onClick:F,children:s.jsx(K,{className:$("h-3.5 w-3.5",f&&"fill-current")})})]})]}),s.jsxs("div",{className:"space-y-1 px-0.5",children:[s.jsx("p",{className:"text-sm font-medium line-clamp-2 leading-snug text-foreground","data-testid":`show-title-${r}`,children:e.title||"Untitled Show"}),b&&s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:b})]})]}):s.jsx("div",{className:"group cursor-pointer","data-testid":`card-giveaway-${r}`,children:s.jsxs("div",{className:"space-y-1.5",children:[n&&s.jsxs(T,{href:`/profile/${x}`,className:"flex items-center gap-1.5 px-0.5 group/host","data-testid":`link-host-${r}`,children:[s.jsxs(H,{className:"h-6 w-6 flex-shrink-0","data-testid":`avatar-${r}`,children:[s.jsx(q,{src:d}),s.jsx(J,{className:"text-xs",children:o.charAt(0).toUpperCase()})]}),s.jsx("span",{className:"text-xs font-medium text-foreground truncate group-hover/host:underline",children:o})]}),s.jsxs("div",{className:"relative",children:[s.jsx(T,{href:`/show/${r}`,"data-testid":`link-giveaway-${r}`,children:s.jsxs("div",{className:"relative aspect-[3/4] rounded-sm overflow-hidden bg-gray-800",children:[e.thumbnail||e.coverImage?s.jsx("img",{src:e.thumbnail||e.coverImage,alt:e.title,className:"absolute inset-0 w-full h-full object-cover"}):s.jsx(V,{}),s.jsxs("div",{className:"absolute top-1.5 left-1.5 flex flex-col gap-1",children:[p&&s.jsxs("div",{className:"bg-red-600 text-white px-2 py-0.5 text-xs font-bold rounded flex items-center gap-1.5 shadow-lg","data-testid":`badge-live-${r}`,children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"LIVE",s.jsx("span",{className:"font-semibold",children:l})]}),R&&!p&&s.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black px-2 py-0.5 text-xs rounded","data-testid":`badge-starting-soon-${r}`,children:"Starting Soon"}),D&&!p&&!R&&s.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black px-2 py-0.5 text-xs rounded","data-testid":`badge-date-${r}`,children:D}),g&&s.jsx("div",{className:"bg-green-600 text-white font-semibold px-2 py-0.5 text-xs rounded","data-testid":`badge-free-shipping-${r}`,children:"Free shipping"}),!g&&y&&s.jsx("div",{className:"bg-blue-600 text-white font-semibold px-2 py-0.5 text-xs rounded","data-testid":`badge-reduced-shipping-${r}`,children:"Reduced shipping"})]}),s.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"})]})}),t&&!P&&s.jsx("div",{className:"absolute top-1.5 right-1.5 z-10",children:s.jsxs("button",{className:$("font-semibold px-2 py-0.5 text-xs rounded-full flex items-center gap-1 cursor-pointer hover:opacity-90 transition-opacity",f?"bg-primary text-primary-foreground":"bg-white text-black"),"data-testid":`badge-bookmarks-${r}`,onClick:F,children:[s.jsx(K,{className:$("h-3 w-3",f&&"fill-current")}),N>0&&N]})})]}),s.jsxs("div",{className:"space-y-0.5 px-0.5",children:[s.jsx("h3",{className:"text-sm font-medium line-clamp-2 leading-snug text-foreground",children:e.title}),s.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[b&&s.jsx("span",{className:"text-primary font-medium",children:b}),e.description&&b&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-muted-foreground",children:"â€¢"}),s.jsx("span",{className:"text-muted-foreground line-clamp-1",children:e.description})]})]})]})]})})}export{Ee as S,Ae as u};
