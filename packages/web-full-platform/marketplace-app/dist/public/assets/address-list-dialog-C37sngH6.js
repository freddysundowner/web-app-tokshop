import{c as ye,e as Z,a as J,r as m,q as je,k as q,j as e}from"./index-sx6K5zvX.js";import{D as G,a as X,b as ee,c as se,d as pe,e as be}from"./dialog-lan0uYA-.js";import{B as z}from"./button-BhKWRVKT.js";import{S as B}from"./separator-GUgqmzB4.js";import{u as K}from"./useQuery-BbAFWd3P.js";import{u as Ne}from"./useMutation-CvlU_VR_.js";import{C as ie}from"./chevron-right-BMekTT0X.js";import{P as we}from"./plus-C4q9dHNM.js";import{C as oe}from"./credit-card-dlBmie7d.js";import{M as ce}from"./map-pin-CyryTmSF.js";import{L as M}from"./loader-circle-B7f4O2pk.js";import{A as ve}from"./add-payment-dialog-DVik9UeH.js";import{C as xe}from"./circle-check-dbnmriGo.js";import{T as he}from"./trash-2-DvJeVEKj.js";import{I as H}from"./input-D9aLazCK.js";import{L as E}from"./label-BJe6VCdD.js";import{S as ne,a as le,b as de,c as re,d as O}from"./select-C7m4p16O.js";import{C as Ce,S as W,a as me}from"./city-BO9769IJ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ye("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);function Ye({open:p,onOpenChange:v,product:s,onOpenPaymentMethods:i,onOpenShippingAddresses:C}){var Q,U,Y;const{toast:y}=Z(),{user:n}=J(),[x,$]=m.useState(1),[b,D]=m.useState(!1),N=(s==null?void 0:s.quantity)||1,S=N>1,A=(n==null?void 0:n._id)||(n==null?void 0:n.id)||(n==null?void 0:n.id),{data:j}=K({queryKey:[`/api/users/paymentmethod/default/${A}`],enabled:p&&!!A}),h=j!=null&&j.data?j.data:j||null,l=n==null?void 0:n.address,{data:r,isLoading:T}=K({queryKey:["/api/shipping/estimate",s==null?void 0:s._id,x,l==null?void 0:l.id],queryFn:async()=>{if(!(s!=null&&s.shipping_profile)||!l)return{amount:"0.00"};const w=(n==null?void 0:n._id)||(n==null?void 0:n.id)||(n==null?void 0:n.id),k=s._id||s.id;let P="";return typeof s.owner=="string"?P=s.owner:s.owner&&(P=s.owner._id||s.owner.id||""),!P&&s.ownerId&&(P=typeof s.ownerId=="string"?s.ownerId:s.ownerId._id||s.ownerId.id||""),await q("POST","/api/shipping/estimate",{weight:s.shipping_profile.weight,unit:s.shipping_profile.scale||"oz",product:k,owner:P,customer:w,tokshow:s.tokshow,buying_label:!0})},enabled:p&&!!((Q=s==null?void 0:s.shipping_profile)!=null&&Q.weight)&&!!l&&!!n}),{data:I,isLoading:_}=K({queryKey:["/api/tax/estimate",s==null?void 0:s.id,x],enabled:p&&!!(s!=null&&s.id)});m.useEffect(()=>{p&&($(1),D(!1))},[p]);const L=()=>{x<N&&$(x+1)},d=()=>{x>1&&$(x-1)},c=((s==null?void 0:s.price)||0)*x,f=parseFloat((r==null?void 0:r.amount)||"0"),a=parseFloat((I==null?void 0:I.tax)||"0"),g=c+f+a,F=Ne({mutationFn:async()=>{const w=s._id||s.id;let k="";typeof s.owner=="string"?k=s.owner:s.owner&&(k=s.owner._id||s.owner.id||""),!k&&s.ownerId&&(k=typeof s.ownerId=="string"?s.ownerId:s.ownerId._id||s.ownerId.id||"");const P={product:w,status:"processing",shippingFee:parseFloat((r==null?void 0:r.amount)||"0"),servicelevel:(r==null?void 0:r.servicelevel)||"",rate_id:(r==null?void 0:r.rate_id)||"",bundleId:(r==null?void 0:r.bundleId)||"",totalWeightOz:parseFloat((r==null?void 0:r.totalWeightOz)||"0"),seller_shipping_fee_pay:parseFloat((r==null?void 0:r.seller_shipping_fee_pay)||"0"),subtotal:c,tax:parseFloat(a.toString()||"0"),seller:k,buyer:A,quantity:x,total:parseFloat(g.toFixed(2)),color:"",size:"",tokshow:s.tokshow||""};return await q("POST",`/api/orders/${w}`,P)},onSuccess:w=>{y({title:"Purchase Successful!",description:"Your order has been placed"}),je.invalidateQueries({queryKey:["/api/orders"]}),v(!1)},onError:w=>{var P;const k=((P=w==null?void 0:w.response)==null?void 0:P.error)||(w==null?void 0:w.message)||"Failed to complete purchase";y({title:"Purchase Failed",description:k,variant:"destructive"})}}),te=()=>{if(!h){y({title:"No Payment Method",description:"Please add a payment method first",variant:"destructive"});return}if(!l){y({title:"No Address",description:"Please add a shipping address first",variant:"destructive"});return}if(x>N){y({title:"Quantity Error",description:"Quantity exceeds available stock",variant:"destructive"});return}F.mutate()};return e.jsx(G,{open:p,onOpenChange:v,children:e.jsxs(X,{className:"bg-zinc-900 border-zinc-800 text-white max-w-lg max-h-[90vh] overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[e.jsx(ee,{children:e.jsx(se,{className:"text-white text-xl",children:"Buy Now"})}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex gap-4",children:[((U=s==null?void 0:s.images)==null?void 0:U[0])&&e.jsx("div",{className:"w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden bg-zinc-800",children:e.jsx("img",{src:s.images[0],alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-base leading-tight mb-1",children:s==null?void 0:s.name}),N>0&&e.jsxs("p",{className:"text-sm text-zinc-400",children:[N," available"]})]})]}),e.jsx(B,{className:"bg-zinc-800"}),S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>D(!b),className:"w-full flex items-center justify-between py-2 text-sm","data-testid":"button-toggle-quantity",children:[e.jsxs("span",{className:"font-medium",children:["Quantity: ",x]}),e.jsx(ie,{className:`h-4 w-4 text-zinc-400 transition-transform ${b?"rotate-90":""}`})]}),b&&e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx(z,{size:"icon",variant:"outline",className:"h-9 w-9 border-zinc-700 bg-zinc-800 text-white hover:bg-zinc-700",onClick:d,disabled:x<=1,"data-testid":"button-decrement-quantity",children:e.jsx(Se,{className:"h-4 w-4",style:{color:"white",stroke:"white"}})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("span",{className:"text-lg font-bold",children:x})}),e.jsx(z,{size:"icon",variant:"outline",className:"h-9 w-9 border-zinc-700 bg-zinc-800 text-white hover:bg-zinc-700",onClick:L,disabled:x>=N,"data-testid":"button-increment-quantity",children:e.jsx(we,{className:"h-4 w-4",style:{color:"white",stroke:"white"}})})]})]}),e.jsx(B,{className:"bg-zinc-800"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("button",{onClick:i,className:"w-full flex items-center justify-between py-3 hover:bg-zinc-800/50 rounded-lg px-2 transition-colors","data-testid":"button-payment-method",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-5 w-5 text-zinc-400"}),h?e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-sm",children:[(Y=h.brand)==null?void 0:Y.toUpperCase()," •••• ",h.last4]}),h.exp_month&&h.exp_year&&e.jsxs("p",{className:"text-xs text-zinc-400",children:["Expires ",String(h.exp_month).padStart(2,"0"),"/",h.exp_year]})]}):e.jsx("span",{className:"text-sm text-zinc-400",children:"Add payment method"})]}),e.jsx(ie,{className:"h-4 w-4 text-zinc-400"})]})]}),e.jsx(B,{className:"bg-zinc-800"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Shipping Address"}),e.jsxs("button",{onClick:C,className:"w-full flex items-center justify-between py-3 hover:bg-zinc-800/50 rounded-lg px-2 transition-colors","data-testid":"button-shipping-address",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-zinc-400"}),l?e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"text-sm",children:[(l==null?void 0:l.addrress1)||(l==null?void 0:l.address1)||"Address on file",l.city&&`, ${l.city}`]}),e.jsxs("p",{className:"text-xs text-zinc-400",children:[l.state&&`${l.state} `,l.zipcode]})]}):e.jsx("span",{className:"text-sm text-zinc-400",children:"Add shipping address"})]}),e.jsx(ie,{className:"h-4 w-4 text-zinc-400"})]})]}),e.jsx(B,{className:"bg-zinc-800"}),e.jsxs("div",{className:"space-y-2 bg-zinc-800/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-zinc-400",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["$",c.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-zinc-400",children:"Shipping"}),T?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsxs("span",{className:"font-medium",children:["$",f.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-zinc-400",children:"Tax"}),_?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsxs("span",{className:"font-medium",children:["$",a.toFixed(2)]})]}),e.jsx(B,{className:"bg-zinc-700 my-2"}),e.jsxs("div",{className:"flex justify-between text-base font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",g.toFixed(2)]})]})]}),e.jsx(z,{className:"w-full h-12 text-base font-bold bg-primary hover:bg-primary/90 text-primary-foreground",onClick:te,disabled:F.isPending||!h||!l,"data-testid":"button-confirm-buy-now",children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-5 w-5 mr-2 animate-spin"}),"Processing..."]}):`Buy Now - $${g.toFixed(2)}`})]})]})})}function ke({open:p,onOpenChange:v,onSuccess:s,address:i}){const{toast:C}=Z(),{user:y}=J(),n=y,[x,$]=m.useState(!1),b=!!i,[D,N]=m.useState(""),[S,A]=m.useState(""),[j,h]=m.useState(""),[l,r]=m.useState(""),[T,I]=m.useState(""),[_,L]=m.useState(""),[d,c]=m.useState(""),[f,a]=m.useState(""),[g,F]=m.useState(""),[te,Q]=m.useState(""),[U,Y]=m.useState([]),[w,k]=m.useState([]),[P,V]=m.useState([]);m.useEffect(()=>{const t=Ce.getAllCountries();if(Y(t),i){Q(i.name||""),N(i.addrress1||i.address1||""),A(i.addrress2||i.address2||""),c(i.city||""),I(i.state||""),a(i.zipcode||i.zip||""),F(i.phone||"");const o=t.find(u=>u.isoCode===i.countryCode||u.name===i.country);if(o){h(o.name),r(o.isoCode);const u=W.getStatesOfCountry(o.isoCode);k(u);const ae=u.find(R=>R.name===i.state||R.isoCode===i.stateCode);if(ae){L(ae.isoCode);const R=me.getCitiesOfState(o.isoCode,ae.isoCode);V(R)}}}else{const o=t.find(u=>u.isoCode==="US");if(o&&!j){h(o.name),r(o.isoCode);const u=W.getStatesOfCountry(o.isoCode);k(u)}}},[i]),m.useEffect(()=>{if(l){const t=W.getStatesOfCountry(l);k(t),i||(I(""),L(""),c(""),V([]))}},[l]),m.useEffect(()=>{if(l&&_){const t=me.getCitiesOfState(l,_);V(t),i||c("")}},[l,_]);const ue=async()=>{if(!D||!j||!T||!d||!f||!g){C({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});return}$(!0);try{const t={name:te||(n==null?void 0:n.firstName)||"Default",addrress1:D,addrress2:S,country:j,city:d,countryCode:l,zipcode:f,state:T,stateCode:_,userId:n==null?void 0:n.id,phone:g.trim().replace(/\s/g,""),email:(n==null?void 0:n.email)||"",primary:(i==null?void 0:i.primary)||!1,applying:!1};b&&i._id?(await q("PUT",`/api/address/${i._id}`,t),C({title:"Address Updated",description:"Your shipping address has been updated successfully."})):(await q("POST","/api/address",t),C({title:"Address Added",description:"Your shipping address has been saved successfully."})),N(""),A("");const o=U.find(u=>u.isoCode==="US");if(o){h(o.name),r(o.isoCode);const u=W.getStatesOfCountry(o.isoCode);k(u)}I(""),L(""),c(""),V([]),a(""),F(""),Q(""),s&&s(),v(!1)}catch(t){console.error("Failed to add/update address:",t);let o=b?"Failed to update address. Please try again.":"Failed to add address. Please try again.";if(t!=null&&t.text)try{const u=JSON.parse(t.text);o=u.error||u.message||o}catch{typeof t.text=="string"&&(o=t.text)}else t!=null&&t.message&&(o=t.message);C({title:"Error",description:o,variant:"destructive"})}finally{$(!1)}},fe=t=>{const o=U.find(u=>u.isoCode===t);o&&(h(o.name),r(o.isoCode))},ge=t=>{const o=w.find(u=>u.isoCode===t);o&&(I(o.name),L(o.isoCode))};return e.jsx(G,{open:p,onOpenChange:v,children:e.jsxs(X,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto","data-testid":"dialog-add-address",children:[e.jsxs(ee,{children:[e.jsx(se,{children:b?"Edit Address":"Add New Address"}),e.jsx(pe,{children:b?"Update your shipping address.":"Add a new shipping or billing address."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"street-address",children:"Street Address"}),e.jsx(H,{id:"street-address",placeholder:"123 Main Street",value:D,onChange:t=>N(t.target.value),"data-testid":"input-street-address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"street-address-2",children:"Street Address 2 (Optional)"}),e.jsx(H,{id:"street-address-2",placeholder:"Apt, Suite, Unit, etc.",value:S,onChange:t=>A(t.target.value),"data-testid":"input-street-address-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"country",children:"Country"}),e.jsxs(ne,{value:l,onValueChange:fe,children:[e.jsx(le,{id:"country","data-testid":"select-country",children:e.jsx(de,{placeholder:"Select country"})}),e.jsx(re,{className:"z-[9999] max-h-[200px]",children:U.map(t=>e.jsx(O,{value:t.isoCode,children:t.name},t.isoCode))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"state",children:"State/Province"}),e.jsxs(ne,{value:_,onValueChange:ge,disabled:!l,children:[e.jsx(le,{id:"state","data-testid":"select-state",children:e.jsx(de,{placeholder:"Select state/province"})}),e.jsx(re,{className:"z-[9999] max-h-[200px]",children:w.length>0?w.map(t=>e.jsx(O,{value:t.isoCode,children:t.name},t.isoCode)):e.jsx(O,{value:"none",disabled:!0,children:"No states available"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"city",children:"City"}),e.jsxs(ne,{value:d,onValueChange:t=>c(t),disabled:!_,children:[e.jsx(le,{id:"city","data-testid":"select-city",children:e.jsx(de,{placeholder:"Select city"})}),e.jsx(re,{className:"z-[9999] max-h-[200px]",children:P.length>0?P.map(t=>e.jsx(O,{value:t.name,children:t.name},t.name)):e.jsx(O,{value:"none",disabled:!0,children:"No cities available"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"zip",children:"ZIP/Postal Code"}),e.jsx(H,{id:"zip",placeholder:"10001",value:f,onChange:t=>a(t.target.value),"data-testid":"input-zip"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{htmlFor:"phone",children:"Phone Number"}),e.jsx(H,{id:"phone",placeholder:"+1 (555) 123-4567",value:g,onChange:t=>F(t.target.value),"data-testid":"input-phone"})]})]}),e.jsxs(be,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>v(!1),disabled:x,"data-testid":"button-cancel",className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(z,{onClick:ue,disabled:x,"data-testid":"button-add-address",className:"w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-black",children:x?b?"Updating...":"Adding...":b?"Update Address":"Add Address"})]})]})})}function Ve({open:p,onOpenChange:v,onSuccess:s}){const{user:i,refreshUserData:C}=J(),{toast:y}=Z(),[n,x]=m.useState(!1),[$,b]=m.useState(null),[D,N]=m.useState(null),S=(i==null?void 0:i.id)||(i==null?void 0:i._id),{data:A,isLoading:j,refetch:h}=K({queryKey:[`/api/users/paymentmethod/${S}`],enabled:!!S&&p});m.useEffect(()=>{p&&S&&h()},[p,S,h]);const l=()=>{x(!0)},r=async()=>{x(!1),await h(),await C()},T=async d=>{if(i){N(d);try{await q("PUT","/stripe/default",{paymentMethodId:d,userid:S}),y({title:"Default Payment Set",description:"This payment method is now your default."}),await h(),await C()}catch(c){console.error("Failed to set default payment method:",c);let f="Failed to set default payment method. Please try again.";c!=null&&c.message&&(f=c.message),y({title:"Error",description:f,variant:"destructive"})}finally{N(null)}}},I=async d=>{if(i){b(d);try{await q("DELETE","/stripe/remove",{paymentMethodId:d,userid:S}),y({title:"Payment Method Deleted",description:"Your payment method has been removed."}),await h(),await C()}catch(c){console.error("Failed to delete payment method:",c);let f="Failed to delete payment method. Please try again.";c!=null&&c.message&&(f=c.message),y({title:"Error",description:f,variant:"destructive"})}finally{b(null)}}},_=Array.isArray(A)?A:[],L=_.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:p,onOpenChange:v,children:e.jsxs(X,{className:"sm:max-w-[500px]","data-testid":"dialog-payment-methods",children:[e.jsx(ee,{children:e.jsx(se,{children:"Payment Methods"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[j&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-8 w-8 mx-auto mb-3 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading payment methods..."})]}),!j&&L&&_.map(d=>e.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-4 bg-muted/30",children:[e.jsx(oe,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[d.primary&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),e.jsx("p",{className:"font-medium text-sm",children:"Default Payment"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(()=>{const c=d.name||d.brand||d.card_type||d.type||"",f=d.last4||d.lastFour||d.last_four||"",a=c?c.charAt(0).toUpperCase()+c.slice(1):"";return a&&f?`${a} ****${f}`:f?`Card ****${f}`:a?`${a} card on file`:"Payment method on file"})()}),d.expiry&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Expires ",d.expiry]}),!d.primary&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>T(d._id),disabled:D===d._id,className:"mt-2 h-7 text-xs","data-testid":`button-set-default-${d._id}`,children:D===d._id?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-3 w-3 mr-1 animate-spin"}),"Setting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"Set as Default"]})})]}),e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>I(d._id),disabled:$===d._id,className:"text-destructive hover:text-destructive hover:bg-destructive/10","data-testid":`button-delete-payment-${d._id}`,children:$===d._id?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(he,{className:"h-4 w-4"})})]},d._id)),!j&&!L&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(oe,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No payment methods added yet"})]}),e.jsx("button",{onClick:l,className:"text-sm text-primary hover:underline","data-testid":"link-add-new-payment",children:"Add new payment method"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(z,{variant:"default",className:"flex-1 bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90 rounded-full",onClick:()=>v(!1),"data-testid":"button-cancel-payment-list",children:"Cancel"}),e.jsx(z,{variant:"default",className:"flex-1 bg-yellow-400 text-black hover:bg-yellow-500 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500 rounded-full",onClick:()=>{v(!1),s&&s()},"data-testid":"button-save-payment-list",children:"Save"})]})]})}),e.jsx(ve,{open:n,onOpenChange:x,onSuccess:r})]})}function Re({open:p,onOpenChange:v,onSuccess:s}){const{user:i,refreshUserData:C}=J(),{toast:y}=Z(),[n,x]=m.useState(!1),[$,b]=m.useState(null),[D,N]=m.useState(null),[S,A]=m.useState(null),j=(i==null?void 0:i._id)||(i==null?void 0:i.id),{data:h,isLoading:l,refetch:r}=K({queryKey:[`/api/address/all/${j}`],enabled:!!j&&p}),T=a=>{b(a),x(!0)},I=()=>{b(null),x(!0)},_=async()=>{x(!1),await r(),await C()},L=async a=>{if(i){A(a);try{await q("PATCH",`/api/address/${a}`,{primary:!0,userId:j}),y({title:"Default Address Set",description:"This address is now your default."}),await r(),await C()}catch(g){console.error("Failed to set default address:",g);let F="Failed to set default address. Please try again.";g!=null&&g.message&&(F=g.message),y({title:"Error",description:F,variant:"destructive"})}finally{A(null)}}},d=async a=>{if(i){N(a);try{await q("DELETE",`/api/address/${a}`,{}),y({title:"Address Deleted",description:"Your address has been removed."}),await r(),await C()}catch(g){console.error("Failed to delete address:",g);let F="Failed to delete address. Please try again.";g!=null&&g.message&&(F=g.message),y({title:"Error",description:F,variant:"destructive"})}finally{N(null)}}},c=Array.isArray(h)?h:[],f=c.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(G,{open:p,onOpenChange:v,children:e.jsxs(X,{className:"sm:max-w-[500px]","data-testid":"dialog-addresses",children:[e.jsx(ee,{children:e.jsx(se,{children:"Shipping Addresses"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[l&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-8 w-8 mx-auto mb-3 animate-spin text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading addresses..."})]}),!l&&f&&c.map(a=>e.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-4 bg-muted/30",children:[e.jsx(ce,{className:"h-5 w-5 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[a.primary&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),e.jsx("p",{className:"font-medium text-sm",children:"Default Address"})]}),e.jsx("p",{className:"text-sm font-medium",children:a.name||"Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.addrress1||a.address1}),a.addrress2&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.addrress2}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.city,", ",a.state," ",a.zipcode||a.zip]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.countryCode}),a.phone&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Phone: ",a.phone]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>T(a),className:"h-7 text-xs","data-testid":`button-edit-address-${a._id}`,children:"Edit"}),!a.primary&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>L(a._id),disabled:S===a._id,className:"h-7 text-xs","data-testid":`button-set-default-address-${a._id}`,children:S===a._id?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-3 w-3 mr-1 animate-spin"}),"Setting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),"Set as Default"]})})]})]}),e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>d(a._id),disabled:D===a._id,className:"text-destructive hover:text-destructive hover:bg-destructive/10","data-testid":`button-delete-address-${a._id}`,children:D===a._id?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(he,{className:"h-4 w-4"})})]},a._id)),!l&&!f&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No addresses added yet"})]}),e.jsx("button",{onClick:I,className:"text-sm text-primary hover:underline","data-testid":"link-add-new-address",children:"Add new shipping address"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(z,{variant:"default",className:"flex-1 bg-black text-white hover:bg-black/90 dark:bg-white dark:text-black dark:hover:bg-white/90 rounded-full",onClick:()=>v(!1),"data-testid":"button-cancel-address-list",children:"Cancel"}),e.jsx(z,{variant:"default",className:"flex-1 bg-yellow-400 text-black hover:bg-yellow-500 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500 rounded-full",onClick:()=>{v(!1),s&&s()},"data-testid":"button-save-address-list",children:"Save"})]})]})}),e.jsx(ke,{open:n,onOpenChange:x,onSuccess:_,address:$})]})}export{ke as A,Ye as B,Ve as P,Re as a};
