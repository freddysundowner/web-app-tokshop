import{u as Ie,a as Me,f as Ae,b as Le,r as y,j as e,B as z,I as Re,q as Se}from"./index-FVTY5sKH.js";import{u as Ue}from"./useQuery-DsZx8GVA.js";import{u as Pe}from"./useMutation-DKG1zDtN.js";import{C as P,b as He,a as q,c as Q,d as R}from"./card-CF4CqaN2.js";import{B as Ee}from"./badge-BTf7a5Ku.js";import{T as Ve,a as ze,b as U}from"./tabs-BcVWc8Zy.js";import{S as Te,a as _e,b as Oe,c as $e,d as T}from"./select-D3ZFUKhx.js";import{c as Ne,f as u,a as Ke}from"./pricing-DCyf_yea.js";import{C as Ge}from"./pagination-1EOLrp3H.js";import{S as Je,a as We,b as Ye,c as Xe,d as Ze}from"./sheet-0oGlQBkt.js";import{S as H}from"./separator-QabP-acS.js";import{g as Be}from"./firebase-chat-COGJCOhY.js";import{P as ye}from"./package-dXPzRBiL.js";import{M as qe}from"./message-square-lk32N-n-.js";import{T as De}from"./truck-DDM-Vnwo.js";import{I as Qe}from"./info-DtDjUfLP.js";import{f as V}from"./format-D46ChU1D.js";import{S as et}from"./search-zDcbIzzp.js";import"./index-CoWBA0E_.js";import"./index-BaZiuLT8.js";import"./index-BdQq_4o_.js";import"./index-Cbw5mxKQ.js";import"./chevron-down-BD1mluAZ.js";import"./check-DWjWNqF1.js";import"./chevron-up-D8QnUA5s.js";import"./chevron-left-CnSIvoVj.js";import"./chevron-right-HRo85rGP.js";function tt({order:s,open:xe,onOpenChange:I,onCancelOrder:K,onViewShipment:v,onMessageBuyer:be,cancelLoading:M=!1}){var te,se,ae,o,w,ne,ie,D,F,re,le,de,ce,oe,t,n,h;const[,ue]=Ie(),{user:c}=Me(),{toast:k}=Ae(),{settings:A}=Le(),[G,J]=y.useState(!1);if(!s)return null;const N=(se=(te=s.items)==null?void 0:te[0])==null?void 0:se.productId;(ae=N==null?void 0:N.images)!=null&&ae[0]||(w=(o=s.giveaway)==null?void 0:o.images)!=null&&w[0],N!=null&&N.name||(ne=s.giveaway)!=null&&ne.name;const he=((ie=N==null?void 0:N.category)==null?void 0:ie.name)||((F=(D=s.giveaway)==null?void 0:D.category)==null?void 0:F.name)||"N/A",C=!!s.giveaway||s.ordertype==="giveaway",a=()=>{var r,x,m,d,j;const l=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Receipt - Order #${s.invoice||((r=s._id)==null?void 0:r.slice(-8))||"N/A"}</title>
          <style>
            body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .order-info { margin-bottom: 20px; }
            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .items-table th { background-color: #f2f2f2; }
            .totals { margin-top: 20px; text-align: right; }
            .total-line { display: flex; justify-content: space-between; margin: 5px 0; }
            .final-total { font-weight: bold; border-top: 2px solid #000; padding-top: 5px; }
            @media print { .no-print { display: none; } }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Order Receipt</h1>
            <p>${A.app_name||"TokShop"}</p>
          </div>
          
          <div class="order-info">
            <h3>Order #${s.invoice||((x=s._id)==null?void 0:x.slice(-8))||"N/A"}</h3>
            <p><strong>Date:</strong> ${V($,"MMM d, yyyy 'at' h:mm a")}</p>
            <p><strong>Status:</strong> ${s.label?"Label Created":((m=s.status)==null?void 0:m.charAt(0).toUpperCase())+((d=s.status)==null?void 0:d.slice(1))}</p>
            <p><strong>Customer:</strong> ${ee}</p>
            ${(j=s.customer)!=null&&j.email?`<p><strong>Email:</strong> ${s.customer.email}</p>`:""}
            ${s.tracking_number?`<p><strong>Tracking:</strong> ${s.tracking_number}</p>`:""}
          </div>

          <table class="items-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              ${(s.items||[]).map(g=>{var S;return`
                <tr>
                  <td>${((S=g.productId)==null?void 0:S.name)||"Unknown Product"}</td>
                  <td>${g.quantity||0}</td>
                  <td>${u(g.price||0)}</td>
                  <td>${u((g.quantity||0)*(g.price||0))}</td>
                </tr>
              `}).join("")}
            </tbody>
          </table>

          <div class="totals">
            <div class="total-line">
              <span>Subtotal:</span>
              <span>${u(p)}</span>
            </div>
            ${_>0?`
              <div class="total-line">
                <span>Tax:</span>
                <span>${u(_)}</span>
              </div>
            `:""}
            ${b>0?`
              <div class="total-line">
                <span>Shipping:</span>
                <span>${u(b)}</span>
              </div>
            `:""}
            <div class="total-line final-total">
              <span>Total:</span>
              <span>${u(L)}</span>
            </div>
          </div>

          <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button onclick="window.print()">Print Receipt</button>
            <button onclick="window.close()" style="margin-left: 10px;">Close</button>
          </div>
        </body>
      </html>
    `,i=window.open("","_blank","width=800,height=600");i?(i.document.write(l),i.document.close(),i.onload=()=>{i.print()}):k({title:"Print Blocked",description:"Unable to open print window. Please allow popups and try again.",variant:"destructive"})},p=Ne(s),_=s.tax||0,b=s.shipping_fee||0,L=p+_+b,E=A.commission_rate||0,W=p*E/100,f=s.seller_shipping_fee_pay||0,Y=2.9,O=.3,X=L*(Y/100)+O,pe=p-W-X-f,Z=()=>{const l=s.status||"processing",i={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},r=s.label?"Label Created":l.charAt(0).toUpperCase()+l.slice(1);return e.jsx(Ee,{className:i[l]||i.processing,"data-testid":"badge-order-status",children:r})},$=s.date?new Date(s.date):s.createdAt?new Date(s.createdAt):new Date,ge=V($,"dd MMM yyyy"),fe=V($,"h:mm a"),ee=((re=s.customer)==null?void 0:re.userName)||`${((le=s.customer)==null?void 0:le.firstName)||""} ${((de=s.customer)==null?void 0:de.lastName)||""}`.trim()||"Unknown",B=async()=>{var r,x,m,d,j;const l=(r=s.customer)==null?void 0:r._id,i=(c==null?void 0:c._id)||(c==null?void 0:c.id);if(!l||!i){k({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{J(!0);const g={firstName:(c==null?void 0:c.firstName)||"",lastName:(c==null?void 0:c.lastName)||"",userName:(c==null?void 0:c.userName)||"",profilePhoto:(c==null?void 0:c.profilePhoto)||""},S={firstName:((x=s.customer)==null?void 0:x.firstName)||"",lastName:((m=s.customer)==null?void 0:m.lastName)||"",userName:((d=s.customer)==null?void 0:d.userName)||"",profilePhoto:((j=s.customer)==null?void 0:j.profilePhoto)||""},me=await Be(i,l,g,S);ue(`/inbox/${me}`)}catch(g){console.error("Error creating chat:",g),k({title:"Error",description:"Failed to open chat. Please try again.",variant:"destructive"})}finally{J(!1)}};return e.jsx(Je,{open:xe,onOpenChange:I,children:e.jsxs(We,{className:"w-full sm:max-w-lg overflow-y-auto","data-testid":"sheet-order-details",children:[e.jsx(Ye,{className:"pb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(Xe,{className:"text-2xl",children:"Order"}),e.jsxs(Ze,{className:"text-lg text-muted-foreground mt-1","data-testid":"text-order-id",children:["#",s.invoice||((ce=s._id)==null?void 0:ce.slice(-8))||"N/A"]})]})})}),e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{children:Z()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Items"}),e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground py-2 px-3",children:"Product"}),e.jsx("th",{className:"text-center text-xs font-medium text-muted-foreground py-2 px-3",children:"Qty"}),e.jsx("th",{className:"text-right text-xs font-medium text-muted-foreground py-2 px-3",children:"Price"}),e.jsx("th",{className:"text-right text-xs font-medium text-muted-foreground py-2 px-3",children:"Total"})]})}),e.jsx("tbody",{children:s.items&&s.items.length>0?s.items.map((l,i)=>{var j;const r=l.productId,x=((j=r==null?void 0:r.images)==null?void 0:j[0])||"",m=(r==null?void 0:r.name)||"Product",d=(l.quantity||1)*(l.price||0);return e.jsxs("tr",{className:"border-t border-border","data-testid":`row-product-${i}`,children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:x?e.jsx("img",{src:x,alt:m,className:"w-full h-full object-cover","data-testid":`img-product-${i}`}):e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx("span",{className:"font-medium text-sm text-foreground","data-testid":`text-product-name-${i}`,children:m})]})}),e.jsx("td",{className:"py-3 px-3 text-center text-sm text-foreground","data-testid":`text-quantity-${i}`,children:l.quantity||1}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-foreground","data-testid":`text-price-${i}`,children:u(l.price||0)}),e.jsx("td",{className:"py-3 px-3 text-right text-sm font-medium text-foreground","data-testid":`text-total-${i}`,children:u(d)})]},i)}):s.giveaway?e.jsxs("tr",{className:"border-t border-border","data-testid":"row-product-giveaway",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:(oe=s.giveaway.images)!=null&&oe[0]?e.jsx("img",{src:s.giveaway.images[0],alt:s.giveaway.name,className:"w-full h-full object-cover","data-testid":"img-product-giveaway"}):e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx("span",{className:"font-medium text-sm text-foreground","data-testid":"text-product-name-giveaway",children:s.giveaway.name})]})}),e.jsx("td",{className:"py-3 px-3 text-center text-sm text-muted-foreground",children:"1"}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-muted-foreground",children:"Giveaway"}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-muted-foreground",children:u(0)})]}):null})]})}),!C&&e.jsx("button",{onClick:a,className:"mt-3 text-sm text-primary font-medium hover:underline","data-testid":"button-view-receipt",children:"View receipt"})]}),e.jsxs("button",{onClick:B,disabled:G,className:"w-full flex items-center justify-between p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"button-message-buyer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-foreground"})}),e.jsx("span",{className:"font-medium text-foreground",children:G?"Loading...":"Message the buyer"})]}),e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),(s.tracking_number||s.label)&&e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsx("p",{className:"font-medium text-foreground mb-3",children:"This order is attached to a shipment."}),s.tracking_number&&e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipment"}),e.jsxs("span",{className:"text-primary font-medium","data-testid":"text-tracking-number",children:["#",s.tracking_number]})]}),((t=s.customer)==null?void 0:t.address)&&e.jsxs("div",{className:"flex justify-between text-sm mb-3",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ship to"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.customer.address.addrress1}),e.jsxs("p",{className:"text-muted-foreground",children:[s.customer.address.city,", ",s.customer.address.state," ",s.customer.address.zipcode]})]})]}),v&&e.jsxs(z,{variant:"outline",className:"w-full",onClick:()=>v(s),"data-testid":"button-view-shipment",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]}),e.jsx(H,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Order details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order date"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-date",children:ge})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order time"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-time",children:fe})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Buyer"}),e.jsx("span",{className:"text-primary font-medium","data-testid":"text-buyer-name",children:ee})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category"}),e.jsx("span",{className:"text-foreground","data-testid":"text-category",children:he})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("span",{className:"text-foreground","data-testid":"text-quantity",children:((h=(n=s.items)==null?void 0:n[0])==null?void 0:h.quantity)||1})]}),s.tokshow&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Show"}),e.jsx("span",{className:"text-foreground",children:s.tokshow.title||s.tokshow.name||s.tokshow._id})]})]})]}),e.jsx(H,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Buyer paid"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground","data-testid":"text-price",children:u(p)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taxes paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-tax",children:u(_)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-shipping-fee",children:u(b)})]}),e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Order total"}),e.jsx("span",{"data-testid":"text-order-total",children:u(L)})]})]})]}),e.jsx(H,{}),C?e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Giveaway Item"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a giveaway item. No payment was collected and there are no earnings for this order."})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Your earnings"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Earnings became available for payout on ",V(new Date($.getTime()+864e5),"dd MMM yyyy"),"."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground",children:u(p)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Commission"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",E.toFixed(1),"% of sale price)"]})]}),e.jsxs("span",{className:"text-foreground",children:["-",u(W)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Payment Processing Fee"}),e.jsx(Qe,{className:"w-3 h-3 text-muted-foreground"})]}),e.jsxs("span",{className:"text-foreground",children:["-",u(X)]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground ml-0",children:["(",Y,"% of order total + $",O.toFixed(2),")"]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsxs("span",{className:"text-foreground",children:["-",u(f)]})]}),e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Net earnings"}),e.jsx("span",{"data-testid":"text-net-earnings",children:u(pe)})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[K&&s.status!=="cancelled"&&s.status!=="delivered"&&s.status!=="shipped"&&!s.tracking_number&&!s.tracking_url&&e.jsx(z,{variant:"destructive",className:"flex-1",onClick:()=>K(s._id),disabled:M,"data-testid":"button-cancel-order",children:M?"Cancelling...":"Cancel order"}),v&&(s.tracking_number||s.label)&&e.jsxs(z,{variant:"outline",className:"flex-1",onClick:()=>v(s),"data-testid":"button-view-shipment-footer",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]})]})]})})}const st={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},Fe={processing:1,shipped:2,delivered:3,ended:4,cancelled:5};function Ot(){const[s,xe]=y.useState(""),[I,K]=y.useState("all"),[v,be]=y.useState("all"),[M,ue]=y.useState("newest"),[c,k]=y.useState(1),[A,G]=y.useState(20),[J,N]=y.useState(null),[he,C]=y.useState(!1),{user:a}=Me(),{toast:p}=Ae(),{settings:_}=Le(),[,b]=Ie(),[L,E]=y.useState(null),W=["/api/orders",a==null?void 0:a.id,I,v,c,A],{data:f,isLoading:Y,error:O,isError:X,refetch:pe}=Ue({queryKey:W,enabled:!!(a!=null&&a.id),staleTime:0,refetchOnMount:!0});Pe({mutationFn:async t=>{const n=await fetch(`/api/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"shipped"})});if(!n.ok)throw new Error("Failed to mark order as shipped");return n.json()},onSuccess:()=>{Se.invalidateQueries({queryKey:["external-orders"]}),p({title:"Order marked as shipped"})},onError:()=>{p({title:"Failed to mark order as shipped",variant:"destructive"})}});const Z=Pe({mutationFn:async t=>{const n=await fetch(`/api/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})});if(!n.ok)throw new Error("Failed to cancel order");return n.json()},onSuccess:()=>{Se.invalidateQueries({queryKey:["external-orders"]}),p({title:"Order cancelled"}),C(!1)},onError:()=>{p({title:"Failed to cancel order",variant:"destructive"})}}),$=t=>{window.confirm("Are you sure you want to cancel this order?")&&Z.mutate(t)},ge=async t=>{var l,i,r,x,m;const n=(l=t.customer)==null?void 0:l._id,h=(a==null?void 0:a._id)||(a==null?void 0:a.id);if(!n||!h){p({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{E(t._id);const d={firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",userName:(a==null?void 0:a.userName)||"",profilePhoto:(a==null?void 0:a.profilePhoto)||""},j={firstName:((i=t.customer)==null?void 0:i.firstName)||"",lastName:((r=t.customer)==null?void 0:r.lastName)||"",userName:((x=t.customer)==null?void 0:x.userName)||"",profilePhoto:((m=t.customer)==null?void 0:m.profilePhoto)||""},g=await Be(h,n,d,j);b("/inbox/"+g)}catch(d){console.error("Failed to create chat:",d),p({title:"Error",description:"Failed to start chat. Please try again.",variant:"destructive"})}finally{E(null)}},fe=t=>{k(t)},ee=t=>{G(t),k(1)},B=()=>{k(1)},te=t=>{K(t),B()},se=t=>{be(t),B()},ae=t=>{ue(t),B()},o=(f==null?void 0:f.orders)||[],w=Ke,ne=t=>{if(t.giveaway||t.ordertype==="giveaway")return 0;const n=Ne(t),h=_.commission_rate||0,l=n*h/100,m=(n+(t.tax||0)+(t.shipping_fee||0))*(2.9/100)+.3,d=t.seller_shipping_fee_pay||0;return n-l-m-d},ie=(o==null?void 0:o.reduce((t,n)=>(n.customer&&!t.find(h=>h._id===n.customer._id)&&t.push(n.customer),t),[]))||[],D=(o==null?void 0:o.filter(t=>{var r,x,m,d;const n=`${((r=t.customer)==null?void 0:r.firstName)||""} ${((x=t.customer)==null?void 0:x.lastName)||""}`.trim(),h=((m=t.invoice)==null?void 0:m.toString())||t._id.slice(-8),l=((d=t.giveaway)==null?void 0:d.name)||"";return s===""||n.toLowerCase().includes(s.toLowerCase())||h.toLowerCase().includes(s.toLowerCase())||l.toLowerCase().includes(s.toLowerCase())}).sort((t,n)=>{switch(M){case"newest":const h=t.date?new Date(t.date):new Date(t.createdAt||0);return(n.date?new Date(n.date):new Date(n.createdAt||0)).getTime()-h.getTime();case"oldest":const i=t.date?new Date(t.date):new Date(t.createdAt||0),r=n.date?new Date(n.date):new Date(n.createdAt||0);return i.getTime()-r.getTime();case"amount-high":return w(n)-w(t);case"amount-low":return w(t)-w(n);case"status":const x=Fe[t.status]||999,m=Fe[n.status]||999;return x-m;default:return 0}}))||[],F=(f==null?void 0:f.total)||0,re=(f==null?void 0:f.pages)||0,le=(o==null?void 0:o.reduce((t,n)=>t+w(n),0))||0,de=(o==null?void 0:o.filter(t=>t.status==="processing").length)||0,ce=(o==null?void 0:o.filter(t=>t.status==="shipped").length)||0,oe=(o==null?void 0:o.filter(t=>t.status==="delivered"||t.status==="ended").length)||0;return Y?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-32 mb-8"}),e.jsx("div",{className:"grid grid-cols-5 gap-4 mb-8",children:Array.from({length:5}).map((t,n)=>e.jsx("div",{className:"h-24 bg-muted rounded"},n))}),e.jsx("div",{className:"h-96 bg-muted rounded"})]})})}):X?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx(P,{className:"max-w-md mx-auto mt-8",children:e.jsx(He,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive text-5xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Failed to Load Orders"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(O==null?void 0:O.message)||"Something went wrong while loading your orders. Please try again."}),e.jsx(z,{onClick:()=>pe(),"data-testid":"button-retry-orders",children:"Try Again"})]})})})})}):e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground","data-testid":"text-orders-title",children:"Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Manage and track all your customer orders"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4 mb-8",children:[e.jsx(P,{children:e.jsxs(q,{className:"pb-2",children:[e.jsx(Q,{children:"Total Orders"}),e.jsx(R,{className:"text-2xl","data-testid":"metric-total-orders",children:F})]})}),(a==null?void 0:a.seller)!==!1&&e.jsx(P,{children:e.jsxs(q,{className:"pb-2",children:[e.jsx(Q,{children:"Current Page Revenue"}),e.jsx(R,{className:"text-2xl","data-testid":"metric-total-revenue",children:u(le)})]})}),(a==null?void 0:a.seller)!==!1&&e.jsx(P,{children:e.jsxs(q,{className:"pb-2",children:[e.jsx(Q,{children:"Processing"}),e.jsx(R,{className:"text-2xl text-orange-600","data-testid":"metric-processing",children:de})]})}),e.jsx(P,{children:e.jsxs(q,{className:"pb-2",children:[e.jsx(Q,{children:"Shipping"}),e.jsx(R,{className:"text-2xl text-blue-600","data-testid":"metric-shipping",children:ce})]})}),e.jsx(P,{children:e.jsxs(q,{className:"pb-2",children:[e.jsx(Q,{children:"Delivered"}),e.jsx(R,{className:"text-2xl text-green-600","data-testid":"metric-delivered",children:oe})]})})]}),e.jsx(Ve,{value:I,onValueChange:te,className:"mb-6",children:e.jsxs(ze,{className:`grid w-full ${(a==null?void 0:a.seller)===!1?"grid-cols-3":"grid-cols-3 sm:grid-cols-5"}`,children:[e.jsx(U,{value:"all","data-testid":"tab-all",children:"All"}),(a==null?void 0:a.seller)!==!1&&e.jsx(U,{value:"processing","data-testid":"tab-processing",children:"Need Label"}),(a==null?void 0:a.seller)!==!1&&e.jsx(U,{value:"ready_to_ship","data-testid":"tab-ready-to-ship",children:"Ready to Ship"}),e.jsx(U,{value:"shipped","data-testid":"tab-shipped",children:"Shipped"}),e.jsx(U,{value:"cancelled","data-testid":"tab-cancelled",children:"Cancelled"})]})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-sm",children:[e.jsx(et,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",size:16}),e.jsx(Re,{placeholder:"Search orders...",value:s,onChange:t=>xe(t.target.value),className:"pl-10","data-testid":"input-search-orders"})]}),(a==null?void 0:a.seller)!==!1&&e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs(Te,{value:v,onValueChange:se,children:[e.jsx(_e,{"data-testid":"select-customer",children:e.jsx(Oe,{placeholder:"Filter by customer..."})}),e.jsxs($e,{children:[e.jsx(T,{value:"all",children:"All Customers"}),ie.map(t=>e.jsxs(T,{value:t._id,children:[t.firstName," ",t.lastName]},t._id))]})]})}),e.jsxs(Te,{value:M,onValueChange:ae,children:[e.jsx(_e,{className:"w-full sm:w-48","data-testid":"select-sort-orders",children:e.jsx(Oe,{placeholder:"Sort by"})}),e.jsxs($e,{children:[e.jsx(T,{value:"newest",children:"Newest First"}),e.jsx(T,{value:"oldest",children:"Oldest First"}),e.jsx(T,{value:"amount-high",children:"Amount: High to Low"}),e.jsx(T,{value:"amount-low",children:"Amount: Low to High"}),e.jsx(T,{value:"status",children:"Status"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",D.length," of ",F," orders"]})]}),e.jsx(P,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Sales Channel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Earnings status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:D.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-12 text-center",children:[e.jsx(ye,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No orders found"}),e.jsx("p",{className:"text-muted-foreground",children:s||I!=="all"?"Try adjusting your search or filters":"Orders will appear here when customers make purchases"})]})}):D.map(t=>{var g,S,me,we,ve,ke;const n=((g=t.giveaway)==null?void 0:g.name)||((we=(me=(S=t.items)==null?void 0:S[0])==null?void 0:me.productId)==null?void 0:we.name)||"N/A",h=t.invoice||t._id.slice(-8),l=((ve=t.customer)==null?void 0:ve.userName)||"Unknown",i=t.giveaway?1:((ke=t.items)==null?void 0:ke.length)||0,r=t.date?new Date(t.date):new Date(t.createdAt||Date.now()),x=Ne(t),m=ne(t),d=t.status||"processing",j=d==="delivered"||d==="ended"?"Completed":"In Transit";return e.jsxs("tr",{className:"hover:bg-muted/50 cursor-pointer transition-colors","data-testid":`row-order-${t._id}`,onClick:()=>{N(t),C(!0)},children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:n}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Order #",h]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-muted-foreground",children:V(r,"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-primary cursor-pointer hover:underline",onClick:je=>{var Ce;je.stopPropagation(),(Ce=t.customer)!=null&&Ce._id&&b("/profile/"+t.customer._id)},children:l})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:i}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:t.tokshow?"Show":"Marketplace"}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:["US$",x.toFixed(2)]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(Ee,{className:st[d],"data-testid":`order-status-${d}`,children:d==="processing"?"In Transit":d.charAt(0).toUpperCase()+d.slice(1)})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",m.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{children:j}),e.jsx(Qe,{className:"w-3 h-3"})]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx(z,{variant:"ghost",size:"icon","data-testid":`button-message-customer-${t._id}`,disabled:L===t._id,onClick:je=>{je.stopPropagation(),ge(t)},children:e.jsx(qe,{size:16})})})]},t._id)})})]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ge,{currentPage:c,totalPages:re,totalItems:F,itemsPerPage:A,itemsPerPageOptions:[10,20,50,100],onPageChange:fe,onItemsPerPageChange:ee,showingText:"orders",className:"bg-white dark:bg-gray-950 rounded-lg border p-4"})})]}),e.jsx(tt,{order:J,open:he,onOpenChange:C,onCancelOrder:$,cancelLoading:Z.isPending,onViewShipment:t=>{sessionStorage.setItem("openShipmentDrawer",JSON.stringify(t)),C(!1),b("/shipping")},onMessageBuyer:t=>{p({title:"Messaging feature coming soon!"})}})]})}export{Ot as default};
