import{c as T,r as y,e as q,a as $,j as e,B as z,C as n}from"./index-sx6K5zvX.js";import{u as B,F as G,a as o,b as l,e as d,c,d as m,t as H}from"./form-D34Die4l.js";import{C as w,a as A,d as F,b as L}from"./card-y7XVqkDr.js";import{B as f}from"./button-BhKWRVKT.js";import{I as x}from"./input-D9aLazCK.js";import{L as p}from"./label-BJe6VCdD.js";import{A as J,a as O,b as R}from"./avatar-0uinKUeM.js";import{A as V,a as D}from"./alert-tEsqNyPX.js";import{S as Y}from"./separator-GUgqmzB4.js";import{S as Z}from"./square-pen-Cy68seCm.js";import{U as _}from"./user-DzLPaiRD.js";import{S as K}from"./save-IDKhGeJ6.js";import{M as Q}from"./mail-DpLhvzwT.js";import{P as W}from"./phone-neXqC5t3.js";import{M as X}from"./map-pin-CyryTmSF.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=T("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ee=z({firstName:n().min(1,"First name is required"),lastName:n().min(1,"Last name is required"),userName:n().min(3,"Username must be at least 3 characters").regex(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers, and underscores"),email:n().email("Please enter a valid email address"),phone:n().optional().refine(r=>!r||r===""?!0:/^[\+]?[1-9][\d]{0,15}$|^[\+]?[(]?[0-9]{3}[)]?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4,6}$|^[\+]?[0-9]{8,15}$/.test(r.replace(/[\s\-\(\)]/g,"")),"Please enter a valid phone number"),country:n().min(1,"Country is required")});function ue(){var C,S;const[r,j]=y.useState(!1),[v,N]=y.useState(""),[g,b]=y.useState(!1),{toast:P}=q(),{user:s}=$(),t=B({resolver:H(ee),defaultValues:{firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",userName:(s==null?void 0:s.userName)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",country:(s==null?void 0:s.country)||""}}),u=(s==null?void 0:s.authProvider)==="google"||(s==null?void 0:s.authProvider)==="apple",I=async a=>{try{b(!0),N("");const h=await fetch("/api/users/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)}),i=await h.json();if(!h.ok)throw new Error(i.error||"Failed to update profile");if(i.data){const E=localStorage.getItem("user");if(E){const k={...JSON.parse(E),...i.data};localStorage.setItem("user",JSON.stringify(k))}}P({title:"Profile updated",description:"Your profile has been successfully updated."}),j(!1),window.location.reload()}catch(h){const i=h instanceof Error?h.message:"Profile update failed";N(i),P({title:"Update failed",description:i,variant:"destructive"})}finally{b(!1)}},M=()=>{t.reset(),j(!1),N("")};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"w-[90%] mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account information and preferences"})]}),!r&&e.jsxs(f,{onClick:()=>j(!0),"data-testid":"button-edit-profile",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Edit Profile"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(w,{className:"lg:col-span-1",children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Profile Picture"]})}),e.jsx(L,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs(J,{className:"h-24 w-24","data-testid":"avatar-profile",children:[e.jsx(O,{src:s==null?void 0:s.profilePhoto}),e.jsxs(R,{className:"text-lg",children:[(C=s==null?void 0:s.firstName)==null?void 0:C[0],(S=s==null?void 0:s.lastName)==null?void 0:S[0]]})]}),r&&e.jsxs(f,{variant:"outline",size:"sm","data-testid":"button-upload-photo",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Change Photo"]})]})})]}),e.jsxs(w,{className:"lg:col-span-2",children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center",children:[e.jsx(_,{className:"h-5 w-5 mr-2"}),"Profile Information"]})}),e.jsxs(L,{children:[v&&e.jsx(V,{variant:"destructive",className:"mb-6","data-testid":"alert-update-error",children:e.jsx(D,{children:v})}),r?e.jsx(G,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(I),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:"firstName",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"First Name"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your first name","data-testid":"input-first-name",...a})}),e.jsx(m,{})]})}),e.jsx(o,{control:t.control,name:"lastName",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Last Name"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your last name","data-testid":"input-last-name",...a})}),e.jsx(m,{})]})})]}),e.jsx(o,{control:t.control,name:"userName",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Username"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your username","data-testid":"input-username",...a})}),e.jsx(m,{})]})}),e.jsx(o,{control:t.control,name:"email",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Email Address"}),e.jsx(c,{children:e.jsx(x,{type:"email",placeholder:"Enter your email","data-testid":"input-email",disabled:u,...a})}),u&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Email cannot be changed for ",(s==null?void 0:s.authProvider)==="google"?"Google":"Apple"," accounts"]}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:t.control,name:"phone",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Phone Number"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your phone number","data-testid":"input-phone",...a})}),e.jsx(m,{})]})}),e.jsx(o,{control:t.control,name:"country",render:({field:a})=>e.jsxs(l,{children:[e.jsx(d,{children:"Country"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Enter your country","data-testid":"input-country",...a})}),e.jsx(m,{})]})})]}),e.jsx(Y,{className:"my-6"}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:M,disabled:g,"data-testid":"button-cancel",children:"Cancel"}),e.jsx(f,{type:"submit",disabled:g,"data-testid":"button-save",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"First Name"}),e.jsx("p",{className:"text-foreground","data-testid":"text-first-name",children:(s==null?void 0:s.firstName)||"Not provided"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Last Name"}),e.jsx("p",{className:"text-foreground","data-testid":"text-last-name",children:(s==null?void 0:s.lastName)||"Not provided"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Username"}),e.jsx("p",{className:"text-foreground","data-testid":"text-username",children:(s==null?void 0:s.userName)||"Not provided"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Email Address",u&&e.jsxs("span",{className:"ml-2 px-2 py-1 text-xs bg-primary/10 text-primary rounded",children:[(s==null?void 0:s.authProvider)==="google"?"Google":"Apple"," Account"]})]}),e.jsx("p",{className:"text-foreground","data-testid":"text-email",children:(s==null?void 0:s.email)||"Not provided"}),u&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Email is managed by your ",(s==null?void 0:s.authProvider)==="google"?"Google":"Apple"," account"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Phone Number"]}),e.jsx("p",{className:"text-foreground","data-testid":"text-phone",children:(s==null?void 0:s.phone)||"Not provided"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{className:"text-sm font-medium text-muted-foreground flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Country"]}),e.jsx("p",{className:"text-foreground","data-testid":"text-country",children:(s==null?void 0:s.country)||"Not provided"})]})]})]})]})]})]})]})})}export{ue as default};
