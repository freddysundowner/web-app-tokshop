import{g as he,a as xe,b as fe,u as je,r as i,d as W,j as e,x as z,B as b,q as Q}from"./index-GnvmivW0.js";import{C as k,b as F,a as J,c as Z,d as G}from"./card-Bsqf9o7h.js";import{I as p}from"./input-CDJz7BeV.js";import{L as d}from"./label-CbaFYhHW.js";import{u as U}from"./useMutation-DAKVWGzI.js";import{w as ge,N as be,y as ve}from"./react-country-state-city-4XimWX2C.js";import{C as ye}from"./clock-C8Dw1EBc.js";import{C as Ne}from"./circle-alert-COJng_1I.js";import{C as Se}from"./check-DoxmrmEj.js";import{M as Ce}from"./map-pin-Dn0fBe7g.js";import{A as we}from"./arrow-right-CTv_q6A6.js";import{C as ke}from"./credit-card-B0WsppBV.js";import{C as Fe}from"./circle-check-jk63TU7f.js";const v=[{id:"address",title:"Address",description:"Shipping information"},{id:"bank",title:"Bank Account",description:"Payout setup"},{id:"complete",title:"Complete",description:"Finish setup"}];function Te(){const{toast:m}=he(),{user:t}=xe(),{settings:R}=fe(),[,g]=je(),[f,y]=i.useState("address"),[N,V]=i.useState(""),[P,X]=i.useState(""),[l,T]=i.useState(null),[o,H]=i.useState(null),[j,q]=i.useState(null),[S,A]=i.useState(""),[D,ee]=i.useState(""),[E,te]=i.useState(""),[_,se]=i.useState(""),[M,ae]=i.useState(""),[L,ne]=i.useState(""),[C,re]=i.useState(""),x=(t==null?void 0:t._id)||(t==null?void 0:t.id),{data:ie,isLoading:I}=W({queryKey:[`/api/profile/${x}`],enabled:!!x}),{data:a,isLoading:le}=W({queryKey:[`/api/address/default/address/${x}`],enabled:!!x});i.useEffect(()=>{l||T({id:233,name:"United States",iso2:"US"})},[]),i.useEffect(()=>{a!=null&&a.address&&y("bank")},[a]);const u=ie||t,de=u==null?void 0:u.applied_seller,B=u==null?void 0:u.seller;i.useEffect(()=>{B&&!I&&g("/marketplace")},[B,I,g]);const O=U({mutationFn:async s=>{const r=await fetch("/api/address",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!r.ok){const c=await r.json(),h=c.error||c.message||"Failed to save address";throw new Error(h)}return r.json()},onSuccess:()=>{m({title:"Address Saved",description:"Your address has been saved successfully"}),Q.invalidateQueries({queryKey:["/api/address/default/address"]}),y("bank")},onError:s=>{m({title:"Error",description:s.message||"Failed to save address",variant:"destructive"})}}),oe=s=>{if(s.preventDefault(),!N||!l||!o||!j||!S||!D){m({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}const r={name:t!=null&&t.firstName&&(t!=null&&t.lastName)?`${t.firstName} ${t.lastName}`:"Default",addrress1:N,addrress2:P,country:l.name,city:j.name,countryCode:l.iso2,zipcode:S,state:o.name,stateCode:o.state_code||o.iso2,userId:x,phone:D.trim().replace(/\s/g,""),email:(t==null?void 0:t.email)||"",primary:!1,applying:!1};O.mutate(r)},Y=U({mutationFn:async s=>{const r=await fetch(`/api/stripe/connect/${x}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!r.ok){const c=await r.json();throw new Error(c.error||c.message||"Failed to create Stripe account")}return r.json()},onSuccess:s=>{if(s.success===!1){m({title:"Error",description:s.error||"Failed to create Stripe account",variant:"destructive"});return}m({title:"Bank Account Connected",description:"Your bank account has been connected successfully."}),Q.invalidateQueries({queryKey:[`/api/profile/${x}`]}),y("complete")},onError:s=>{m({title:"Error",description:s.message,variant:"destructive"})}}),ce=s=>{if(s.preventDefault(),!E||!_||!M||!L||!C){m({title:"Missing Information",description:"Please fill in all required fields",variant:"destructive"});return}const r=new Date(C),c=new Date,h=c.getFullYear()-r.getFullYear(),w=c.getMonth()-r.getMonth();if(!(h>18||h===18&&w>=0)){m({title:"Age Requirement",description:"You must be at least 18 years old to become a seller.",variant:"destructive"});return}const $=new Date(C),n=(a==null?void 0:a.address)||(t==null?void 0:t.address),pe={country:"US",currency:"usd",account_number:E,city:(n==null?void 0:n.city)||(j==null?void 0:j.name)||j,state:(n==null?void 0:n.state)||(o==null?void 0:o.name)||o,day:$.getDate().toString(),month:($.getMonth()+1).toString(),year:$.getFullYear().toString(),ssn_last_4:M,line1:(n==null?void 0:n.addrress1)||(n==null?void 0:n.address1)||N,line2:(n==null?void 0:n.addrress2)||(n==null?void 0:n.address2)||P||"",postal_code:(n==null?void 0:n.zipcode)||S,countryCode:(n==null?void 0:n.countryCode)||(l==null?void 0:l.iso2),phone:L,routing_number:_,email:(t==null?void 0:t.email)||"",name:(t==null?void 0:t.firstName)||"",first_name:(t==null?void 0:t.firstName)||"",last_name:(t==null?void 0:t.lastName)||"",create_address:!n,account_holder_name:`${(t==null?void 0:t.firstName)||""} ${(t==null?void 0:t.lastName)||""}`.trim()};Y.mutate(pe)},me=()=>{t!=null&&t.seller?g("/seller/hub"):(m({title:"Application Submitted",description:"Your seller application is being reviewed. You'll be notified once approved."}),g("/marketplace"))};if(le||I)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-primary"})});if(de&&!B)return e.jsx("div",{className:"py-4 sm:py-6 lg:py-8 w-full","data-testid":"page-seller-review",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsx(k,{className:"max-w-2xl mx-auto",children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-6 py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ye,{className:"h-10 w-10 text-primary"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-3",children:"Application Under Review"}),e.jsx("p",{className:"text-muted-foreground text-base mb-2",children:"Your seller application is currently being reviewed by our team."}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["We'll notify you via email at ",e.jsx("span",{className:"font-medium text-foreground",children:u==null?void 0:u.email})," once your account is approved."]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1 text-sm",children:"What happens next?"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Our team typically reviews applications within 1-2 business days. Once approved, you'll be able to list products, host live shows, and start selling on ",R.app_name,"."]})]})]})}),e.jsx("div",{className:"flex flex-col gap-3 pt-4",children:e.jsx(b,{onClick:()=>g("/marketplace"),variant:"outline",size:"lg","data-testid":"button-back-to-marketplace",children:"Return to Marketplace"})})]})})})})});const ue=a!=null&&a.address?v.findIndex(s=>s.id===f):v.findIndex(s=>s.id===f);return e.jsxs("div",{className:"py-4 sm:py-6 lg:py-8 w-full","data-testid":"page-seller-setup",children:[e.jsxs("div",{className:"mb-6 sm:mb-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground mb-2","data-testid":"heading-seller-setup",children:"Complete Seller Setup"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Set up your seller account to start selling on ",R.app_name]})]}),e.jsx("div",{className:"mb-8 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between",children:v.map((s,r)=>{if(s.id==="address"&&(a!=null&&a.address))return null;const c=s.id===f,h=r<ue||s.id==="address"&&(a==null?void 0:a.address),w=a!=null&&a.address&&s.id!=="address"?r-1:r,K=a!=null&&a.address?v.length-1:v.length;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`flex items-center justify-center h-10 w-10 rounded-full border-2 transition-colors ${h?"bg-green-500 border-green-500 text-white":c?"bg-primary border-primary text-primary-foreground":"bg-background border-muted-foreground/30 text-muted-foreground"}`,children:h?e.jsx(Se,{className:"h-5 w-5"}):e.jsx("span",{className:"text-sm font-semibold",children:w+1})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("p",{className:`text-xs sm:text-sm font-medium ${c?"text-foreground":"text-muted-foreground"}`,children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:s.description})]})]}),w<K-1&&e.jsx("div",{className:`h-0.5 flex-1 mx-2 transition-colors ${h?"bg-green-500":"bg-muted"}`})]},s.id)})})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8",children:[f==="address"&&!(a!=null&&a.address)&&e.jsxs(k,{children:[e.jsxs(J,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Shipping Address"]}),e.jsx(G,{children:"Enter your primary shipping address for order fulfillment"})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"street-address",children:"Street Address *"}),e.jsx(p,{id:"street-address",placeholder:"123 Main Street",value:N,onChange:s=>V(s.target.value),required:!0,"data-testid":"input-street-address"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"street-address-2",children:"Street Address 2 (Optional)"}),e.jsx(p,{id:"street-address-2",placeholder:"Apt, Suite, Unit, etc.",value:P,onChange:s=>X(s.target.value),"data-testid":"input-street-address-2"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"country",children:"Country *"}),e.jsx(ge,{onChange:s=>{T(s),H(null),q(null)},placeHolder:"Select Country",containerClassName:"w-full",inputClassName:"w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"state",children:"State/Province *"}),e.jsx(be,{countryid:l==null?void 0:l.id,onChange:s=>{H(s),q(null)},placeHolder:"Select State",containerClassName:"w-full",inputClassName:"w-full"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"city",children:"City *"}),e.jsx(ve,{countryid:l==null?void 0:l.id,stateid:o==null?void 0:o.id,onChange:s=>q(s),placeHolder:"Select City",containerClassName:"w-full",inputClassName:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"zip",children:"ZIP/Postal Code *"}),e.jsx(p,{id:"zip",placeholder:"10001",value:S,onChange:s=>A(s.target.value),required:!0,"data-testid":"input-zip"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone Number *"}),e.jsx(p,{id:"phone",placeholder:"+1 (555) 123-4567",value:D,onChange:s=>ee(s.target.value),required:!0,"data-testid":"input-phone"})]}),e.jsx("div",{className:"flex gap-3 pt-4",children:e.jsx(b,{type:"submit",className:"flex-1",disabled:O.isPending,"data-testid":"button-save-address",children:O.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:["Continue",e.jsx(we,{className:"ml-2 h-4 w-4"})]})})})]})})]}),f==="bank"&&e.jsxs(k,{children:[e.jsxs(J,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"Where do you want to withdraw your earnings to?"]}),e.jsx(G,{children:"Enter your bank account details to receive seller payouts"})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"account-number",children:"Account Number *"}),e.jsx(p,{id:"account-number",placeholder:"000123456789",value:E,onChange:s=>te(s.target.value),required:!0,"data-testid":"input-account-number"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"routing-number",children:"Routing Number *"}),e.jsx(p,{id:"routing-number",placeholder:"110000000",value:_,onChange:s=>se(s.target.value),required:!0,"data-testid":"input-routing-number"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"ssn-last4",children:"SSN Last 4 Digits *"}),e.jsx(p,{id:"ssn-last4",placeholder:"0000",maxLength:4,value:M,onChange:s=>ae(s.target.value.replace(/\D/g,"")),required:!0,"data-testid":"input-ssn-last4"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"bank-phone",children:"Phone Number *"}),e.jsx(p,{id:"bank-phone",type:"tel",placeholder:"+17297409480",value:L,onChange:s=>ne(s.target.value),required:!0,"data-testid":"input-bank-phone"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"dob",children:"Date of Birth *"}),e.jsx(p,{id:"dob",type:"date",value:C,onChange:s=>re(s.target.value),required:!0,"data-testid":"input-dob"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[!(a!=null&&a.address)&&e.jsx(b,{variant:"outline",onClick:()=>y("address"),type:"button","data-testid":"button-back",children:"Back"}),e.jsx(b,{type:"submit",className:"flex-1",disabled:Y.isPending,"data-testid":"button-save-bank",children:Y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save and Continue"})]})]})})]}),f==="complete"&&e.jsx(k,{children:e.jsx(F,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4 py-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-16 w-16 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(Fe,{className:"h-8 w-8 text-white"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Setup Complete!"}),e.jsx("p",{className:"text-muted-foreground",children:t!=null&&t.seller?"Your seller account is ready. Start listing products and hosting shows!":"Your application has been submitted. An admin will review your account and contact you soon."})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsx(b,{onClick:me,size:"lg","data-testid":"button-finish-setup",children:t!=null&&t.seller?"Go to Seller Hub":"Return to Marketplace"}),!(t!=null&&t.seller)&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We'll email you at ",e.jsx("span",{className:"font-medium",children:t==null?void 0:t.email})," once your account is approved."]})]})]})})})]})]})}export{Te as default};
