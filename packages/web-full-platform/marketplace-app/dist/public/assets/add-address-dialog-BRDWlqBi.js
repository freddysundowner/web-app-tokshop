import{g as B,a as R,r as a,j as s,B as L,y as T}from"./index-GnvmivW0.js";import{D as Y,a as Z,b as J,c as O,d as $,e as G}from"./dialog-D1L4tMGI.js";import{I as x}from"./input-CDJz7BeV.js";import{L as d}from"./label-CbaFYhHW.js";import{w as K,N as Q,y as V}from"./react-country-state-city-4XimWX2C.js";function ie({open:y,onOpenChange:j,onSuccess:z,address:t}){const{toast:c}=B(),{user:M}=R(),i=M,[C,E]=a.useState(!1),l=!!t,[v,u]=a.useState(""),[I,p]=a.useState(""),[U,N]=a.useState(0),[_,m]=a.useState(0),[W,r]=a.useState(0),[S,A]=a.useState(null),[w,h]=a.useState(null),[H,n]=a.useState(null),[b,g]=a.useState(""),[D,f]=a.useState(""),[k,P]=a.useState("");a.useEffect(()=>{y&&(t?(P(t.name||""),u(t.addrress1||t.address1||""),p(t.addrress2||t.address2||""),g(t.zipcode||t.zip||""),f(t.phone||"")):(P(""),u(""),p(""),N(0),m(0),r(0),A(null),h(null),n(null),g(""),f("")))},[t,y]);const q=async()=>{if(!v||!S||!w||!H||!b||!D){c({title:"Missing Information",description:"Please fill in all required fields.",variant:"destructive"});return}E(!0);try{const e={name:k||(i==null?void 0:i.firstName)||"Default",addrress1:v,addrress2:I,country:S.name,city:H.name,countryCode:S.iso2,zipcode:b,state:w.name,stateCode:w.state_code,userId:i==null?void 0:i.id,phone:D.trim().replace(/\s/g,""),email:(i==null?void 0:i.email)||"",primary:(t==null?void 0:t.primary)||!1,applying:!1};l&&t._id?(await T("PUT",`/api/address/${t._id}`,e),c({title:"Address Updated",description:"Your shipping address has been updated successfully."})):(await T("POST","/api/address",e),c({title:"Address Added",description:"Your shipping address has been saved successfully."})),u(""),p(""),N(0),m(0),r(0),A(null),h(null),n(null),g(""),f(""),P(""),z&&z(),j(!1)}catch(e){console.error("Failed to add/update address:",e);let o=l?"Failed to update address. Please try again.":"Failed to add address. Please try again.";if(e!=null&&e.text)try{const F=JSON.parse(e.text);o=F.error||F.message||o}catch{typeof e.text=="string"&&(o=e.text)}else e!=null&&e.message&&(o=e.message);c({title:"Error",description:o,variant:"destructive"})}finally{E(!1)}};return s.jsx(Y,{open:y,onOpenChange:j,children:s.jsxs(Z,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto","data-testid":"dialog-add-address",children:[s.jsxs(J,{children:[s.jsx(O,{children:l?"Edit Address":"Add New Address"}),s.jsx($,{children:l?"Update your shipping address.":"Add a new shipping or billing address."})]}),s.jsxs("div",{className:"space-y-4 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"street-address",children:"Street Address"}),s.jsx(x,{id:"street-address",placeholder:"123 Main Street",value:v,onChange:e=>u(e.target.value),"data-testid":"input-street-address"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"street-address-2",children:"Street Address 2 (Optional)"}),s.jsx(x,{id:"street-address-2",placeholder:"Apt, Suite, Unit, etc.",value:I,onChange:e=>p(e.target.value),"data-testid":"input-street-address-2"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{children:"Country"}),s.jsx(K,{onChange:e=>{N(e.id),A(e),m(0),r(0),h(null),n(null)},placeHolder:"Select Country",containerClassName:"w-full",inputClassName:"w-full"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{children:"State/Province"}),s.jsx(Q,{countryid:U,onChange:e=>{m(e.id),h(e),r(0),n(null)},placeHolder:"Select State",containerClassName:"w-full",inputClassName:"w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{children:"City"}),s.jsx(V,{countryid:U,stateid:_,onChange:e=>{r(e.id),n(e)},placeHolder:"Select City",containerClassName:"w-full",inputClassName:"w-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"zip",children:"ZIP/Postal Code"}),s.jsx(x,{id:"zip",placeholder:"10001",value:b,onChange:e=>g(e.target.value),"data-testid":"input-zip"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"phone",children:"Phone Number"}),s.jsx(x,{id:"phone",placeholder:"+1 (555) 123-4567",value:D,onChange:e=>f(e.target.value),"data-testid":"input-phone"})]})]}),s.jsxs(G,{className:"flex-col sm:flex-row gap-2",children:[s.jsx(L,{variant:"outline",onClick:()=>j(!1),disabled:C,"data-testid":"button-cancel",className:"w-full sm:w-auto",children:"Cancel"}),s.jsx(L,{onClick:q,disabled:C,"data-testid":"button-add-address",className:"w-full sm:w-auto bg-primary hover:bg-primary/90 text-primary-foreground",children:C?l?"Updating...":"Adding...":l?"Update Address":"Add Address"})]})]})})}export{ie as AddAddressDialog,ie as default};
