import{u as Te,a as Me,g as Ae,b as Fe,r as f,j as e,B as I,d as ve,X as Le,A as Be,h as Qe,i as Ke,k as Ue,l as Re,m as He,n as ze,o as Ve,q as re}from"./index-GnvmivW0.js";import{u as ke}from"./useMutation-DAKVWGzI.js";import{C as Ce,b as Ge}from"./card-Bsqf9o7h.js";import{B as Ie}from"./badge-CL9MXKGS.js";import{S as Se,a as Pe,b as Oe,c as _e,d as v}from"./select-EUq1_viI.js";import{C as Je}from"./checkbox-ZrZ7F-Dx.js";import{L as We}from"./label-CbaFYhHW.js";import{c as ue,f as o}from"./pricing-DCyf_yea.js";import{C as Ye}from"./pagination-COmJENkB.js";import{S as Xe,a as Ze,b as et,c as tt,d as st}from"./sheet-D5QVNRkq.js";import{S as H}from"./separator-Datc7ShZ.js";import{g as qe}from"./firebase-chat-DdFjaliD.js";import{P as pe}from"./package-DWwkENv3.js";import{M as Ee}from"./message-square-Cf3RgaVN.js";import{T as De}from"./truck-DP2GNOS8.js";import{I as at}from"./info-C2t8FPuk.js";import{f as F}from"./format-Crz72tIO.js";import"./index-BdQq_4o_.js";import"./index-CmYyiKyk.js";import"./index-Vue-pIA6.js";import"./chevron-down-tcDKR_mK.js";import"./check-DoxmrmEj.js";import"./chevron-up-Cda9uppk.js";import"./chevron-left-BnuQCvWV.js";import"./chevron-right-CXw-mF7y.js";import"./en-US-Cc-9gH5A.js";function rt({order:s,open:k,onOpenChange:C,onCancelOrder:q,onViewShipment:S,onMessageBuyer:E,cancelLoading:L=!1}){var _,V,G,J,W,Y,U,X,Z,ee,M,te,A,R,se,t,i;const[,ne]=Te(),{user:d}=Me(),{toast:B}=Ae(),{settings:z}=Fe(),[N,a]=f.useState(!1);if(!s)return null;const m=(V=(_=s.items)==null?void 0:_[0])==null?void 0:V.productId;(G=m==null?void 0:m.images)!=null&&G[0]||(W=(J=s.giveaway)==null?void 0:J.images)!=null&&W[0],m!=null&&m.name||(Y=s.giveaway)!=null&&Y.name;const he=((U=m==null?void 0:m.category)==null?void 0:U.name)||((Z=(X=s.giveaway)==null?void 0:X.category)==null?void 0:Z.name)||"N/A",D=!!s.giveaway||s.ordertype==="giveaway",ie=()=>{var l,u,p,h,x;const r=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Receipt - Order #${s.invoice||((l=s._id)==null?void 0:l.slice(-8))||"N/A"}</title>
          <style>
            body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .order-info { margin-bottom: 20px; }
            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .items-table th { background-color: #f2f2f2; }
            .totals { margin-top: 20px; text-align: right; }
            .total-line { display: flex; justify-content: space-between; margin: 5px 0; }
            .final-total { font-weight: bold; border-top: 2px solid #000; padding-top: 5px; }
            @media print { .no-print { display: none; } }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Order Receipt</h1>
            <p>${z.app_name||"TokShop"}</p>
          </div>
          
          <div class="order-info">
            <h3>Order #${s.invoice||((u=s._id)==null?void 0:u.slice(-8))||"N/A"}</h3>
            <p><strong>Date:</strong> ${F(w,"MMM d, yyyy 'at' h:mm a")}</p>
            <p><strong>Status:</strong> ${s.label?"Label Created":((p=s.status)==null?void 0:p.charAt(0).toUpperCase())+((h=s.status)==null?void 0:h.slice(1))}</p>
            <p><strong>Customer:</strong> ${T}</p>
            ${(x=s.customer)!=null&&x.email?`<p><strong>Email:</strong> ${s.customer.email}</p>`:""}
            ${s.tracking_number?`<p><strong>Tracking:</strong> ${s.tracking_number}</p>`:""}
          </div>

          <table class="items-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              ${(s.items||[]).map(c=>{var y;return`
                <tr>
                  <td>${((y=c.productId)==null?void 0:y.name)||"Unknown Product"}${c.order_reference?` ${c.order_reference}`:""}</td>
                  <td>${c.quantity||0}</td>
                  <td>${o(c.price||0)}</td>
                  <td>${o((c.quantity||0)*(c.price||0))}</td>
                </tr>
              `}).join("")}
            </tbody>
          </table>

          <div class="totals">
            <div class="total-line">
              <span>Subtotal:</span>
              <span>${o(b)}</span>
            </div>
            ${$>0?`
              <div class="total-line">
                <span>Tax:</span>
                <span>${o($)}</span>
              </div>
            `:""}
            ${j>0?`
              <div class="total-line">
                <span>Shipping:</span>
                <span>${o(j)}</span>
              </div>
            `:""}
            <div class="total-line final-total">
              <span>Total:</span>
              <span>${o(Q)}</span>
            </div>
          </div>

          <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button onclick="window.print()">Print Receipt</button>
            <button onclick="window.close()" style="margin-left: 10px;">Close</button>
          </div>
        </body>
      </html>
    `,n=window.open("","_blank","width=800,height=600");n?(n.document.write(r),n.document.close(),n.onload=()=>{n.print()}):B({title:"Print Blocked",description:"Unable to open print window. Please allow popups and try again.",variant:"destructive"})},b=ue(s),$=s.tax||0,j=s.shipping_fee||0,Q=b+$+j,P=s.service_fee??s.servicefee??0,K=s.stripe_fees??0,O=s.seller_shipping_fee_pay??0,le=z.commission_rate||0,g=b-P-K-O,de=()=>{const r=s.status||"processing",n={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},l=s.label?"Label Created":r.charAt(0).toUpperCase()+r.slice(1);return e.jsx(Ie,{className:n[r]||n.processing,"data-testid":"badge-order-status",children:l})},w=s.date?new Date(s.date):s.createdAt?new Date(s.createdAt):new Date,ce=F(w,"dd MMM yyyy"),oe=F(w,"h:mm a"),T=((ee=s.customer)==null?void 0:ee.userName)||`${((M=s.customer)==null?void 0:M.firstName)||""} ${((te=s.customer)==null?void 0:te.lastName)||""}`.trim()||"Unknown",me=async()=>{var l,u,p,h,x;const r=(l=s.customer)==null?void 0:l._id,n=(d==null?void 0:d._id)||(d==null?void 0:d.id);if(!r||!n){B({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{a(!0);const c={firstName:(d==null?void 0:d.firstName)||"",lastName:(d==null?void 0:d.lastName)||"",userName:(d==null?void 0:d.userName)||"",profilePhoto:(d==null?void 0:d.profilePhoto)||""},y={firstName:((u=s.customer)==null?void 0:u.firstName)||"",lastName:((p=s.customer)==null?void 0:p.lastName)||"",userName:((h=s.customer)==null?void 0:h.userName)||"",profilePhoto:((x=s.customer)==null?void 0:x.profilePhoto)||""},ae=await qe(n,r,c,y);ne(`/inbox/${ae}`)}catch(c){console.error("Error creating chat:",c),B({title:"Error",description:"Failed to open chat. Please try again.",variant:"destructive"})}finally{a(!1)}};return e.jsx(Xe,{open:k,onOpenChange:C,children:e.jsxs(Ze,{className:"w-full sm:max-w-lg overflow-y-auto","data-testid":"sheet-order-details",children:[e.jsx(et,{className:"pb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(tt,{className:"text-2xl",children:"Order"}),e.jsxs(st,{className:"text-lg text-muted-foreground mt-1","data-testid":"text-order-id",children:["#",s.invoice||((A=s._id)==null?void 0:A.slice(-8))||"N/A"]})]})})}),e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsx("div",{children:de()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Items"}),e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-muted-foreground py-2 px-3",children:"Product"}),e.jsx("th",{className:"text-center text-xs font-medium text-muted-foreground py-2 px-3",children:"Qty"}),e.jsx("th",{className:"text-right text-xs font-medium text-muted-foreground py-2 px-3",children:"Price"}),e.jsx("th",{className:"text-right text-xs font-medium text-muted-foreground py-2 px-3",children:"Total"})]})}),e.jsx("tbody",{children:s.items&&s.items.length>0?s.items.map((r,n)=>{var x;const l=r.productId,u=((x=l==null?void 0:l.images)==null?void 0:x[0])||"",p=(l==null?void 0:l.name)||"Product",h=(r.quantity||1)*(r.price||0);return e.jsxs("tr",{className:"border-t border-border","data-testid":`row-product-${n}`,children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:u?e.jsx("img",{src:u,alt:p,className:"w-full h-full object-cover","data-testid":`img-product-${n}`}):e.jsx(pe,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("span",{className:"font-medium text-sm text-foreground","data-testid":`text-product-name-${n}`,children:[p,r.order_reference?` ${r.order_reference}`:""]})]})}),e.jsx("td",{className:"py-3 px-3 text-center text-sm text-foreground","data-testid":`text-quantity-${n}`,children:r.quantity||1}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-foreground","data-testid":`text-price-${n}`,children:o(r.price||0)}),e.jsx("td",{className:"py-3 px-3 text-right text-sm font-medium text-foreground","data-testid":`text-total-${n}`,children:o(h)})]},n)}):s.giveaway?e.jsxs("tr",{className:"border-t border-border","data-testid":"row-product-giveaway",children:[e.jsx("td",{className:"py-3 px-3",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded flex items-center justify-center flex-shrink-0 overflow-hidden",children:(R=s.giveaway.images)!=null&&R[0]?e.jsx("img",{src:s.giveaway.images[0],alt:s.giveaway.name,className:"w-full h-full object-cover","data-testid":"img-product-giveaway"}):e.jsx(pe,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx("span",{className:"font-medium text-sm text-foreground","data-testid":"text-product-name-giveaway",children:s.giveaway.name})]})}),e.jsx("td",{className:"py-3 px-3 text-center text-sm text-muted-foreground",children:"1"}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-muted-foreground",children:"Giveaway"}),e.jsx("td",{className:"py-3 px-3 text-right text-sm text-muted-foreground",children:o(0)})]}):null})]})}),!D&&e.jsx("button",{onClick:ie,className:"mt-3 text-sm text-primary font-medium hover:underline","data-testid":"button-view-receipt",children:"View receipt"})]}),e.jsxs("button",{onClick:me,disabled:N,className:"w-full flex items-center justify-between p-4 rounded-lg border border-border hover:bg-muted/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","data-testid":"button-message-buyer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-foreground"})}),e.jsx("span",{className:"font-medium text-foreground",children:N?"Loading...":"Message the buyer"})]}),e.jsx("svg",{className:"w-5 h-5 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),(s.tracking_number||s.label)&&e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsx("p",{className:"font-medium text-foreground mb-3",children:"This order is attached to a shipment."}),s.tracking_number&&e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipment"}),e.jsxs("span",{className:"text-primary font-medium","data-testid":"text-tracking-number",children:["#",s.tracking_number]})]}),((se=s.customer)==null?void 0:se.address)&&e.jsxs("div",{className:"flex justify-between text-sm mb-3",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ship to"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.customer.address.addrress1}),e.jsxs("p",{className:"text-muted-foreground",children:[s.customer.address.city,", ",s.customer.address.state," ",s.customer.address.zipcode]})]})]}),S&&e.jsxs(I,{variant:"outline",className:"w-full",onClick:()=>S(s),"data-testid":"button-view-shipment",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]}),e.jsx(H,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Order details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order date"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-date",children:ce})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order time"}),e.jsx("span",{className:"text-foreground","data-testid":"text-order-time",children:oe})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Buyer"}),e.jsx("span",{className:"text-primary font-medium","data-testid":"text-buyer-name",children:T})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Category"}),e.jsx("span",{className:"text-foreground","data-testid":"text-category",children:he})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("span",{className:"text-foreground","data-testid":"text-quantity",children:((i=(t=s.items)==null?void 0:t[0])==null?void 0:i.quantity)||1})]}),s.tokshow&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Show"}),e.jsx("span",{className:"text-foreground",children:s.tokshow.title||s.tokshow.name||s.tokshow._id})]})]})]}),e.jsx(H,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Buyer paid"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground","data-testid":"text-price",children:o(b)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taxes paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-tax",children:o($)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping paid by buyer"}),e.jsx("span",{className:"text-foreground","data-testid":"text-shipping-fee",children:o(j)})]}),e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between font-semibold",children:[e.jsx("span",{children:"Order total"}),e.jsx("span",{"data-testid":"text-order-total",children:o(Q)})]})]})]}),e.jsx(H,{}),D?e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Giveaway Item"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is a giveaway item. No payment was collected and there are no earnings for this order."})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Your earnings"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Earnings became available for payout on ",F(new Date(w.getTime()+864e5),"dd MMM yyyy"),"."]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price"}),e.jsx("span",{className:"text-foreground",children:o(b)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Commission"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["(",le.toFixed(1),"% of sale price)"]})]}),e.jsxs("span",{className:"text-foreground",children:["-",o(P)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-muted-foreground",children:"Payment Processing Fee"}),e.jsx(at,{className:"w-3 h-3 text-muted-foreground"})]}),e.jsxs("span",{className:"text-foreground",children:["-",o(K)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Seller Shipping Paid"}),e.jsxs("span",{className:"text-foreground",children:["-",o(O)]})]}),e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Net earnings"}),e.jsx("span",{"data-testid":"text-net-earnings",children:o(g)})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[q&&s.status!=="cancelled"&&s.status!=="delivered"&&s.status!=="shipped"&&!s.tracking_number&&!s.tracking_url&&e.jsx(I,{variant:"destructive",className:"flex-1",onClick:()=>q(s._id),disabled:L,"data-testid":"button-cancel-order",children:L?"Cancelling...":"Cancel order"}),S&&(s.tracking_number||s.label)&&e.jsxs(I,{variant:"outline",className:"flex-1",onClick:()=>S(s),"data-testid":"button-view-shipment-footer",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"View Shipment"]})]})]})]})})}const nt={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},$e=s=>s.split("_").map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(" ");function Tt(){const[s,k]=f.useState("all"),[C,q]=f.useState("all"),[S,E]=f.useState(1),[L,ne]=f.useState(20),[d,B]=f.useState(null),[z,N]=f.useState(!1),{user:a}=Me(),{toast:m}=Ae(),{settings:he}=Fe(),[,D]=Te(),[ie,b]=f.useState(null),[$,j]=f.useState(!1),[Q,P]=f.useState(null),[K,O]=f.useState(!1),le=["/api/orders",a==null?void 0:a.id,s,S,L],{data:g,isLoading:de,error:w,isError:ce,refetch:oe}=ve({queryKey:le,enabled:!!(a!=null&&a.id),staleTime:0,refetchOnMount:!0}),{data:T}=ve({queryKey:["/api/rooms","ended",a==null?void 0:a.id],queryFn:async()=>{const t=new URLSearchParams;return t.set("status","ended"),a!=null&&a.id&&t.set("hostId",a.id),(await fetch(`/api/rooms?${t}`)).json()},enabled:!!(a!=null&&a.id)}),me=(T==null?void 0:T.rooms)||[];ke({mutationFn:async t=>{const i=await fetch(`/api/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"shipped"})});if(!i.ok)throw new Error("Failed to mark order as shipped");return i.json()},onSuccess:()=>{re.invalidateQueries({queryKey:["/api/orders"]}),re.invalidateQueries({queryKey:["external-orders"]}),m({title:"Order marked as shipped"})},onError:()=>{m({title:"Failed to mark order as shipped",variant:"destructive"})}});const _=ke({mutationFn:async({orderId:t,relist:i})=>{const r=await fetch("/api/orders/cancel/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:t,initiator:"seller",type:"order",relist:i,description:"Order cancelled by seller"})});if(!r.ok)throw new Error("Failed to cancel order");return r.json()},onSuccess:()=>{re.invalidateQueries({queryKey:["/api/orders"]}),re.invalidateQueries({queryKey:["external-orders"]}),m({title:"Order cancelled"}),N(!1),j(!1),P(null),O(!1)},onError:()=>{m({title:"Failed to cancel order",variant:"destructive"})}}),V=t=>{P(t),N(!1),j(!0)},G=()=>{Q&&_.mutate({orderId:Q,relist:K})},J=async t=>{var n,l,u,p,h;const i=(n=t.customer)==null?void 0:n._id,r=(a==null?void 0:a._id)||(a==null?void 0:a.id);if(!i||!r){m({title:"Error",description:"Unable to start chat. User information is missing.",variant:"destructive"});return}try{b(t._id);const x={firstName:(a==null?void 0:a.firstName)||"",lastName:(a==null?void 0:a.lastName)||"",userName:(a==null?void 0:a.userName)||"",profilePhoto:(a==null?void 0:a.profilePhoto)||""},c={firstName:((l=t.customer)==null?void 0:l.firstName)||"",lastName:((u=t.customer)==null?void 0:u.lastName)||"",userName:((p=t.customer)==null?void 0:p.userName)||"",profilePhoto:((h=t.customer)==null?void 0:h.profilePhoto)||""},y=await qe(r,i,x,c);D("/inbox/"+y)}catch(x){console.error("Failed to create chat:",x),m({title:"Error",description:"Failed to start chat. Please try again.",variant:"destructive"})}finally{b(null)}},W=t=>{E(t)},Y=t=>{ne(t),E(1)},U=()=>{E(1)},X=t=>{k(t),U()},Z=t=>{q(t),U()},ee=()=>{k("all"),q("all"),E(1)},M=(g==null?void 0:g.orders)||[],te=t=>{if(t.giveaway||t.ordertype==="giveaway")return 0;const i=ue(t),r=t.service_fee??t.servicefee??0,n=t.stripe_fees??0,l=t.seller_shipping_fee_pay??0;return i-r-n-l},A=(M==null?void 0:M.filter(t=>{if(C!=="all"){if(C==="marketplace"){if(t.ordertype!=="marketplace"&&t.tokshow)return!1}else if(t.tokshow!==C)return!1}return!0}).sort((t,i)=>{const r=t.date?new Date(t.date):new Date(t.createdAt||0);return(i.date?new Date(i.date):new Date(i.createdAt||0)).getTime()-r.getTime()}))||[],R=(g==null?void 0:g.total)||0,se=(g==null?void 0:g.pages)||0;return de?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-32 mb-8"}),e.jsx("div",{className:"grid grid-cols-5 gap-4 mb-8",children:Array.from({length:5}).map((t,i)=>e.jsx("div",{className:"h-24 bg-muted rounded"},i))}),e.jsx("div",{className:"h-96 bg-muted rounded"})]})})}):ce?e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"px-4 sm:px-6 md:px-8",children:e.jsx(Ce,{className:"max-w-md mx-auto mt-8",children:e.jsx(Ge,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive text-5xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Failed to Load Orders"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(w==null?void 0:w.message)||"Something went wrong while loading your orders. Please try again."}),e.jsx(I,{onClick:()=>oe(),"data-testid":"button-retry-orders",children:"Try Again"})]})})})})}):e.jsxs("div",{className:"py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground","data-testid":"text-orders-title",children:"Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Manage and track all your customer orders"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsx("div",{className:"w-full sm:w-auto sm:min-w-64 sm:max-w-md",children:e.jsxs(Se,{value:C,onValueChange:Z,children:[e.jsx(Pe,{"data-testid":"select-show",children:e.jsx(Oe,{placeholder:"Filter by show..."})}),e.jsxs(_e,{children:[e.jsx(v,{value:"all",children:"All Shows & Marketplace"}),e.jsx(v,{value:"marketplace",children:"Marketplace"}),me.map(t=>{const i=t.date||t.startDate||t.createdAt,r=i?` • ${F(new Date(i),"d MMM • HH:mm")}`:"",n=t.title||`Show #${t._id.slice(-8)}`;return e.jsx(v,{value:t._id,children:e.jsxs("span",{className:"block",children:[e.jsx("span",{className:"font-medium",children:n}),r&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r})]})]})},t._id)})]})]})}),e.jsx("div",{className:"w-full sm:w-64",children:e.jsxs(Se,{value:s,onValueChange:X,children:[e.jsx(Pe,{"data-testid":"select-status",children:e.jsx(Oe,{placeholder:"Filter by status..."})}),e.jsxs(_e,{children:[e.jsx(v,{value:"all",children:"All"}),e.jsx(v,{value:"processing",children:"Processing"}),e.jsx(v,{value:"shipped",children:"Shipped"}),e.jsx(v,{value:"delivered",children:"Delivered"}),e.jsx(v,{value:"cancelled",children:"Cancelled"})]})]})}),e.jsxs(I,{variant:"outline",onClick:ee,"data-testid":"button-reset-filters",className:"w-full sm:w-auto",children:[e.jsx(Le,{size:16,className:"mr-1"}),"Reset Filters"]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",A.length," of ",R," orders"]})]}),e.jsx(Ce,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Sales Channel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Status"}),(a==null?void 0:a.seller)!==!1&&e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Earnings"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:A.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-4 py-12 text-center",children:[e.jsx(pe,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No orders found"}),e.jsx("p",{className:"text-muted-foreground",children:s!=="all"||C!=="all"?"Try adjusting your filters":"Orders will appear here when customers make purchases"})]})}):A.map(t=>{var y,ae,ge,fe,je,ye,Ne,be;const i=((y=t.giveaway)==null?void 0:y.name)||((fe=(ge=(ae=t.items)==null?void 0:ae[0])==null?void 0:ge.productId)==null?void 0:fe.name)||"N/A",r=((ye=(je=t.items)==null?void 0:je[0])==null?void 0:ye.order_reference)||"",n=t.invoice||t._id.slice(-8),l=((Ne=t.customer)==null?void 0:Ne.userName)||"Unknown",u=t.giveaway?1:((be=t.items)==null?void 0:be.length)||0,p=t.date?new Date(t.date):new Date(t.createdAt||Date.now()),h=ue(t),x=te(t),c=t.status||"processing";return e.jsxs("tr",{className:"hover:bg-muted/50 cursor-pointer transition-colors","data-testid":`row-order-${t._id}`,onClick:()=>{B(t),N(!0)},children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[i,r?` ${r}`:""]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Order #",n]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-muted-foreground",children:F(p,"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-primary cursor-pointer hover:underline",onClick:xe=>{var we;xe.stopPropagation(),(we=t.customer)!=null&&we._id&&D("/profile/"+t.customer._id)},children:l})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:u}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:t.tokshow?"Show":"Marketplace"}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-foreground",children:["US$",h.toFixed(2)]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(Ie,{className:nt[c],"data-testid":`order-status-${c}`,children:$e(c)})}),(a==null?void 0:a.seller)!==!1&&e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:["$",x.toFixed(2)]}),e.jsx("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:e.jsx("span",{children:$e(c)})})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx(I,{variant:"ghost",size:"icon","data-testid":`button-message-customer-${t._id}`,disabled:ie===t._id,onClick:xe=>{xe.stopPropagation(),J(t)},children:e.jsx(Ee,{size:16})})})]},t._id)})})]})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ye,{currentPage:S,totalPages:se,totalItems:R,itemsPerPage:L,itemsPerPageOptions:[10,20,50,100],onPageChange:W,onItemsPerPageChange:Y,showingText:"orders",className:"bg-white dark:bg-gray-950 rounded-lg border p-4"})})]}),e.jsx(rt,{order:d,open:z,onOpenChange:N,onCancelOrder:V,cancelLoading:_.isPending,onViewShipment:t=>{sessionStorage.setItem("openShipmentDrawer",JSON.stringify(t)),N(!1),D("/shipping")},onMessageBuyer:t=>{m({title:"Messaging feature coming soon!"})}}),e.jsx(Be,{open:$,onOpenChange:t=>{j(t),t||(P(null),O(!1))},children:e.jsxs(Qe,{"data-testid":"dialog-cancel-order",children:[e.jsxs(Ke,{children:[e.jsx(Ue,{children:"Cancel Order"}),e.jsx(Re,{children:"Are you sure you want to cancel this order? This action cannot be undone."})]}),e.jsxs("div",{className:"flex items-center space-x-2 my-4",children:[e.jsx(Je,{id:"relist-cancel-order",checked:K,onCheckedChange:t=>O(t===!0),"data-testid":"checkbox-relist-cancel-order"}),e.jsx(We,{htmlFor:"relist-cancel-order",className:"text-sm cursor-pointer",children:"Relist this order for future processing"})]}),e.jsxs(He,{children:[e.jsx(ze,{onClick:()=>{j(!1),P(null),O(!1)},"data-testid":"button-keep-order",children:"Keep Order"}),e.jsx(Ve,{onClick:G,disabled:_.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50","data-testid":"button-confirm-cancel-order",children:_.isPending?"Cancelling...":"Cancel Order"})]})]})})]})}export{Tt as default};
