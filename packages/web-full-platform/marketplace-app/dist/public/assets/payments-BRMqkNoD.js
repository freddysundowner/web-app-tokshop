import{r as P,e as A,a as T,j as s,q as r,k as y}from"./index-sx6K5zvX.js";import{u as K}from"./useQuery-BbAFWd3P.js";import{u as h}from"./useMutation-CvlU_VR_.js";import{C as j,a as Q,d as L,c as F,b as g}from"./card-y7XVqkDr.js";import{B as v}from"./button-BhKWRVKT.js";import{S as B}from"./separator-GUgqmzB4.js";import{D as R,a as I,b as O,c as N}from"./dropdown-menu-BOeL9IeC.js";import{A as Y}from"./add-payment-dialog-DVik9UeH.js";import{P as U}from"./plus-C4q9dHNM.js";import{C as l}from"./credit-card-dlBmie7d.js";import{C as b}from"./check-y82geyed.js";import{E as V}from"./ellipsis-vertical-ZTXlRsIR.js";import{T as z}from"./trash-2-DvJeVEKj.js";import"./index-CLz3BQaN.js";import"./index-BVScwSuZ.js";import"./index-UxBk8lm-.js";import"./index-DI5236x7.js";import"./chevron-right-BMekTT0X.js";import"./circle-BdzxhEiG.js";import"./dialog-lan0uYA-.js";import"./index-BvxB2yyY.js";import"./index-x7xp_GjN.js";function ye(){var x;const[w,c]=P.useState(!1),{toast:d}=A(),{user:t}=T(),i=(t==null?void 0:t.id)||(t==null?void 0:t._id),{data:n=[],isLoading:C}=K({queryKey:[`/users/paymentmethod/${i}`],enabled:!!i}),m=((x=t==null?void 0:t.defaultpaymentmethod)==null?void 0:x._id)||(t==null?void 0:t.defaultpaymentmethod),u=h({mutationFn:async e=>await y("PUT","/stripe/default",{userid:t==null?void 0:t.id,paymentMethodId:e}),onSuccess:()=>{r.invalidateQueries({queryKey:[`/users/paymentmethod/${i}`]}),r.invalidateQueries({queryKey:["/api/auth/session"]}),d({title:"Default payment method updated",description:"Your default payment method has been updated successfully."})},onError:e=>{d({title:"Failed to update default payment method",description:e.message,variant:"destructive"})}}),p=h({mutationFn:async e=>await y("DELETE","/stripe/remove",{paymentMethodId:e,userid:t==null?void 0:t.id}),onSuccess:()=>{r.invalidateQueries({queryKey:[`/users/paymentmethod/${i}`]}),r.invalidateQueries({queryKey:["/api/auth/session"]}),d({title:"Payment method removed",description:"The payment method has been removed successfully."})},onError:e=>{d({title:"Failed to remove payment method",description:e.message,variant:"destructive"})}}),D=e=>{u.mutate(e)},_=e=>{p.mutate(e)},M=e=>{const a=e.name||e.brand||e.card_type||e.type||"";return{visa:"Visa",mastercard:"Mastercard",amex:"American Express",discover:"Discover"}[a.toLowerCase()]||(a?a.charAt(0).toUpperCase()+a.slice(1):"Card")},k=e=>e.last4||e.lastFour||e.last_four||"****",E=e=>e.expiry?e.expiry:e.exp_month&&e.exp_year?`${String(e.exp_month).padStart(2,"0")}/${e.exp_year}`:"",S=()=>{r.invalidateQueries({queryKey:[`/users/paymentmethod/${i}`]}),r.invalidateQueries({queryKey:["/api/auth/session"]})};return s.jsxs("div",{className:"min-h-screen bg-background",children:[s.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground","data-testid":"text-page-title",children:"Payment Methods"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your saved payment methods"})]}),s.jsxs(v,{onClick:()=>c(!0),"data-testid":"button-add-card",className:"w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-black",children:[s.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Card"]})]}),s.jsxs(j,{children:[s.jsxs(Q,{children:[s.jsx(L,{className:"text-lg",children:"Saved Cards"}),s.jsx(F,{children:"Your saved payment methods for quick checkout"})]}),s.jsx(g,{className:"space-y-1",children:C?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:"Loading payment methods..."})]}):n.length===0?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(l,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),s.jsx("p",{className:"text-muted-foreground","data-testid":"text-no-cards",children:"No payment methods saved"}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Add a card to get started"})]}):n.map((e,a)=>{const o=e.primary||e._id===m||e.id===m,q=M(e),$=k(e),f=E(e);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between py-4 gap-2",children:[s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 flex-1 min-w-0",children:[s.jsx("div",{className:"h-10 w-14 sm:h-12 sm:w-16 rounded-md border border-border flex items-center justify-center bg-muted flex-shrink-0",children:s.jsx(l,{className:"h-5 w-5 sm:h-6 sm:w-6 text-muted-foreground"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsxs("p",{className:"font-medium text-foreground text-sm sm:text-base truncate","data-testid":`text-card-${e._id||e.id}`,children:[q," •••• ",$]}),o&&s.jsxs("div",{className:"flex items-center gap-1 bg-primary/10 text-primary px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0","data-testid":`badge-default-${e._id||e.id}`,children:[s.jsx(b,{className:"h-3 w-3"}),"Default"]})]}),f&&s.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Expires ",f]})]})]}),s.jsxs(R,{children:[s.jsx(I,{asChild:!0,children:s.jsx(v,{variant:"ghost",size:"icon","data-testid":`button-menu-${e._id||e.id}`,className:"flex-shrink-0",disabled:u.isPending||p.isPending,children:s.jsx(V,{className:"h-4 w-4"})})}),s.jsxs(O,{align:"end",children:[!o&&s.jsxs(N,{onClick:()=>D(e._id||e.id||""),"data-testid":`button-set-default-${e._id||e.id}`,children:[s.jsx(b,{className:"h-4 w-4 mr-2"}),"Set as Default"]}),s.jsxs(N,{onClick:()=>_(e._id||e.id||""),className:"text-destructive","data-testid":`button-remove-${e._id||e.id}`,children:[s.jsx(z,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]})]}),a<n.length-1&&s.jsx(B,{})]},e._id||e.id)})})]}),s.jsx(j,{children:s.jsx(g,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"h-8 w-8 rounded-full bg-muted flex items-center justify-center flex-shrink-0",children:s.jsx(l,{className:"h-4 w-4 text-muted-foreground"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-foreground mb-1",children:"Secure payments"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Your payment information is encrypted and securely stored. We never store your full card details."})]})]})})})]}),s.jsx(Y,{open:w,onOpenChange:c,onSuccess:S})]})}export{ye as default};
