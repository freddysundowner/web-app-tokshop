import{r as i,a as lt,b as ct,g as ot,d as dt,j as e,B as p,X as ye,q as O}from"./index-GnvmivW0.js";import{u as Ne}from"./useMutation-DAKVWGzI.js";import{C as we}from"./card-Bsqf9o7h.js";import{B as W}from"./badge-CL9MXKGS.js";import{I as mt}from"./input-CDJz7BeV.js";import{S as Ce,a as ke,b as Se,c as Oe,d as u}from"./select-EUq1_viI.js";import{D as Pe,a as Ie,b as Te,c as P,d as pt}from"./dropdown-menu-B2qYf86A.js";import{D as X,a as Z,b as ee,c as te,d as $e,e as De}from"./dialog-D1L4tMGI.js";import{T as Fe}from"./textarea-DkmXbh6O.js";import{L as c}from"./label-CbaFYhHW.js";import{R as _e,a as g}from"./radio-group-CiS8qgSW.js";import{a as I,f as o,g as Ae}from"./pricing-DCyf_yea.js";import{C as ht}from"./pagination-COmJENkB.js";import{S as xt}from"./search-DE1AZ4db.js";import{P as se}from"./package-DWwkENv3.js";import{E as Me}from"./ellipsis-CgHIMWzm.js";import{P as Re}from"./printer-Cmv9hO84.js";import{T as Ee}from"./truck-DP2GNOS8.js";import{f as ae}from"./format-Crz72tIO.js";import"./index-BdQq_4o_.js";import"./index-CmYyiKyk.js";import"./index-Vue-pIA6.js";import"./chevron-down-tcDKR_mK.js";import"./check-DoxmrmEj.js";import"./chevron-up-Cda9uppk.js";import"./index-kVvGtud3.js";import"./chevron-right-CXw-mF7y.js";import"./circle-iUglX5Df.js";import"./chevron-left-BnuQCvWV.js";import"./en-US-Cc-9gH5A.js";const Le={processing:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",delivered:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",ended:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},ut={"pending cancellation":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",progressing:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",cancelled:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",completed:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",shipped:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},qe={processing:1,shipped:2,delivered:3,ended:4,cancelled:5},re=h=>h?h.split("_").map(T=>T.charAt(0).toUpperCase()+T.slice(1).toLowerCase()).join(" "):"Unknown";function zt(){var me,pe,he,xe,ue;const[h,T]=i.useState(""),[j,Ue]=i.useState("all"),[ne,Be]=i.useState("status"),[$,q]=i.useState(1),[k,Qe]=i.useState(20),[a,U]=i.useState(null),[Ke,D]=i.useState(!1),[Ve,F]=i.useState(!1),[ie,B]=i.useState(null),[N,Q]=i.useState(""),[K,V]=i.useState(""),[He,_]=i.useState(!1),[H,A]=i.useState(null),[w,M]=i.useState(""),[z,R]=i.useState(""),{user:l}=lt(),{settings:ze}=ct(),{toast:f}=ot(),{data:C,isLoading:Ge,error:G,isError:Je,refetch:Ye}=dt({queryKey:["external-purchases",l==null?void 0:l.id,j,$,k],queryFn:async()=>{const t=new URLSearchParams;l!=null&&l.id&&t.set("customer",l.id),j&&j!=="all"&&t.set("status",j),t.set("page",$.toString()),t.set("limit",k.toString());const s=await fetch(`/api/orders?${t.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`External API error: ${s.status}`);return s.json()},enabled:!!(l!=null&&l.id),staleTime:0,refetchOnMount:!0});i.useEffect(()=>{const t=sessionStorage.getItem("openPurchaseOrder");if(t)try{const s=JSON.parse(t);U(s),D(!0),sessionStorage.removeItem("openPurchaseOrder")}catch(s){console.error("Failed to parse order from sessionStorage:",s),sessionStorage.removeItem("openPurchaseOrder")}},[]);const E=Ne({mutationFn:async({orderId:t,reason:s})=>{const n=await fetch("/api/orders/cancel/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:t,relist:!1,initiator:"buyer",type:"order",description:s})});if(!n.ok)throw new Error("Failed to cancel order");return n.json()},onSuccess:async()=>{await O.invalidateQueries({queryKey:["external-purchases"]}),await O.invalidateQueries({queryKey:["/api/orders"]}),f({title:"Order cancelled successfully"}),D(!1),F(!1),B(null),Q(""),V("")},onError:()=>{f({title:"Failed to cancel order",variant:"destructive"})}}),We=t=>{B(t),F(!0)},Xe=()=>{if(ie){const t=N==="Other"?K:N;E.mutate({orderId:ie,reason:t})}},L=Ne({mutationFn:async({orderId:t,itemId:s,reason:n})=>{const r=await fetch("/api/orders/cancel/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:s,relist:!1,initiator:"buyer",type:"item",description:n})});if(!r.ok)throw new Error("Failed to cancel item");return r.json()},onSuccess:async()=>{var t;if(await O.invalidateQueries({queryKey:["external-purchases"]}),await O.invalidateQueries({queryKey:["/api/orders"]}),f({title:"Item cancelled successfully"}),_(!1),A(null),M(""),R(""),await new Promise(s=>setTimeout(s,100)),a){const s=O.getQueryData(["external-purchases",l==null?void 0:l.id,j,$,k]),n=(t=s==null?void 0:s.orders)==null?void 0:t.find(r=>r._id===a._id);n&&U(n)}},onError:()=>{f({title:"Failed to cancel item",variant:"destructive"})}}),Ze=(t,s)=>{if(!s){f({title:"Cannot cancel item",description:"Item ID is missing",variant:"destructive"});return}console.log("Cancel item clicked:",{orderId:t,itemId:s}),A({orderId:t,itemId:s}),_(!0)},et=()=>{if(H){const t=w==="Other"?z:w;L.mutate({orderId:H.orderId,itemId:H.itemId,reason:t})}},le=(C==null?void 0:C.orders)||[],J=(C==null?void 0:C.total)||le.length,tt=Math.ceil(J/k),Y=[...le.filter(t=>!h||t._id.toLowerCase().includes(h.toLowerCase())||(t.items||[]).some(n=>{var r,d;return(d=(r=n.productId)==null?void 0:r.name)==null?void 0:d.toLowerCase().includes(h.toLowerCase())}))].sort((t,s)=>{switch(ne){case"total-high":return I(s)-I(t);case"total-low":return I(t)-I(s);case"status":const n=qe[t.status]||999,r=qe[s.status]||999;return n-r;default:return 0}}),ce=t=>{if(!t.tracking_number){f({title:"No Tracking Available",description:"This order doesn't have a tracking number yet.",variant:"destructive"});return}const s=`https://parcelsapp.com/en/tracking/${t.tracking_number}`;window.open(s,"_blank","noopener,noreferrer")},oe=t=>{U(t),D(!0)},de=t=>{var d,b,v,x,y;const s=Ae(t),n=`
      <!DOCTYPE html>
      <html>
        <head>
          <title>Receipt - Order #${t.invoice||((d=t._id)==null?void 0:d.slice(-8))||"N/A"}</title>
          <style>
            body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
            .order-info { margin-bottom: 20px; }
            .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .items-table th { background-color: #f2f2f2; }
            .totals { margin-top: 20px; text-align: right; }
            .total-line { display: flex; justify-content: space-between; margin: 5px 0; }
            .final-total { font-weight: bold; border-top: 2px solid #000; padding-top: 5px; }
            @media print { .no-print { display: none; } }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>Purchase Receipt</h1>
            <p>${ze.app_name}</p>
          </div>
          
          <div class="order-info">
            <h3>Order #${t.invoice||((b=t._id)==null?void 0:b.slice(-8))||"N/A"}</h3>
            <p><strong>Date:</strong> ${t.createdAt?ae(new Date(t.createdAt),"MMM d, yyyy 'at' h:mm a"):"Date unknown"}</p>
            <p><strong>Status:</strong> ${re(t.status)}</p>
            <p><strong>Customer:</strong> ${((v=t.customer)==null?void 0:v.firstName)||""} ${((x=t.customer)==null?void 0:x.lastName)||""}</p>
            <p><strong>Email:</strong> ${((y=t.customer)==null?void 0:y.email)||""}</p>
            ${t.tracking_number?`<p><strong>Tracking:</strong> ${t.tracking_number}</p>`:""}
          </div>

          <table class="items-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              ${(t.items||[]).map(m=>{var S;return`
                <tr>
                  <td>${((S=m.productId)==null?void 0:S.name)||"Unknown Product"}${m.order_reference?` ${m.order_reference}`:""}</td>
                  <td>${m.quantity||0}</td>
                  <td>$${(m.price||0).toFixed(2)}</td>
                  <td>$${((m.quantity||0)*(m.price||0)).toFixed(2)}</td>
                </tr>
              `}).join("")}
            </tbody>
          </table>

          <div class="totals">
            <div class="total-line">
              <span>Subtotal:</span>
              <span>${o(s.subtotal)}</span>
            </div>
            ${s.serviceFee>0?`
              <div class="total-line">
                <span>Service Fee:</span>
                <span>${o(s.serviceFee)}</span>
              </div>
            `:""}
            ${s.tax>0?`
              <div class="total-line">
                <span>Tax:</span>
                <span>${o(s.tax)}</span>
              </div>
            `:""}
            ${s.shippingFee>0?`
              <div class="total-line">
                <span>Shipping:</span>
                <span>${o(s.shippingFee)}</span>
              </div>
            `:""}
            <div class="total-line final-total">
              <span>Total:</span>
              <span>${o(s.total)}</span>
            </div>
          </div>

          <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button onclick="window.print()">Print Receipt</button>
            <button onclick="window.close()" style="margin-left: 10px;">Close</button>
          </div>
        </body>
      </html>
    `,r=window.open("","_blank","width=800,height=600");r?(r.document.write(n),r.document.close(),r.onload=()=>{r.print()}):f({title:"Print Blocked",description:"Unable to open print window. Please allow popups and try again.",variant:"destructive"})},st=t=>{Ue(t),q(1)},at=t=>{Be(t)},rt=t=>{q(t)},nt=t=>{Qe(t),q(1)};return Ge?e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6","data-testid":"page-purchases",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-muted rounded w-32 animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-48 mt-2 animate-pulse"})]})}),e.jsx("div",{className:"grid gap-4",children:[1,2,3].map(t=>e.jsx("div",{className:"h-32 bg-muted rounded animate-pulse"},t))})]}):Je?e.jsx("div",{className:"w-full p-4 sm:p-6","data-testid":"page-purchases",children:e.jsxs(we,{className:"p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Unable to load purchases"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:(G==null?void 0:G.message)||"There was an error loading your purchases. Please try again."}),e.jsx(p,{onClick:()=>Ye(),"data-testid":"button-retry-purchases",children:"Try Again"})]})}):e.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6","data-testid":"page-purchases",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground","data-testid":"text-page-title",children:"My Purchases"}),e.jsxs("p",{className:"text-sm text-muted-foreground","data-testid":"text-page-description",children:["Track your order history and purchase status (",J," purchases)"]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(xt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(mt,{placeholder:"Search purchases...",value:h,onChange:t=>T(t.target.value),className:"pl-10","data-testid":"input-search-purchases"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ce,{value:j,onValueChange:st,children:[e.jsx(ke,{className:"w-[140px]","data-testid":"select-status-filter",children:e.jsx(Se,{placeholder:"Status"})}),e.jsxs(Oe,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"processing",children:"Processing"}),e.jsx(u,{value:"shipped",children:"Shipped"}),e.jsx(u,{value:"delivered",children:"Delivered"}),e.jsx(u,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(Ce,{value:ne,onValueChange:at,children:[e.jsx(ke,{className:"w-[140px]","data-testid":"select-sort",children:e.jsx(Se,{placeholder:"Sort by"})}),e.jsxs(Oe,{children:[e.jsx(u,{value:"total-high",children:"Total: High to Low"}),e.jsx(u,{value:"total-low",children:"Total: Low to High"}),e.jsx(u,{value:"status",children:"Status"})]})]})]})]}),e.jsx(we,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Order"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Seller"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:Y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-4 py-12 text-center",children:[e.jsx(se,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No purchases found"}),e.jsx("p",{className:"text-muted-foreground",children:h||j!=="all"?"Try adjusting your search or filters":"You haven't made any purchases yet"})]})}):Y.map(t=>{var y,m,S,ge,je,fe,be,ve;const s=((S=(m=(y=t.items)==null?void 0:y[0])==null?void 0:m.productId)==null?void 0:S.name)||"N/A",n=((je=(ge=t.items)==null?void 0:ge[0])==null?void 0:je.order_reference)||"",r=t.invoice||t._id.slice(-8),d=`${((fe=t.seller)==null?void 0:fe.firstName)||""} ${((be=t.seller)==null?void 0:be.lastName)||""}`.trim()||"Unknown",b=((ve=t.items)==null?void 0:ve.length)||0,v=t.createdAt?new Date(t.createdAt):new Date,x=t.status||"processing";return e.jsxs("tr",{className:"hover:bg-muted/50 cursor-pointer transition-colors","data-testid":`row-purchase-${t._id}`,onClick:()=>oe(t),children:[e.jsxs("td",{className:"px-4 py-4",children:[e.jsxs("div",{className:"text-sm font-medium text-foreground",children:[s,n?` ${n}`:""]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Order #",r]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-muted-foreground",children:ae(v,"dd MMM yyyy")}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:"text-foreground hover:text-primary",children:d})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-muted-foreground",children:b}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-foreground",children:["US$",I(t).toFixed(2)]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(W,{className:Le[x],children:re(x)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm",onClick:it=>it.stopPropagation(),children:e.jsxs(Pe,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm","data-testid":`button-actions-${t._id}`,children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsxs(Te,{align:"end",children:[e.jsxs(P,{onSelect:()=>oe(t),children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(P,{onSelect:()=>de(t),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Print Receipt"]}),t.status==="shipped"&&e.jsxs(P,{onSelect:()=>ce(t),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Track Package"]}),(t.status==="processing"||t.status==="unfulfilled")&&e.jsxs(e.Fragment,{children:[e.jsx(pt,{}),e.jsxs(P,{onSelect:()=>We(t._id),"data-testid":`button-cancel-order-${t._id}`,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Cancel Order"]})]})]})]})})]},t._id)})})]})})}),Y.length>0&&e.jsx(ht,{currentPage:$,totalPages:tt,totalItems:J,itemsPerPage:k,onPageChange:rt,onItemsPerPageChange:nt,showingText:"purchases",className:"bg-white dark:bg-gray-950 rounded-lg border p-4"}),e.jsx(X,{open:Ke,onOpenChange:D,children:e.jsx(Z,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx(ee,{children:e.jsx(te,{children:"Order Details"})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2","data-testid":"text-details-order-id",children:["Order #",a.invoice||((me=a._id)==null?void 0:me.slice(-8))||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Date:"})," ",a.createdAt?ae(new Date(a.createdAt),"MMM d, yyyy 'at' h:mm a"):"Date unknown"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Status:"}),e.jsx(W,{className:`ml-2 ${Le[a.status]}`,children:re(a.status)})]}),a.tracking_number&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Tracking:"})," ",a.tracking_number]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Customer Information"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Name:"})," ",(pe=a.customer)==null?void 0:pe.firstName," ",(he=a.customer)==null?void 0:he.lastName]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-1",children:[e.jsx("strong",{children:"Email:"})," ",(xe=a.customer)==null?void 0:xe.email]}),((ue=a.customer)==null?void 0:ue.address)&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Shipping Address:"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.customer.address.name,e.jsx("br",{}),a.customer.address.addrress1,e.jsx("br",{}),a.customer.address.city,", ",a.customer.address.state," ",a.customer.address.zipcode]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Product"}),e.jsx("th",{className:"text-center p-3",children:"Quantity"}),e.jsx("th",{className:"text-right p-3",children:"Price"}),e.jsx("th",{className:"text-right p-3",children:"Total"}),e.jsx("th",{className:"text-right p-3",children:"Actions"})]})}),e.jsx("tbody",{children:(a.items||[]).map((t,s)=>{var n,r,d,b,v,x;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[(n=t.productId)!=null&&n.images&&t.productId.images.length>0?e.jsx("img",{src:t.productId.images[0],alt:((r=t.productId)==null?void 0:r.name)||"Product",className:"w-12 h-12 rounded object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-muted rounded flex items-center justify-center",children:e.jsx(se,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[((d=t.productId)==null?void 0:d.name)||"Unknown Product",t.order_reference?` ${t.order_reference}`:""]}),((v=(b=t.productId)==null?void 0:b.category)==null?void 0:v.name)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.productId.category.name}),t.status&&e.jsx(W,{className:`mt-1 text-xs ${ut[t.status.toLowerCase()]||"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,"data-testid":`badge-item-status-${s}`,children:t.status.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase())})]})]})}),e.jsx("td",{className:"p-3 text-center",children:t.quantity||0}),e.jsx("td",{className:"p-3 text-right",children:o(t.price||0)}),e.jsx("td",{className:"p-3 text-right font-medium",children:o((t.quantity||0)*(t.price||0))}),e.jsx("td",{className:"p-3 text-right",children:(a.status==="processing"||a.status==="unfulfilled")&&((x=t.status)==null?void 0:x.toLowerCase())!=="pending_cancellation"&&e.jsxs(Pe,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm","data-testid":`button-item-actions-${s}`,children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsx(Te,{align:"end",children:e.jsxs(P,{onSelect:()=>{Ze(a._id,t._id)},"data-testid":`button-cancel-item-${s}`,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Cancel Item"]})})]})})]},s)})})]})})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Summary"}),(()=>{const t=Ae(a);return e.jsxs("div",{className:"space-y-2 max-w-sm ml-auto",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:o(t.subtotal)})]}),t.serviceFee>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Service Fee:"}),e.jsx("span",{children:o(t.serviceFee)})]}),t.tax>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:o(t.tax)})]}),t.shippingFee>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping:"}),e.jsx("span",{children:o(t.shippingFee)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:o(t.total)})]})]})})()]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[a.status==="shipped"&&a.tracking_number&&e.jsxs(p,{variant:"outline",onClick:()=>ce(a),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Track Package"]}),e.jsxs(p,{variant:"outline",onClick:()=>de(a),children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Print Receipt"]})]})]})]})})}),e.jsx(X,{open:Ve,onOpenChange:F,children:e.jsxs(Z,{"data-testid":"dialog-cancel-order",children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Cancel Order"}),e.jsx($e,{children:"Please select a reason for cancelling this order. This action cannot be undone."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Reason for Cancellation"}),e.jsxs(_e,{value:N,onValueChange:Q,"data-testid":"radio-cancel-reasons",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Accidental purchase",id:"reason-accidental","data-testid":"radio-reason-accidental"}),e.jsx(c,{htmlFor:"reason-accidental",className:"font-normal cursor-pointer",children:"Accidental purchase"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Ordered the wrong item",id:"reason-wrong-item","data-testid":"radio-reason-wrong-item"}),e.jsx(c,{htmlFor:"reason-wrong-item",className:"font-normal cursor-pointer",children:"Ordered the wrong item"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Shipping taking too long",id:"reason-shipping","data-testid":"radio-reason-shipping"}),e.jsx(c,{htmlFor:"reason-shipping",className:"font-normal cursor-pointer",children:"Shipping taking too long"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Other",id:"reason-other","data-testid":"radio-reason-other"}),e.jsx(c,{htmlFor:"reason-other",className:"font-normal cursor-pointer",children:"Other"})]})]})]}),N==="Other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"custom-cancel-reason",children:"Please specify"}),e.jsx(Fe,{id:"custom-cancel-reason",placeholder:"Enter your reason...",value:K,onChange:t=>V(t.target.value),rows:3,"data-testid":"textarea-custom-cancel-reason"})]})]}),e.jsxs(De,{children:[e.jsx(p,{variant:"outline",onClick:()=>{F(!1),B(null),Q(""),V("")},disabled:E.isPending,"data-testid":"button-cancel-dialog-close",children:"Keep Order"}),e.jsx(p,{variant:"destructive",onClick:Xe,disabled:E.isPending||!N||N==="Other"&&!K.trim(),"data-testid":"button-confirm-cancel",children:E.isPending?"Cancelling...":"Cancel Order"})]})]})}),e.jsx(X,{open:He,onOpenChange:t=>{_(t),t||(A(null),M(""),R(""))},children:e.jsxs(Z,{"data-testid":"dialog-cancel-item",children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Cancel Item"}),e.jsx($e,{children:"Please select a reason for cancelling this item. This action cannot be undone."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"Reason for Cancellation"}),e.jsxs(_e,{value:w,onValueChange:M,"data-testid":"radio-cancel-item-reasons",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Accidental purchase",id:"item-reason-accidental","data-testid":"radio-item-reason-accidental"}),e.jsx(c,{htmlFor:"item-reason-accidental",className:"font-normal cursor-pointer",children:"Accidental purchase"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Ordered the wrong item",id:"item-reason-wrong-item","data-testid":"radio-item-reason-wrong-item"}),e.jsx(c,{htmlFor:"item-reason-wrong-item",className:"font-normal cursor-pointer",children:"Ordered the wrong item"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Shipping taking too long",id:"item-reason-shipping","data-testid":"radio-item-reason-shipping"}),e.jsx(c,{htmlFor:"item-reason-shipping",className:"font-normal cursor-pointer",children:"Shipping taking too long"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{value:"Other",id:"item-reason-other","data-testid":"radio-item-reason-other"}),e.jsx(c,{htmlFor:"item-reason-other",className:"font-normal cursor-pointer",children:"Other"})]})]})]}),w==="Other"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"custom-item-cancel-reason",children:"Please specify"}),e.jsx(Fe,{id:"custom-item-cancel-reason",placeholder:"Enter your reason...",value:z,onChange:t=>R(t.target.value),rows:3,"data-testid":"textarea-custom-item-cancel-reason"})]})]}),e.jsxs(De,{children:[e.jsx(p,{variant:"outline",onClick:()=>{_(!1),A(null),M(""),R("")},disabled:L.isPending,"data-testid":"button-cancel-item-dialog-close",children:"Keep Item"}),e.jsx(p,{variant:"destructive",onClick:et,disabled:L.isPending||!w||w==="Other"&&!z.trim(),"data-testid":"button-confirm-cancel-item",children:L.isPending?"Cancelling...":"Cancel Item"})]})]})})]})}export{zt as default};
