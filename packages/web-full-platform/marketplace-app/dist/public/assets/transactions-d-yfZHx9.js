import{a as U,r as m,j as e,X as C}from"./index-sx6K5zvX.js";import{u as F}from"./useQuery-BbAFWd3P.js";import{C as V,a as K,d as O,c as Q,b as W}from"./card-y7XVqkDr.js";import{T as X,a as G,b as S,c as x,d as J,e as p}from"./table-cwTNereq.js";import{B as T}from"./badge-CnP4rDPZ.js";import{B as o}from"./button-BhKWRVKT.js";import{I as Y}from"./input-D9aLazCK.js";import{S as Z,a as D,b as ee,c as te,d as u}from"./select-C7m4p16O.js";import{D as se,a as ae,b as re,c as ie}from"./dialog-lan0uYA-.js";import{C as R}from"./credit-card-dlBmie7d.js";import{S as ne}from"./search-CokuAmim.js";import{E as le}from"./eye-ANbkX93n.js";import{C as oe}from"./chevron-left-Z_N2qaLO.js";import{C as ce}from"./chevron-right-BMekTT0X.js";import{P as de}from"./printer-BbqO0LIN.js";import"./index-BdQq_4o_.js";import"./index-CLz3BQaN.js";import"./index-BVScwSuZ.js";import"./index-DI5236x7.js";import"./index-yIM9ZdYr.js";import"./chevron-down-D9nmsT4r.js";import"./check-y82geyed.js";import"./chevron-up-BQLqsJm2.js";import"./index-BvxB2yyY.js";function Ee(){const{user:me}=U(),[c,g]=m.useState(""),[l,k]=m.useState("all"),[d,f]=m.useState(1),[r,z]=m.useState(null),[P,j]=m.useState(!1),A=20,b=t=>{k(t),f(1)},{data:a,isLoading:L}=F({queryKey:["user-transactions",d,l],queryFn:async()=>{const t=new URLSearchParams({page:d.toString(),limit:A.toString()});l&&l!=="all"&&t.append("status",l);const s=await fetch(`/api/user/transactions?${t.toString()}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch transactions");const i=await s.json();return i.success?i.data:i}}),{data:n}=F({queryKey:["public-settings"],queryFn:async()=>{const t=await fetch("/api/public/settings",{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch settings");const s=await t.json();return s.success?s.data:s}}),_=(a==null?void 0:a.transactions)||(a==null?void 0:a.data)||[],h=(a==null?void 0:a.pages)||(a==null?void 0:a.totalPages)||1,$=(a==null?void 0:a.total)||(a==null?void 0:a.totalRecords)||0,E=(n==null?void 0:n.support_email)||"",B=(n==null?void 0:n.stripe_fee)||"0",M=(n==null?void 0:n.extra_charges)||"0",v=_.filter(t=>{var i,y,w;if(!c)return!0;const s=c.toLowerCase();return((i=t._id)==null?void 0:i.toLowerCase().includes(s))||((y=t.type)==null?void 0:y.toLowerCase().includes(s))||((w=t.status)==null?void 0:w.toLowerCase().includes(s))}),H=t=>{z(t),j(!0)},N=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}},I=t=>{const i={completed:{label:"Completed",variant:"default"},pending:{label:"Pending",variant:"secondary"},failed:{label:"Failed",variant:"destructive"},refunded:{label:"Refunded",variant:"outline"}}[t==null?void 0:t.toLowerCase()]||{label:t||"Unknown",variant:"outline"};return e.jsx(T,{variant:i.variant,"data-testid":`badge-status-${t}`,children:i.label})},q=t=>{const i={payment:{label:"Payment",variant:"default"},refund:{label:"Refund",variant:"secondary"},payout:{label:"Payout",variant:"outline"}}[t==null?void 0:t.toLowerCase()]||{label:t||"Unknown",variant:"outline"};return e.jsx(T,{variant:i.variant,children:i.label})};return e.jsxs("div",{className:"py-4 sm:py-6",children:[e.jsxs("div",{className:"px-4 sm:px-6 md:px-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2","data-testid":"text-transactions-title",children:[e.jsx(R,{className:"h-5 w-5 sm:h-6 sm:w-6"}),"My Transactions"]}),e.jsx("p",{className:"mt-1 text-xs sm:text-sm text-muted-foreground",children:"View your transaction history and receipts"})]}),e.jsxs(V,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{children:"Transaction History"}),e.jsx(Q,{children:"All your payments, refunds, and payouts"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"relative flex-1 sm:flex-initial sm:w-64",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search transactions...",value:c,onChange:t=>g(t.target.value),className:"pl-9 pr-9","data-testid":"input-search"}),c&&e.jsx(o,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7 p-0",onClick:()=>g(""),"data-testid":"button-clear-search",children:e.jsx(C,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs(Z,{value:l,onValueChange:b,children:[e.jsx(D,{className:"w-full sm:w-[180px]","data-testid":"select-status-filter",children:e.jsx(ee,{placeholder:"Filter by status"})}),e.jsxs(te,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"completed",children:"Completed"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"failed",children:"Failed"}),e.jsx(u,{value:"refunded",children:"Refunded"})]})]}),l!=="all"&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>b("all"),"data-testid":"button-clear-filter",className:"w-full sm:w-auto",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Clear Filter"]})]})]})}),e.jsx(W,{children:L?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:c||l!=="all"?"No transactions found":"No transactions yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(G,{children:e.jsxs(S,{children:[e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Amount"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(J,{children:v.map(t=>e.jsxs(S,{"data-testid":`row-transaction-${t._id}`,children:[e.jsx(p,{className:"font-medium",children:N(t.createdAt)}),e.jsx(p,{children:q(t.type)}),e.jsx(p,{children:I(t.status)}),e.jsxs(p,{className:"text-right font-medium",children:["$",(parseFloat(t.amount)||0).toFixed(2)]}),e.jsx(p,{className:"text-right",children:e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>H(t),"data-testid":`button-view-receipt-${t._id}`,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Receipt"]})})]},t._id))})]})}),h>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-muted-foreground",children:["Showing page ",d," of ",h," (",$," total)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.max(1,t-1)),disabled:d===1,"data-testid":"button-prev-page",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>f(t=>Math.min(h,t+1)),disabled:d===h,"data-testid":"button-next-page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx(ce,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(se,{open:P,onOpenChange:j,children:e.jsxs(ae,{className:"max-w-md",children:[e.jsx(re,{children:e.jsx(ie,{children:"Transaction Receipt"})}),r&&e.jsxs("div",{id:"receipt-content-user-transactions",className:"space-y-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Receipt"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Transaction ID: ",e.jsx("span",{className:"font-mono",children:r._id})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N(r.createdAt)})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type:"}),e.jsx("span",{className:"font-medium capitalize",children:r.type||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize",children:r.status||"N/A"})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total:"}),e.jsxs("span",{children:["$",(parseFloat(r.total)||0).toFixed(2)]})]}),(()=>{const t=parseFloat(r.stripe_fee)||0,s=parseFloat(r.extra_charges)||0,i=t+s;return i>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Service Charge (",B,"% + ",M,"%):"]}),e.jsxs("span",{className:"text-destructive",children:["-$",i.toFixed(2)]})]})})(),r.serviceFee&&parseFloat(r.serviceFee)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Service Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",parseFloat(r.serviceFee).toFixed(2)]})]}),r.shippingFee&&parseFloat(r.shippingFee)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping Fee:"}),e.jsxs("span",{className:"text-destructive",children:["-$",parseFloat(r.shippingFee).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Amount:"}),e.jsxs("span",{children:["$",(parseFloat(r.amount)||0).toFixed(2)]})]})]}),e.jsxs("div",{className:"text-center text-xs text-muted-foreground border-t pt-4",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsxs("p",{children:["For support, please contact ",E]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>j(!1),"data-testid":"button-close-receipt",children:"Close"}),e.jsxs(o,{onClick:()=>{const t=document.getElementById("receipt-content-user-transactions");if(t){const s=window.open("","_blank");s&&(s.document.write(`
                      <html>
                        <head>
                          <title>Receipt</title>
                          <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .space-y-4 > * + * { margin-top: 1rem; }
                            .space-y-2 > * + * { margin-top: 0.5rem; }
                            .flex { display: flex; }
                            .justify-between { justify-content: space-between; }
                            .items-center { align-items: center; }
                            .text-center { text-align: center; }
                            .border-b { border-bottom: 1px solid #ddd; padding-bottom: 1rem; }
                            .border-t { border-top: 1px solid #ddd; padding-top: 1rem; }
                            .text-muted-foreground { color: #666; }
                            .font-mono { font-family: monospace; }
                            .font-bold { font-weight: bold; }
                            .font-medium { font-weight: 500; }
                            .text-lg { font-size: 1.125rem; }
                            .text-2xl { font-size: 1.5rem; }
                            .text-xs { font-size: 0.75rem; }
                            .text-sm { font-size: 0.875rem; }
                            .capitalize { text-transform: capitalize; }
                            .text-destructive { color: #dc2626; }
                          </style>
                        </head>
                        <body>
                          ${t.innerHTML}
                        </body>
                      </html>
                    `),s.document.close(),s.print())}},"data-testid":"button-print",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})})]})}export{Ee as default};
