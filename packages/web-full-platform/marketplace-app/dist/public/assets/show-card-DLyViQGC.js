import{j as t,e as b,g as oe,L as k,q as le}from"./index-GnvmivW0.js";import{A as q,a as J,b as G}from"./avatar-T6GBhCEI.js";import{U as de}from"./user-badge-QQMJS_dE.js";import{t as ce,d as te,f as se}from"./en-US-Cc-9gH5A.js";import{B as V,i as ue,a as me}from"./isTomorrow-DSpd_Oy4.js";import{f as w}from"./format-Crz72tIO.js";function pe(e){return+ce(e)<Date.now()}function xe(e,s){const a=be(e);let i;if(a.date){const o=Ne(a.date,2);i=ve(o.restDateString,o.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);const l=i.getTime();let n=0,d;if(a.time&&(n=je(a.time),isNaN(n)))return new Date(NaN);if(a.timezone){if(d=ye(a.timezone),isNaN(d))return new Date(NaN)}else{const o=new Date(l+n),c=new Date(0);return c.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),c.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),c}return new Date(l+n+d)}const j={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ge=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,fe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,he=/^([+-])(\d{2})(?::?(\d{2}))?$/;function be(e){const s={},r=e.split(j.dateTimeDelimiter);let a;if(r.length>2)return s;if(/:/.test(r[0])?a=r[0]:(s.date=r[0],a=r[1],j.timeZoneDelimiter.test(s.date)&&(s.date=e.split(j.timeZoneDelimiter)[0],a=e.substr(s.date.length,e.length))),a){const i=j.timezone.exec(a);i?(s.time=a.replace(i[1],""),s.timezone=i[1]):s.time=a}return s}function Ne(e,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};const i=a[1]?parseInt(a[1]):null,l=a[2]?parseInt(a[2]):null;return{year:l===null?i:l*100,restDateString:e.slice((a[1]||a[2]).length)}}function ve(e,s){if(s===null)return new Date(NaN);const r=e.match(ge);if(!r)return new Date(NaN);const a=!!r[4],i=h(r[1]),l=h(r[2])-1,n=h(r[3]),d=h(r[4]),o=h(r[5])-1;if(a)return $e(s,d,o)?ke(s,d,o):new Date(NaN);{const c=new Date(0);return!De(s,l,n)||!Te(s,i)?new Date(NaN):(c.setUTCFullYear(s,l,Math.max(i,n)),c)}}function h(e){return e?parseInt(e):1}function je(e){const s=e.match(fe);if(!s)return NaN;const r=D(s[1]),a=D(s[2]),i=D(s[3]);return Ce(r,a,i)?r*te+a*se+i*1e3:NaN}function D(e){return e&&parseFloat(e.replace(",","."))||0}function ye(e){if(e==="Z")return 0;const s=e.match(he);if(!s)return 0;const r=s[1]==="+"?-1:1,a=parseInt(s[2]),i=s[3]&&parseInt(s[3])||0;return Se(a,i)?r*(a*te+i*se):NaN}function ke(e,s,r){const a=new Date(0);a.setUTCFullYear(e,0,4);const i=a.getUTCDay()||7,l=(s-1)*7+r+1-i;return a.setUTCDate(a.getUTCDate()+l),a}const we=[31,null,31,30,31,30,31,31,30,31,30,31];function ae(e){return e%400===0||e%4===0&&e%100!==0}function De(e,s,r){return s>=0&&s<=11&&r>=1&&r<=(we[s]||(ae(e)?29:28))}function Te(e,s){return s>=1&&s<=(ae(e)?366:365)}function $e(e,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function Ce(e,s,r){return e===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&e>=0&&e<25}function Se(e,s){return s>=0&&s<=59}const K={rising:"https://lh3.googleusercontent.com/d/1hlCe9xAY5hsjuNPGlBOM0eQlkFg2WHJf=w50",verified:"https://lh3.googleusercontent.com/d/19SheP1admSa7P4kikO5Y6jikx2iR1fsb=w50",icona:"https://lh3.googleusercontent.com/d/1GScLM8Db7jYvQnu09jPF5Q8ffom6g79M=w50"},X={rising:"Rising",verified:"Verified",icona:"Icona"},Ie={rising:"border-blue-200 dark:border-blue-400",verified:"border-green-200 dark:border-green-400",icona:"border-purple-400 dark:border-purple-300"},Pe={rising:"text-blue-300 dark:text-blue-400",verified:"text-green-300 dark:text-green-400",icona:"text-purple-400 dark:text-purple-300"};function Ue({badgeTier:e,size:s=18,showText:r=!0,className:a}){if(!e||e==="")return null;const i=e.toLowerCase();return K[i]?t.jsxs("div",{className:b("inline-flex items-center rounded-full border px-1.5 py-0.5",Ie[i]||"border-gray-200 dark:border-gray-600",a),"data-testid":`badge-description-${i}`,children:[t.jsx("img",{src:K[i],alt:`${X[i]} badge`,style:{width:s,height:s},className:"object-contain"}),r&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"w-1"}),t.jsx("span",{className:b("text-xs font-semibold",Pe[i]||"text-gray-400 dark:text-gray-500"),children:X[i]})]})]}):null}const ee=()=>t.jsx("div",{className:"absolute inset-0 grid grid-cols-8 grid-rows-12 gap-0",children:Array.from({length:96}).map((e,s)=>t.jsx("div",{className:"flex items-center justify-center",style:{opacity:.1+Math.random()*.3},children:t.jsx("svg",{viewBox:"0 0 200 200",className:"w-full h-full text-gray-600",children:t.jsx("path",{fill:"currentColor",d:"M100 30 L170 100 L100 170 L30 100 Z"})})},s))});function Oe({show:e,currentUserId:s,variant:r="grid",categoryName:a,showHostInfo:i=!0}){var M,_,Y,A,L,R,z,O,B,W,Z,E,H,Q;const{toast:l}=oe(),n=e._id||e.id||"",d=((M=e.viewers)==null?void 0:M.length)||e.viewersCount||0,o=((_=e.owner)==null?void 0:_.userName)||((A=(Y=e.owner)==null?void 0:Y.firstName)==null?void 0:A.trim())||"Host",c=(L=e.owner)!=null&&L.profilePhoto&&e.owner.profilePhoto.trim()?e.owner.profilePhoto:"",T=((R=e.owner)==null?void 0:R._id)||((z=e.owner)==null?void 0:z.id)||"",$=((O=e.shipping_settings)==null?void 0:O.freePickupEnabled)===!0,re=((B=e.shipping_settings)==null?void 0:B.shippingCostMode)==="buyer_pays_up_to",C=s===T,y=((W=e.invitedhostIds)==null?void 0:W.includes(s))||!1,S=((Z=e.invitedhostIds)==null?void 0:Z.length)||0,u=e.date?typeof e.date=="string"?xe(e.date):e.date:null,I=e.started===!0,p=I,P=u?pe(u):!1,U=!I&&P,N=!u||P?null:ue(u)?`Today, ${w(u,"h:mm a")}`:me(u)?`Tomorrow, ${w(u,"h:mm a")}`:w(u,"MMM d, h:mm a"),F=async f=>{f.preventDefault(),f.stopPropagation();try{const m=e.invitedhostIds||[],x=m.includes(s),v=x?m.filter(ne=>ne!==s):[...m,s];(await fetch(`/api/rooms/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({invitedhostIds:v})})).ok&&(l({title:x?"Notification Removed":"Notification Set",description:x?"You won't be notified about this show":"We'll notify you when the show starts!"}),le.invalidateQueries({queryKey:["/api/rooms"]}))}catch{l({title:"Error",description:"Failed to update notification.",variant:"destructive"})}},ie=()=>{var x,v;const f=((x=e.owner)==null?void 0:x.firstName)||"",m=((v=e.owner)==null?void 0:v.lastName)||"";return f&&m?`${f.charAt(0)}${m.charAt(0)}`.toUpperCase():o.charAt(0).toUpperCase()},g=a||(typeof e.category=="object"&&e.category?e.category.name:e.category);return r==="profile"?t.jsxs("div",{className:"group cursor-pointer","data-testid":`show-${n}`,children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 px-0.5",children:[t.jsxs(q,{className:"h-5 w-5 flex-shrink-0",children:[t.jsx(J,{src:c}),t.jsx(G,{className:"text-xs",children:ie()})]}),t.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[t.jsx("span",{className:"text-xs font-medium text-foreground truncate",children:o}),((E=e.owner)==null?void 0:E.badgeTier)&&t.jsx(Ue,{badgeTier:e.owner.badgeTier,size:12,showText:!1})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx(k,{href:`/show/${n}`,children:t.jsxs("div",{className:"relative aspect-[3/4] bg-gray-800 rounded-lg overflow-hidden mb-2",children:[e.preview_videos?t.jsx("video",{src:e.preview_videos,className:"absolute inset-0 w-full h-full object-cover",autoPlay:!0,loop:!0,muted:!0,playsInline:!0}):e.thumbnail?t.jsx("img",{src:e.thumbnail,alt:e.title,className:"absolute inset-0 w-full h-full object-cover"}):t.jsx(ee,{}),t.jsxs("div",{className:"absolute top-1.5 left-1.5 flex flex-col gap-1",children:[p&&t.jsxs("div",{className:"bg-red-600 text-white text-xs px-2 py-0.5 font-bold rounded flex items-center gap-1","data-testid":`badge-live-${n}`,children:["Live - ",d]}),!p&&N&&t.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black text-xs px-2 py-0.5 rounded font-medium","data-testid":`badge-date-${n}`,children:N})]})]})}),t.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 z-10",children:[!p&&d>0&&t.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black text-xs px-1.5 py-0.5 rounded font-semibold","data-testid":`badge-viewers-${n}`,children:d}),s&&!C&&t.jsx("button",{className:"bg-white/90 backdrop-blur-sm text-black rounded p-1 hover:bg-white transition-colors","data-testid":`button-bookmark-${n}`,onClick:F,children:t.jsx(V,{className:b("h-3.5 w-3.5",y&&"fill-current")})})]})]}),t.jsxs("div",{className:"space-y-1 px-0.5",children:[t.jsx("p",{className:"text-sm font-medium line-clamp-2 leading-snug text-foreground","data-testid":`show-title-${n}`,children:e.title||"Untitled Show"}),g&&t.jsx("p",{className:"text-xs text-muted-foreground truncate",children:g})]})]}):t.jsx("div",{className:"group cursor-pointer","data-testid":`card-giveaway-${n}`,children:t.jsxs("div",{className:"space-y-1.5",children:[i&&t.jsxs(k,{href:`/profile/${T}`,className:"flex items-center gap-1.5 px-0.5 group/host","data-testid":`link-host-${n}`,children:[t.jsxs(q,{className:"h-6 w-6 flex-shrink-0","data-testid":`avatar-${n}`,children:[t.jsx(J,{src:c}),t.jsx(G,{className:"text-xs",children:o.charAt(0).toUpperCase()})]}),t.jsx("span",{className:"text-xs font-medium text-foreground truncate group-hover/host:underline",children:o}),(((H=e.owner)==null?void 0:H.badge)||((Q=e.owner)==null?void 0:Q.badgeTier))&&t.jsx(de,{badge:e.owner.badge,badgeTier:e.owner.badgeTier,size:"sm"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(k,{href:`/show/${n}`,"data-testid":`link-giveaway-${n}`,children:t.jsxs("div",{className:"relative aspect-[3/4] rounded-sm overflow-hidden bg-gray-800",children:[e.preview_videos?t.jsx("video",{src:e.preview_videos,className:"absolute inset-0 w-full h-full object-cover",autoPlay:!0,loop:!0,muted:!0,playsInline:!0}):e.thumbnail||e.coverImage?t.jsx("img",{src:e.thumbnail||e.coverImage,alt:e.title,className:"absolute inset-0 w-full h-full object-cover"}):t.jsx(ee,{}),t.jsxs("div",{className:"absolute top-1.5 left-1.5 flex flex-col gap-1",children:[p&&t.jsxs("div",{className:"bg-red-600 text-white px-2 py-0.5 text-xs font-bold rounded flex items-center gap-1.5 shadow-lg","data-testid":`badge-live-${n}`,children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),"LIVE",t.jsx("span",{className:"font-semibold",children:d})]}),U&&!p&&t.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black px-2 py-0.5 text-xs rounded","data-testid":`badge-starting-soon-${n}`,children:"Starting Soon"}),N&&!p&&!U&&t.jsx("div",{className:"bg-white/90 backdrop-blur-sm text-black px-2 py-0.5 text-xs rounded","data-testid":`badge-date-${n}`,children:N}),$&&t.jsx("div",{className:"bg-green-600 text-white font-semibold px-2 py-0.5 text-xs rounded","data-testid":`badge-free-shipping-${n}`,children:"Free shipping"}),!$&&re&&t.jsx("div",{className:"bg-blue-600 text-white font-semibold px-2 py-0.5 text-xs rounded","data-testid":`badge-reduced-shipping-${n}`,children:"Reduced shipping"})]}),e.explicit_content&&t.jsx("div",{className:"absolute bottom-1.5 left-1.5",children:t.jsx("div",{className:"bg-orange-600 text-white font-semibold px-2 py-0.5 text-xs rounded","data-testid":`badge-explicit-content-${n}`,children:"Explicit Content"})}),t.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"})]})}),s&&!C&&t.jsx("div",{className:"absolute top-1.5 right-1.5 z-10",children:t.jsxs("button",{className:b("font-semibold px-2 py-0.5 text-xs rounded-full flex items-center gap-1 cursor-pointer hover:opacity-90 transition-opacity",y?"bg-primary text-primary-foreground":"bg-white text-black"),"data-testid":`badge-bookmarks-${n}`,onClick:F,children:[t.jsx(V,{className:b("h-3 w-3",y&&"fill-current")}),S>0&&S]})})]}),t.jsxs("div",{className:"space-y-0.5 px-0.5",children:[t.jsx("h3",{className:"text-sm font-medium line-clamp-2 leading-snug text-foreground",children:e.title}),t.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[g&&t.jsx("span",{className:"text-primary font-medium",children:g}),e.description&&g&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-muted-foreground",children:"â€¢"}),t.jsx("span",{className:"text-muted-foreground line-clamp-1",children:e.description})]})]})]})]})})}export{Ue as B,Oe as S};
