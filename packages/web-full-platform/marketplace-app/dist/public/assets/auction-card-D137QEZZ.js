import{r as E,f as Z,a as ee,j as e,d as te,L as se,B as re}from"./index-FVTY5sKH.js";import{C as ae,b as ne}from"./card-CF4CqaN2.js";import{B as f}from"./badge-BTf7a5Ku.js";import{P as ie}from"./package-dXPzRBiL.js";import{C as T}from"./clock-BQ-aHkQg.js";import{C as de}from"./circle-check-big-btKq8keq.js";function he({auction:t,layout:A="grid"}){var k,_,D;const[u,i]=E.useState(0),[P,V]=E.useState(!1);Z();const{user:g}=ee(),r=t.auction||t,p=t._id||t.id,C=t.images||t.productImages||[],S=C.length>0?C[0]:"",M=t.name||"Untitled Auction",z=((k=r.bids)==null?void 0:k.length)||((_=t.bids)==null?void 0:_.length)||0,s=t.ownerId||t.userId||t.seller||t.user,U=(s==null?void 0:s.firstName)||(s==null?void 0:s.userName)||(s==null?void 0:s.username)||"Seller",q=(s==null?void 0:s.isVerified)||(s==null?void 0:s.verified)||!1,F=(g==null?void 0:g.id)||"";(D=t.favorited)!=null&&D.includes(F);const N=r.start_time_date,j=r.end_time_date,o=N&&N>0?N:null,l=j&&j>0?j:null,x=r.duration||t.duration||0,d=r.startedTime||r.started_time||t.startedTime||t.started_time,b=r.started||t.started||!1,h=r.ended||t.ended||!1,R=(r.bids||t.bids||[]).reduce((n,c)=>Math.max(n,Number(c.amount)||0),0)||0,G=Number(R||r.newbaseprice||r.baseprice||r.startingPrice||t.newbaseprice||t.baseprice||t.startingPrice||t.price||0);E.useEffect(()=>{if(h){i(0);return}const n=()=>{const a=Date.now();if(o&&l){const w=o,L=l;if(a<w){const y=Math.floor((w-a)/1e3);i(y);return}if(a>=w&&a<L){const y=Math.floor((L-a)/1e3);i(y);return}i(0);return}if(!b||!d||d===0){i(x*60);return}if(!x){i(0);return}const m=typeof d=="string"?new Date(d).getTime():d;if(isNaN(m)){i(0);return}const X=m+x*60*1e3,Y=Math.max(0,Math.floor((X-a)/1e3));i(Y)};n();const c=setInterval(n,1e3);return()=>clearInterval(c)},[x,d,b,h,o,l]);const B=n=>{if(n===0)return"Ended";const c=Math.floor(n/3600),a=Math.floor(n%3600/60),m=n%60;return c>0?`${c}h ${a}m`:a>0?`${a}m ${m}s`:`${m}s`},I=Date.now(),H=o||0,J=l||0,v=!!(o&&l),K=v&&I<H,O=!v&&!b&&!h,Q=u>0&&u<=60,$=h||v&&I>=J,W=A==="carousel"?"hover-elevate active-elevate-2 overflow-hidden flex-shrink-0 w-52 sm:w-60":"hover-elevate active-elevate-2 overflow-hidden w-full min-w-0";return e.jsxs(ae,{className:W,"data-testid":`card-auction-${p}`,children:[e.jsxs("div",{className:"relative aspect-square bg-muted",children:[!P&&S?e.jsx("img",{src:S,alt:M,className:"absolute inset-0 w-full h-full object-cover",loading:"lazy",onError:()=>V(!0)}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ie,{className:"h-16 w-16 text-muted-foreground/40"})}),$&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:e.jsx(f,{variant:"destructive",className:"text-sm",children:"Ended"})}),!$&&e.jsx("div",{className:"absolute top-2 left-2",children:K?e.jsxs(f,{className:"bg-primary text-primary-foreground flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),"Starts in ",B(u)]}):O?e.jsxs(f,{className:"bg-primary text-primary-foreground flex items-center gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),"Not Started"]}):e.jsxs(f,{className:te("bg-primary text-primary-foreground flex items-center gap-1",Q&&"animate-pulse"),children:[e.jsx(T,{className:"h-3 w-3"}),"Ends in ",B(u)]})})]}),e.jsxs(ne,{className:"p-3 space-y-2",children:[e.jsx("h3",{className:"text-sm font-semibold line-clamp-2",children:M}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["By ",U]}),q&&e.jsx(de,{className:"h-3 w-3 text-primary"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsxs("span",{className:"font-bold text-primary",children:["$",G.toFixed(0)]}),e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsxs("span",{className:"text-muted-foreground",children:[z," bids"]})]}),e.jsx(f,{variant:"secondary",className:"text-xs",children:"Auction"})]}),e.jsx(se,{href:`/auction/${p}`,"data-testid":`link-auction-${p}`,children:e.jsx(re,{variant:"outline",size:"sm",className:"w-full",children:"View"})})]})]})}export{he as A};
