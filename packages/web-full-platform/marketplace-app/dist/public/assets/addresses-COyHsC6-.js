import{r as o,a as se,g as ae,a1 as ie,d as ne,j as t,B as v,A as de,a3 as oe,h as re,i as le,k as ce,l as ue,m as me,n as pe,o as he,y as N}from"./index-GnvmivW0.js";import{u as M}from"./useMutation-DAKVWGzI.js";import{w as xe,N as ye,y as je,f as fe,h as ge,p as Ce}from"./react-country-state-city-4XimWX2C.js";import{C as F,a as Q,b as I,c as ve}from"./card-Bsqf9o7h.js";import{I as $}from"./input-CDJz7BeV.js";import{L as h}from"./label-CbaFYhHW.js";import{D as Ne,a as Se,b as we,c as be,d as De}from"./dialog-D1L4tMGI.js";import{D as Ae,a as Ee,b as Pe,c as q}from"./dropdown-menu-B2qYf86A.js";import{B as Me}from"./badge-CL9MXKGS.js";import{P as K}from"./plus-CxBznHFO.js";import{M as Fe}from"./map-pin-Dn0fBe7g.js";import{S as Ie}from"./star-Dvv0yNqt.js";import{E as $e}from"./ellipsis-vertical-CJSSwQPi.js";import"./index-CmYyiKyk.js";import"./index-kVvGtud3.js";import"./chevron-right-CXw-mF7y.js";import"./check-DoxmrmEj.js";import"./circle-iUglX5Df.js";function Xe(){const[R,x]=o.useState(!1),[i,S]=o.useState(null),[H,B]=o.useState(!1),[u,T]=o.useState(0),[j,w]=o.useState(0),[b,f]=o.useState(0),[m,z]=o.useState(null),[p,D]=o.useState(null),[A,g]=o.useState(null);o.useEffect(()=>{H&&(console.log("ğŸŸ¢ IDs ready:",{countryid:u,stateid:j,cityid:b}),B(!1))},[H,u,j,b]);const[d,y]=o.useState({name:"",addrress1:"",addrress2:"",city:"",state:"",zipcode:"",countryCode:"US",country:"United States",phone:"",email:"",userId:""}),{user:s}=se(),{toast:r}=ae(),E=ie(),{data:L=[],isLoading:V,error:G}=ne({queryKey:["addresses",s==null?void 0:s.id],queryFn:async()=>{const e=await N("GET",`/api/address/all/${s==null?void 0:s.id}`);if(!e.ok)throw new Error("Failed to fetch addresses");return e.json()},enabled:!!(s!=null&&s.id)}),k=M({mutationFn:async e=>(await N("POST","/api/address",{...e,userId:s==null?void 0:s.id})).json(),onSuccess:()=>{E.invalidateQueries({queryKey:["addresses"]}),x(!1),P(),r({title:"Success",description:"Address created successfully"})},onError:e=>{const a=(e==null?void 0:e.message)||"Failed to create address";r({title:"Error",description:a,variant:"destructive"})}}),U=M({mutationFn:async({id:e,...a})=>(await N("PUT",`/api/address/${e}`,a)).json(),onSuccess:()=>{E.invalidateQueries({queryKey:["addresses"]}),x(!1),S(null),P(),r({title:"Success",description:"Address updated successfully"})},onError:e=>{const a=(e==null?void 0:e.message)||"Failed to update address";r({title:"Error",description:a,variant:"destructive"})}}),Z=M({mutationFn:async e=>(await N("DELETE",`/api/address/${e}`)).json(),onSuccess:()=>{E.invalidateQueries({queryKey:["addresses"]}),r({title:"Success",description:"Address deleted successfully"})},onError:e=>{const a=(e==null?void 0:e.message)||"Failed to delete address";r({title:"Error",description:a,variant:"destructive"})}}),J=M({mutationFn:async({id:e,primary:a,userId:n})=>{const l=await N("PUT",`/api/address/primary/${e}`,{primary:a,userId:n});if(!l.ok)throw new Error("Failed to update address primary status");return l.json()},onSuccess:()=>{E.invalidateQueries({queryKey:["addresses"]}),r({title:"Success",description:"Primary address updated successfully"})},onError:e=>{const a=(e==null?void 0:e.message)||"Failed to update primary address";r({title:"Error",description:a,variant:"destructive"})}}),P=()=>{y({name:"",addrress1:"",addrress2:"",city:"",state:"",zipcode:"",countryCode:"US",country:"United States",phone:"",email:"",userId:""}),T(0),w(0),f(0),z(null),D(null),g(null)},O=()=>{P(),S(null),x(!0)},W=async e=>{console.log("ğŸ”µ handleEdit called for address:",e),y({name:e.name||"",addrress1:e.addrress1||"",addrress2:e.addrress2||"",city:e.city||"",state:e.state||"",zipcode:e.zipcode||e.zip||"",countryCode:e.countryCode||"US",country:e.country||"United States",phone:e.phone||"",email:e.email||"",userId:(s==null?void 0:s.id)||""}),S(e),x(!0);try{console.log("API data:",{country:e.country,countryCode:e.countryCode,state:e.state,stateCode:e.stateCode,city:e.city});const n=(await fe()).find(l=>l.iso2===e.countryCode||l.name===e.country);if(n){console.log("âœ… Matched country:",{id:n.id,name:n.name,iso2:n.iso2}),T(n.id),z(n);const c=(await ge(n.id)).find(_=>_.state_code===e.stateCode||_.name===e.state);if(c){console.log("âœ… Matched state:",{id:c.id,name:c.name,state_code:c.state_code}),w(c.id),D(c);const C=(await Ce(n.id,c.id)).find(te=>te.name===e.city);C?(console.log("âœ… Matched city:",{id:C.id,name:C.name}),f(C.id),g(C)):console.log("âŒ City not found:",e.city)}else console.log("âŒ State not found:",e.state,e.stateCode)}else console.log("âŒ Country not found:",e.country,e.countryCode)}catch(a){console.error("Error looking up location data:",a)}},X=e=>{if(e.preventDefault(),!m||!p||!A){r({title:"Missing Information",description:"Please select country, state, and city from the dropdowns.",variant:"destructive"});return}const a=`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||(s==null?void 0:s.userName)||(s==null?void 0:s.email)||"",n=(s==null?void 0:s.email)||"",l={...d,name:a,email:n,country:(m==null?void 0:m.name)||d.country,countryCode:(m==null?void 0:m.iso2)||d.countryCode,state:(p==null?void 0:p.name)||d.state,stateCode:(p==null?void 0:p.state_code)||(i==null?void 0:i.stateCode)||"",city:(A==null?void 0:A.name)||d.city,cityCode:(i==null?void 0:i.cityCode)||""};if(i){const c=i.id||i._id;U.mutate({...l,id:c})}else k.mutate(l)},Y=e=>{const a=e.id||e._id;Z.mutate(a)},ee=(e,a)=>{const n=e.id||e._id;J.mutate({id:n,primary:!a,userId:(s==null?void 0:s.id)||""})};return t.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Addresses"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your shipping and billing addresses"})]}),t.jsxs(v,{onClick:O,className:"w-full sm:w-auto","data-testid":"button-add-address",children:[t.jsx(K,{className:"mr-2 h-4 w-4"}),"Add Address"]})]}),V?t.jsx("div",{className:"grid gap-4",children:[1,2].map(e=>t.jsxs(F,{className:"animate-pulse",children:[t.jsx(Q,{className:"h-20 bg-muted"}),t.jsx(I,{className:"h-32 bg-muted/50"})]},e))}):G?t.jsx(F,{children:t.jsx(I,{className:"p-6 text-center text-destructive",children:"Failed to load addresses. Please try again."})}):L.length===0?t.jsx(F,{children:t.jsxs(I,{className:"p-12 text-center",children:[t.jsx(Fe,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No addresses yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Add your first address to get started"}),t.jsxs(v,{onClick:O,"data-testid":"button-add-first-address",children:[t.jsx(K,{className:"mr-2 h-4 w-4"}),"Add Address"]})]})}):t.jsx("div",{className:"grid gap-4",children:L.map(e=>{const a=e.id||e._id;return t.jsxs(F,{"data-testid":`card-address-${a}`,children:[t.jsxs(Q,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[t.jsx("div",{className:"flex items-start gap-2 flex-1",children:t.jsx("div",{className:"flex-1",children:t.jsxs(ve,{className:"text-lg flex items-center gap-2",children:[e.name,e.primary&&t.jsxs(Me,{variant:"default",className:"text-xs",children:[t.jsx(Ie,{className:"mr-1 h-3 w-3"}),"Primary"]})]})})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(Ae,{children:[t.jsx(Ee,{asChild:!0,children:t.jsx(v,{variant:"ghost",size:"icon","data-testid":`button-menu-${a}`,children:t.jsx($e,{className:"h-4 w-4"})})}),t.jsxs(Pe,{align:"end",children:[t.jsx(q,{onClick:()=>W(e),"data-testid":`button-edit-${a}`,children:"Edit"}),t.jsx(q,{onClick:()=>ee(e,e.primary||!1),"data-testid":`button-toggle-primary-${a}`,children:e.primary?"Remove as Primary":"Set as Primary"}),t.jsxs(de,{children:[t.jsx(oe,{asChild:!0,children:t.jsx(q,{onSelect:n=>n.preventDefault(),className:"text-destructive","data-testid":`button-delete-${a}`,children:"Delete"})}),t.jsxs(re,{children:[t.jsxs(le,{children:[t.jsx(ce,{children:"Delete Address"}),t.jsx(ue,{children:"Are you sure you want to delete this address? This action cannot be undone."})]}),t.jsxs(me,{children:[t.jsx(pe,{children:"Cancel"}),t.jsx(he,{onClick:()=>Y(e),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})]}),t.jsx(I,{children:t.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[t.jsx("div",{children:e.addrress1}),e.addrress2&&t.jsx("div",{children:e.addrress2}),t.jsxs("div",{children:[e.city,", ",e.state," ",e.zipcode]}),t.jsx("div",{children:e.country}),e.phone&&t.jsxs("div",{children:["Phone: ",e.phone]}),e.email&&t.jsxs("div",{children:["Email: ",e.email]})]})})]},a)})}),t.jsx(Ne,{open:R,onOpenChange:e=>{e||(x(!1),S(null),P())},children:t.jsxs(Se,{className:"max-w-lg max-h-[80vh] overflow-y-auto",children:[t.jsxs(we,{children:[t.jsx(be,{children:i?"Edit Address":"Add New Address"}),t.jsx(De,{children:i?"Update the address details below.":"Add a new shipping or billing address."})]}),t.jsxs("form",{onSubmit:X,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(h,{htmlFor:"addrress1",children:"Street Address"}),t.jsx($,{id:"addrress1",value:d.addrress1,onChange:e=>y({...d,addrress1:e.target.value}),placeholder:"123 Main Street",required:!0,"data-testid":"input-address-street1"})]}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"addrress2",children:"Street Address 2 (Optional)"}),t.jsx($,{id:"addrress2",value:d.addrress2,onChange:e=>y({...d,addrress2:e.target.value}),placeholder:"Apt, Suite, Unit, etc.","data-testid":"input-address-street2"})]}),(!i||i&&u>0)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Country"}),t.jsx(xe,{defaultValue:u,onChange:e=>{T(e.id),z(e),w(0),f(0),D(null),g(null)},placeHolder:"Select Country",containerClassName:"w-full",inputClassName:"w-full"},`country-${u}-${(i==null?void 0:i._id)||"new"}`)]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"State/Province"}),t.jsx(ye,{countryid:u,defaultValue:j,onChange:e=>{w(e.id),D(e),f(0),g(null)},placeHolder:"Select State",containerClassName:"w-full",inputClassName:"w-full"},`state-${j}-${(i==null?void 0:i._id)||"new"}`)]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"City"}),t.jsx(je,{countryid:u,stateid:j,defaultValue:b,onChange:e=>{f(e.id),g(e)},placeHolder:"Select City",containerClassName:"w-full",inputClassName:"w-full"},`city-${b}-${(i==null?void 0:i._id)||"new"}`)]})]})]}),i&&u===0&&t.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading location data..."}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"zipcode",children:"ZIP / Postal Code"}),t.jsx($,{id:"zipcode",value:d.zipcode,onChange:e=>y({...d,zipcode:e.target.value}),placeholder:"12345",required:!0,"data-testid":"input-address-zipcode"})]}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"phone",children:"Phone (Optional)"}),t.jsx($,{id:"phone",type:"tel",value:d.phone,onChange:e=>y({...d,phone:e.target.value}),placeholder:"+1 (555) 123-4567","data-testid":"input-address-phone"})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[t.jsx(v,{type:"button",variant:"outline",onClick:()=>x(!1),"data-testid":"button-cancel-address",children:"Cancel"}),t.jsx(v,{type:"submit",disabled:k.isPending||U.isPending,"data-testid":"button-save-address",children:k.isPending||U.isPending?"Saving...":i?"Update Address":"Add Address"})]})]})]})})]})}export{Xe as default};
