import{p as P,u as N,a as w,g as T,d as I,j as t,B as m,x as E,q as f}from"./index-GnvmivW0.js";import{u as C}from"./useMutation-DAKVWGzI.js";import{I as k}from"./inventory-product-form-CIDJRsRI.js";import{A as b}from"./arrow-left-CUbNyMTb.js";import"./form-CgNvNzQO.js";import"./label-CbaFYhHW.js";import"./card-Bsqf9o7h.js";import"./input-CDJz7BeV.js";import"./textarea-DkmXbh6O.js";import"./select-EUq1_viI.js";import"./index-BdQq_4o_.js";import"./index-CmYyiKyk.js";import"./index-Vue-pIA6.js";import"./chevron-down-tcDKR_mK.js";import"./check-DoxmrmEj.js";import"./chevron-up-Cda9uppk.js";import"./badge-CL9MXKGS.js";import"./scroll-area-FQ9vYp1R.js";import"./switch-C_scnTkE.js";import"./dialog-D1L4tMGI.js";import"./radio-group-CiS8qgSW.js";import"./index-kVvGtud3.js";import"./circle-iUglX5Df.js";import"./image-Hw4wFcaj.js";import"./upload-DciL_rQf.js";import"./search-DE1AZ4db.js";import"./save-Xig5-s-l.js";function ot(){const[,d]=P("/edit-product/:id"),[,n]=N(),{user:o}=w(),{toast:u}=T(),i=d==null?void 0:d.id,{data:s,isLoading:g,isError:y}=I({queryKey:["external-product",i],queryFn:async()=>{if(!i)throw new Error("Product ID required");const e=await fetch(`/api/products/${i}?userId=${o==null?void 0:o.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch product: ${e.status}`);return e.json()},enabled:!!i}),x=C({mutationFn:async e=>{var h;if(!i)throw new Error("Product ID required");const v=e.listingType==="giveaway";let c,l;v?(c=`/api/giveaways/${i}`,l="PUT"):(c=o!=null&&o.admin?`/api/admin/products/${i}`:`/api/products/${i}`,l="PATCH");const a=e.shipping_profile||e.shippingProfile;console.log("ðŸ“¦ EDIT PRODUCT - productData.shipping_profile:",e.shipping_profile),console.log("ðŸ“¦ EDIT PRODUCT - productData.shippingProfile:",e.shippingProfile),console.log("ðŸ“¦ EDIT PRODUCT - Using value:",a);const r={...e,shippingProfile:a!=null&&a.trim()?a:void 0,tokshow:e.tokshow&&e.tokshow!=="no-show"?e.tokshow:null,userId:o==null?void 0:o.id};console.log("ðŸ“¦ EDIT PRODUCT - payload.shippingProfile:",r.shippingProfile),console.log("ðŸ“¦ EDIT PRODUCT - Full payload:",JSON.stringify(r,null,2)),e.listingType==="auction"&&(e.startingPrice!==void 0&&(r.price=e.startingPrice,r.startingPrice=e.startingPrice),(h=s==null?void 0:s.auction)!=null&&h._id&&(r.auction=s.auction._id));const p=await fetch(c,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!p.ok){const j=await p.json();throw new Error(j.message||"Failed to update product")}return p.json()},onSuccess:()=>{f.invalidateQueries({queryKey:["external-products"]}),f.invalidateQueries({queryKey:["external-product",i]}),u({title:"Product Updated",description:"Your product has been updated successfully."}),n("/inventory")},onError:e=>{u({title:"Failed to Update Product",description:e.message,variant:"destructive"})}});return i?g?t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"flex items-center justify-center min-h-96",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx(E,{className:"h-8 w-8 animate-spin mx-auto"}),t.jsx("p",{className:"text-muted-foreground",children:"Loading product..."})]})})}):y||!s?t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Product Not Found"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"The product you're trying to edit doesn't exist."}),t.jsx(m,{onClick:()=>n("/inventory"),className:"mt-4",children:"Back to Inventory"})]})}):t.jsxs("div",{className:"space-y-6","data-testid":"page-edit-product",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs(m,{variant:"outline",onClick:()=>n("/inventory"),"data-testid":"button-back-to-inventory",className:"w-full sm:w-auto",children:[t.jsx(b,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"sm:inline",children:"Back to Inventory"})]}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground","data-testid":"text-page-title",children:"Edit Product"}),t.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground","data-testid":"text-page-description",children:["Update product information: ",s.name]})]})]}),t.jsx(k,{mode:"edit",product:s,onSubmit:e=>x.mutate(e),onCancel:()=>n("/inventory"),isPending:x.isPending})]}):t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Invalid Product ID"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"No product ID provided."}),t.jsx(m,{onClick:()=>n("/inventory"),className:"mt-4",children:"Back to Inventory"})]})})}export{ot as default};
