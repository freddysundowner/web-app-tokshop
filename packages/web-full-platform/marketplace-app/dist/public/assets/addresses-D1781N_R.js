import{r as o,a as se,f as ae,x as ie,j as t,B as v,A as ne,y as re,z as oe,C as de,D as le,E as ce,F as ue,G as me,H as pe,l as h,I as F,n as N}from"./index-FVTY5sKH.js";import{u as he}from"./useQuery-DsZx8GVA.js";import{u as I}from"./useMutation-DKG1zDtN.js";import{w as xe,N as ye,y as je,f as fe,h as ge,p as Ce}from"./react-country-state-city-DuU_Cl-F.js";import{C as M,a as K,b as $,d as ve}from"./card-CF4CqaN2.js";import{D as Ne,a as Se,b as we,c as be,d as De}from"./dialog-A2pFZcsY.js";import{D as Ee,a as Ae,b as Pe,c as q}from"./dropdown-menu-BrJ5tGq0.js";import{B as Fe}from"./badge-BTf7a5Ku.js";import{P as L}from"./plus-CFqimBvi.js";import{M as Ie}from"./map-pin-jcALPDnh.js";import{S as Me}from"./star-E1-v1kNw.js";import{E as $e}from"./ellipsis-vertical-YsH48IHQ.js";import"./index-BaZiuLT8.js";import"./index-CoWBA0E_.js";import"./chevron-right-HRo85rGP.js";import"./check-DWjWNqF1.js";import"./circle-tm_CQXKA.js";function We(){const[R,x]=o.useState(!1),[a,S]=o.useState(null),[H,B]=o.useState(!1),[u,T]=o.useState(0),[j,w]=o.useState(0),[b,f]=o.useState(0),[m,z]=o.useState(null),[p,D]=o.useState(null),[E,g]=o.useState(null);o.useEffect(()=>{H&&(console.log("ğŸŸ¢ IDs ready:",{countryid:u,stateid:j,cityid:b}),B(!1))},[H,u,j,b]);const[r,y]=o.useState({name:"",addrress1:"",addrress2:"",city:"",state:"",zipcode:"",countryCode:"US",country:"United States",phone:"",email:"",userId:""}),{user:s}=se(),{toast:d}=ae(),A=ie(),{data:O=[],isLoading:V,error:G}=he({queryKey:["addresses",s==null?void 0:s.id],queryFn:async()=>{const e=await N("GET",`/api/address/all/${s==null?void 0:s.id}`);if(!e.ok)throw new Error("Failed to fetch addresses");return e.json()},enabled:!!(s!=null&&s.id)}),U=I({mutationFn:async e=>(await N("POST","/api/address",{...e,userId:s==null?void 0:s.id})).json(),onSuccess:()=>{A.invalidateQueries({queryKey:["addresses"]}),x(!1),P(),d({title:"Success",description:"Address created successfully"})},onError:e=>{d({title:"Error",description:"Failed to create address",variant:"destructive"})}}),_=I({mutationFn:async({id:e,...i})=>(await N("PUT",`/api/address/${e}`,i)).json(),onSuccess:()=>{A.invalidateQueries({queryKey:["addresses"]}),x(!1),S(null),P(),d({title:"Success",description:"Address updated successfully"})},onError:e=>{d({title:"Error",description:"Failed to update address",variant:"destructive"})}}),Z=I({mutationFn:async e=>(await N("DELETE",`/api/address/${e}`)).json(),onSuccess:()=>{A.invalidateQueries({queryKey:["addresses"]}),d({title:"Success",description:"Address deleted successfully"})},onError:e=>{d({title:"Error",description:"Failed to delete address",variant:"destructive"})}}),J=I({mutationFn:async({id:e,primary:i,userId:n})=>{const l=await N("PUT",`/api/address/primary/${e}`,{primary:i,userId:n});if(!l.ok)throw new Error("Failed to update address primary status");return l.json()},onSuccess:()=>{A.invalidateQueries({queryKey:["addresses"]}),d({title:"Success",description:"Primary address updated successfully"})},onError:e=>{d({title:"Error",description:"Failed to update primary address",variant:"destructive"})}}),P=()=>{y({name:"",addrress1:"",addrress2:"",city:"",state:"",zipcode:"",countryCode:"US",country:"United States",phone:"",email:"",userId:""}),T(0),w(0),f(0),z(null),D(null),g(null)},Q=()=>{P(),S(null),x(!0)},W=async e=>{console.log("ğŸ”µ handleEdit called for address:",e),y({name:e.name||"",addrress1:e.addrress1||"",addrress2:e.addrress2||"",city:e.city||"",state:e.state||"",zipcode:e.zipcode||e.zip||"",countryCode:e.countryCode||"US",country:e.country||"United States",phone:e.phone||"",email:e.email||"",userId:(s==null?void 0:s.id)||""}),S(e),x(!0);try{console.log("API data:",{country:e.country,countryCode:e.countryCode,state:e.state,stateCode:e.stateCode,city:e.city});const n=(await fe()).find(l=>l.iso2===e.countryCode||l.name===e.country);if(n){console.log("âœ… Matched country:",{id:n.id,name:n.name,iso2:n.iso2}),T(n.id),z(n);const c=(await ge(n.id)).find(k=>k.state_code===e.stateCode||k.name===e.state);if(c){console.log("âœ… Matched state:",{id:c.id,name:c.name,state_code:c.state_code}),w(c.id),D(c);const C=(await Ce(n.id,c.id)).find(te=>te.name===e.city);C?(console.log("âœ… Matched city:",{id:C.id,name:C.name}),f(C.id),g(C)):console.log("âŒ City not found:",e.city)}else console.log("âŒ State not found:",e.state,e.stateCode)}else console.log("âŒ Country not found:",e.country,e.countryCode)}catch(i){console.error("Error looking up location data:",i)}},X=e=>{if(e.preventDefault(),!m||!p||!E){d({title:"Missing Information",description:"Please select country, state, and city from the dropdowns.",variant:"destructive"});return}const i=`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||(s==null?void 0:s.userName)||(s==null?void 0:s.email)||"",n=(s==null?void 0:s.email)||"",l={...r,name:i,email:n,country:(m==null?void 0:m.name)||r.country,countryCode:(m==null?void 0:m.iso2)||r.countryCode,state:(p==null?void 0:p.name)||r.state,stateCode:(p==null?void 0:p.state_code)||(a==null?void 0:a.stateCode)||"",city:(E==null?void 0:E.name)||r.city,cityCode:(a==null?void 0:a.cityCode)||""};if(a){const c=a.id||a._id;_.mutate({...l,id:c})}else U.mutate(l)},Y=e=>{const i=e.id||e._id;Z.mutate(i)},ee=(e,i)=>{const n=e.id||e._id;J.mutate({id:n,primary:!i,userId:(s==null?void 0:s.id)||""})};return t.jsxs("div",{className:"w-full p-4 sm:p-6 space-y-4 sm:space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Addresses"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your shipping and billing addresses"})]}),t.jsxs(v,{onClick:Q,className:"w-full sm:w-auto","data-testid":"button-add-address",children:[t.jsx(L,{className:"mr-2 h-4 w-4"}),"Add Address"]})]}),V?t.jsx("div",{className:"grid gap-4",children:[1,2].map(e=>t.jsxs(M,{className:"animate-pulse",children:[t.jsx(K,{className:"h-20 bg-muted"}),t.jsx($,{className:"h-32 bg-muted/50"})]},e))}):G?t.jsx(M,{children:t.jsx($,{className:"p-6 text-center text-destructive",children:"Failed to load addresses. Please try again."})}):O.length===0?t.jsx(M,{children:t.jsxs($,{className:"p-12 text-center",children:[t.jsx(Ie,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No addresses yet"}),t.jsx("p",{className:"text-muted-foreground mb-4",children:"Add your first address to get started"}),t.jsxs(v,{onClick:Q,"data-testid":"button-add-first-address",children:[t.jsx(L,{className:"mr-2 h-4 w-4"}),"Add Address"]})]})}):t.jsx("div",{className:"grid gap-4",children:O.map(e=>{const i=e.id||e._id;return t.jsxs(M,{"data-testid":`card-address-${i}`,children:[t.jsxs(K,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[t.jsx("div",{className:"flex items-start gap-2 flex-1",children:t.jsx("div",{className:"flex-1",children:t.jsxs(ve,{className:"text-lg flex items-center gap-2",children:[e.name,e.primary&&t.jsxs(Fe,{variant:"default",className:"text-xs",children:[t.jsx(Me,{className:"mr-1 h-3 w-3"}),"Primary"]})]})})}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs(Ee,{children:[t.jsx(Ae,{asChild:!0,children:t.jsx(v,{variant:"ghost",size:"icon","data-testid":`button-menu-${i}`,children:t.jsx($e,{className:"h-4 w-4"})})}),t.jsxs(Pe,{align:"end",children:[t.jsx(q,{onClick:()=>W(e),"data-testid":`button-edit-${i}`,children:"Edit"}),t.jsx(q,{onClick:()=>ee(e,e.primary||!1),"data-testid":`button-toggle-primary-${i}`,children:e.primary?"Remove as Primary":"Set as Primary"}),t.jsxs(ne,{children:[t.jsx(re,{asChild:!0,children:t.jsx(q,{onSelect:n=>n.preventDefault(),className:"text-destructive","data-testid":`button-delete-${i}`,children:"Delete"})}),t.jsxs(oe,{children:[t.jsxs(de,{children:[t.jsx(le,{children:"Delete Address"}),t.jsx(ce,{children:"Are you sure you want to delete this address? This action cannot be undone."})]}),t.jsxs(ue,{children:[t.jsx(me,{children:"Cancel"}),t.jsx(pe,{onClick:()=>Y(e),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})]}),t.jsx($,{children:t.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[t.jsx("div",{children:e.addrress1}),e.addrress2&&t.jsx("div",{children:e.addrress2}),t.jsxs("div",{children:[e.city,", ",e.state," ",e.zipcode]}),t.jsx("div",{children:e.country}),e.phone&&t.jsxs("div",{children:["Phone: ",e.phone]}),e.email&&t.jsxs("div",{children:["Email: ",e.email]})]})})]},i)})}),t.jsx(Ne,{open:R,onOpenChange:e=>{e||(x(!1),S(null),P())},children:t.jsxs(Se,{className:"max-w-lg max-h-[80vh] overflow-y-auto",children:[t.jsxs(we,{children:[t.jsx(be,{children:a?"Edit Address":"Add New Address"}),t.jsx(De,{children:a?"Update the address details below.":"Add a new shipping or billing address."})]}),t.jsxs("form",{onSubmit:X,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(h,{htmlFor:"addrress1",children:"Street Address"}),t.jsx(F,{id:"addrress1",value:r.addrress1,onChange:e=>y({...r,addrress1:e.target.value}),placeholder:"123 Main Street",required:!0,"data-testid":"input-address-street1"})]}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"addrress2",children:"Street Address 2 (Optional)"}),t.jsx(F,{id:"addrress2",value:r.addrress2,onChange:e=>y({...r,addrress2:e.target.value}),placeholder:"Apt, Suite, Unit, etc.","data-testid":"input-address-street2"})]}),(!a||a&&u>0)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"Country"}),t.jsx(xe,{defaultValue:u,onChange:e=>{T(e.id),z(e),w(0),f(0),D(null),g(null)},placeHolder:"Select Country",containerClassName:"w-full",inputClassName:"w-full"},`country-${u}-${(a==null?void 0:a._id)||"new"}`)]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"State/Province"}),t.jsx(ye,{countryid:u,defaultValue:j,onChange:e=>{w(e.id),D(e),f(0),g(null)},placeHolder:"Select State",containerClassName:"w-full",inputClassName:"w-full"},`state-${j}-${(a==null?void 0:a._id)||"new"}`)]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(h,{children:"City"}),t.jsx(je,{countryid:u,stateid:j,defaultValue:b,onChange:e=>{f(e.id),g(e)},placeHolder:"Select City",containerClassName:"w-full",inputClassName:"w-full"},`city-${b}-${(a==null?void 0:a._id)||"new"}`)]})]})]}),a&&u===0&&t.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading location data..."}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"zipcode",children:"ZIP / Postal Code"}),t.jsx(F,{id:"zipcode",value:r.zipcode,onChange:e=>y({...r,zipcode:e.target.value}),placeholder:"12345",required:!0,"data-testid":"input-address-zipcode"})]}),t.jsxs("div",{children:[t.jsx(h,{htmlFor:"phone",children:"Phone (Optional)"}),t.jsx(F,{id:"phone",type:"tel",value:r.phone,onChange:e=>y({...r,phone:e.target.value}),placeholder:"+1 (555) 123-4567","data-testid":"input-address-phone"})]}),t.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[t.jsx(v,{type:"button",variant:"outline",onClick:()=>x(!1),"data-testid":"button-cancel-address",children:"Cancel"}),t.jsx(v,{type:"submit",disabled:U.isPending||_.isPending,"data-testid":"button-save-address",children:U.isPending||_.isPending?"Saving...":a?"Update Address":"Add Address"})]})]})]})})]})}export{We as default};
