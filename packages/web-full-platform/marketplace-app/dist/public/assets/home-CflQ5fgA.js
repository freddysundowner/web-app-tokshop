import{a as P,b as F,j as e,d as b,L as u,r as c,D as C}from"./index-DOZKoalF.js";import{u as S}from"./useQuery-48pQeuS3.js";import{u as q,S as Y}from"./show-card-CdrjScR7.js";import{G as _}from"./globe-BcjAYEgE.js";import"./avatar-BNno7OSM.js";import"./format-D46ChU1D.js";import"./isTomorrow-BvLd__Ji.js";function M({selectedCategory:f,onCategoryChange:r,categories:n=[]}){const{user:a}=P(),{settings:l}=F(),d=(a==null?void 0:a.userName)||(a==null?void 0:a.firstName)||"User",m=new Date().getFullYear();return e.jsxs("aside",{className:"hidden lg:flex lg:flex-col w-64 bg-background border-r border-border/40 h-full flex-shrink-0","data-testid":"sidebar-marketplace",children:[e.jsx("div",{className:"px-4 pt-8 pb-6",children:e.jsxs("h2",{className:"text-[28px] leading-tight font-bold text-foreground","data-testid":"text-greeting",children:["Hello ",d,"!"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4",children:[e.jsx("button",{onClick:()=>r("For You"),className:b("text-left py-2.5 text-base transition-colors w-full",f==="For You"?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":"category-for-you",children:"For You"}),n.map(i=>e.jsx("button",{onClick:()=>r(i.name),className:b("text-left py-2.5 text-base transition-colors w-full",f===i.name?"text-primary font-normal":"text-muted-foreground font-normal"),"data-testid":`category-${i._id}`,children:i.name},i._id))]}),e.jsxs("div",{className:"px-4 pb-8 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-[13px] text-muted-foreground",children:[e.jsx(u,{href:"/privacy-policy","data-testid":"link-privacy",children:e.jsx("span",{className:"cursor-pointer",children:"Privacy"})}),e.jsx(u,{href:"/terms-of-service","data-testid":"link-terms",children:e.jsx("span",{className:"cursor-pointer",children:"Terms"})}),e.jsx(u,{href:"/contact","data-testid":"link-contact",children:e.jsx("span",{className:"cursor-pointer",children:"Contact"})}),e.jsx(u,{href:"/faq","data-testid":"link-faq",children:e.jsx("span",{className:"cursor-pointer",children:"FAQ"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[13px] text-muted-foreground pt-2",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{"data-testid":"text-language",children:"British English"})]}),e.jsxs("div",{className:"text-[13px] text-muted-foreground pt-1",children:["Â© ",m," ",l.app_name," Inc."]})]})]})}function G(){var w;const{settings:f}=F(),{user:r}=P(),[n,a]=c.useState("For You");C("Live Shows");const{data:l}=S({queryKey:["/api/categories"],queryFn:()=>fetch("/api/categories").then(t=>t.json())}),d=(l==null?void 0:l.categories)||[],m=[{id:"for-you",label:"For You",categoryId:null},...d.map(t=>({id:t._id,label:t.name,categoryId:t._id}))],i=(r==null?void 0:r._id)||(r==null?void 0:r.id),h=m.find(t=>t.label===n),{data:g,fetchNextPage:j,hasNextPage:v,isFetchingNextPage:p,isLoading:I,refetch:x}=q({queryKey:["/api/rooms",n],queryFn:async({pageParam:t=1})=>{const o=[`page=${t}`,"limit=15",`category=${(h==null?void 0:h.categoryId)||"all"}`,"userid=",`currentUserId=${i||""}`,"title=","status=active"].join("&");return(await fetch(`/api/rooms?${o}`)).json()},getNextPageParam:(t,s)=>{const o=s.length,k=t.totalDoc||0,E=Math.max(t.limits||20,1),L=Math.ceil(k/E);return o<L?o+1:void 0},initialPageParam:1});c.useEffect(()=>{const t=()=>{document.hidden||(console.log("ðŸ“± Page visible - refreshing shows..."),x())},s=()=>{console.log("ðŸ“± Window focused - refreshing shows..."),x()};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",s),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",s)}},[x]),c.useEffect(()=>{console.log("ðŸ“± Homepage mounted - refreshing shows..."),x()},[]);const y=((w=g==null?void 0:g.pages)==null?void 0:w.flatMap(t=>t.rooms||[]))||[],N=c.useRef(null);return c.useEffect(()=>{const t=new IntersectionObserver(o=>{o[0].isIntersecting&&v&&!p&&j()},{threshold:0,rootMargin:"100px"}),s=N.current;return s&&t.observe(s),()=>{s&&t.unobserve(s)}},[v,p,j]),e.jsxs("div",{className:"flex flex-col h-screen bg-background","data-testid":"page-marketplace",children:[e.jsx("div",{className:"lg:hidden bg-white dark:bg-background sticky top-0 z-10 border-b border-border/50",children:e.jsx("div",{className:"flex overflow-x-auto scrollbar-hide","data-testid":"tabs-container-mobile",children:m.map(t=>e.jsxs("button",{onClick:()=>a(t.label),className:b("px-3 py-3.5 text-sm whitespace-nowrap flex-shrink-0 relative transition-colors",n===t.label?"text-primary font-semibold":"text-foreground font-normal"),"data-testid":`tab-${t.id}`,children:[t.label,n===t.label&&e.jsx("div",{className:"absolute bottom-0 left-3 right-3 h-0.5 bg-foreground dark:bg-primary rounded-full"})]},t.id))})}),e.jsx("div",{className:"flex flex-1 overflow-hidden h-full justify-center",children:e.jsxs("div",{className:"flex w-full lg:w-[90%] h-full",children:[e.jsx(M,{selectedCategory:n,onCategoryChange:a,categories:d}),e.jsx("main",{className:"flex-1 overflow-y-auto scrollbar-hide bg-white dark:bg-background w-full h-full",children:e.jsx("div",{className:"w-full px-2 py-3 lg:p-6",children:I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading shows..."})}):y.length===0?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"No live shows at the moment"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-2 lg:gap-4","data-testid":"grid-giveaways",children:y.map(t=>e.jsx(Y,{show:t,currentUserId:i||"",variant:"grid"},t._id||t.id))}),e.jsx("div",{ref:N,className:"h-20 flex items-center justify-center",children:p&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading more shows..."})})]})})})]})})]})}export{G as default};
