import{a as K,r as d,j as e}from"./index-DOZKoalF.js";import{S as U,a as B,b as I,c as Q,d as G}from"./sheet-BgQwtBuK.js";import{u as O}from"./useQuery-48pQeuS3.js";import{A as V}from"./add-payment-dialog-B6ASp9Xp.js";import{A as W,a as X,P as Y}from"./address-list-dialog-b-bI7kd2.js";import{T as Z}from"./triangle-alert-Bmp0Lc24.js";import{P as T}from"./package-BkkIjgzC.js";import{C as c}from"./chevron-right-SEiIbCON.js";import{L as ee}from"./loader-circle-Bz7fq4IJ.js";import{C as q}from"./credit-card-dtIe0EYE.js";import"./index-D0GAShZH.js";import"./index-CxUEmdCc.js";import"./index-CXm_CZR6.js";import"./dialog-D_mWFmtX.js";import"./button-bCrgsaso.js";import"./index-CW2YWU_W.js";import"./circle-check-1L9G8IjR.js";import"./trash-2-DlPQcTq2.js";import"./input-CsVTZWQJ.js";import"./label-CmdcELDJ.js";import"./select-fROaTUpr.js";import"./index-BdQq_4o_.js";import"./index-DwAU5pHh.js";import"./index-AFSU6Owo.js";import"./chevron-down-Bi2HuHPT.js";import"./check-Bj3EYrSG.js";import"./chevron-up-0jCUr4SU.js";import"./city-BO9769IJ.js";import"./map-pin-CsYpw2VJ.js";function Me({open:a,onOpenChange:h}){var k,L,$,M,E;const{user:s,refreshUserData:x}=K(),[R,f]=d.useState(!1),[_,u]=d.useState(!1),[z,g]=d.useState(!1),[F,p]=d.useState(!1),[b,N]=d.useState(!1),o=(s==null?void 0:s.id)||(s==null?void 0:s._id),{data:r,isLoading:v,refetch:w}=O({queryKey:[`/api/users/paymentmethod/default/${o}`],enabled:!!o&&a}),{data:j,isLoading:se,refetch:H}=O({queryKey:[`/api/address/default/address/${o}`],enabled:!!o&&a});d.useEffect(()=>{a&&(x(),w(),H(),N(!1))},[a]);const n=!!(j==null?void 0:j.address)||!!(s!=null&&s.address),A=r!=null&&r.data?r.data:r||null,i=!!A&&!v;d.useEffect(()=>{a&&b&&n&&i&&h(!1)},[n,i,a,h,b]);const S=()=>{n?p(!0):g(!0)},P=()=>{i?u(!0):f(!0)},D=async()=>{await x(),N(!0),g(!1),p(!1)},C=async()=>{await x(),await w(),f(!1),u(!1)},J=t=>{h(t)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{open:a,onOpenChange:J,children:e.jsxs(B,{side:"bottom",className:"h-auto max-h-[80vh] overflow-y-auto left-0 right-0 lg:left-96 lg:right-72","data-testid":"sheet-payment-shipping",children:[e.jsxs(I,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 p-2 rounded-full",children:e.jsx(Z,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),e.jsx(Q,{className:"text-lg",children:"Payment & Shipping Required"})]}),e.jsx(G,{className:"text-base text-muted-foreground",children:"To purchase items in live shows and place bids on auctions, you need to add your payment method and shipping address."})]}),e.jsxs("div",{className:"flex flex-col gap-4 mt-6",children:[n?e.jsx("button",{onClick:S,className:"border rounded-lg p-4 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors text-left w-full","data-testid":"button-address-card",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-2 rounded-md",children:e.jsx(T,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Delivery Method ✓"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((k=s==null?void 0:s.address)==null?void 0:k.addrress1)||((L=s==null?void 0:s.address)==null?void 0:L.address1)||"Address on file",(($=s==null?void 0:s.address)==null?void 0:$.city)&&`, ${s.address.city}`,((M=s==null?void 0:s.address)==null?void 0:M.state)&&`, ${s.address.state}`,((E=s==null?void 0:s.address)==null?void 0:E.zipcode)&&` ${s.address.zipcode}`]})]})]}),e.jsx(c,{className:"h-5 w-5 text-muted-foreground"})]})}):e.jsx("button",{onClick:S,className:"border rounded-lg p-4 bg-muted/30 hover:bg-muted/50 transition-colors text-left","data-testid":"button-add-address",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-md",children:e.jsx(T,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Delivery Method"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your shipping address"})]})]}),e.jsx(c,{className:"h-5 w-5 text-muted-foreground"})]})}),v?e.jsx("div",{className:"border rounded-lg p-4 bg-muted/30",children:e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"bg-muted p-2 rounded-md",children:e.jsx(ee,{className:"h-5 w-5 text-muted-foreground animate-spin"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Payment Method"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading payment information..."})]})]})})}):i?e.jsx("button",{onClick:P,className:"border rounded-lg p-4 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors text-left w-full","data-testid":"button-payment-card",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"bg-green-100 dark:bg-green-900/30 p-2 rounded-md",children:e.jsx(q,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Payment Method ✓"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(()=>{const t=A;if(!t)return"Payment method on file";const y=t.name||t.brand||t.card_type||t.type||"",l=t.last4||t.lastFour||t.last_four||"",m=y?y.charAt(0).toUpperCase()+y.slice(1):"";return m&&l?`${m} ****${l}`:l?`Card ****${l}`:m?`${m} card on file`:"Payment method on file"})()})]})]}),e.jsx(c,{className:"h-5 w-5 text-muted-foreground"})]})}):e.jsx("button",{onClick:P,className:"border rounded-lg p-4 bg-muted/30 hover:bg-muted/50 transition-colors text-left","data-testid":"button-add-payment",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"bg-primary/10 p-2 rounded-md",children:e.jsx(q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Payment Method"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your payment information"})]})]}),e.jsx(c,{className:"h-5 w-5 text-muted-foreground"})]})}),(!n||!i)&&e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-2",children:"Add both delivery and payment methods to bid or buy items"})]})]})}),e.jsx(W,{open:z,onOpenChange:g,onSuccess:D}),e.jsx(X,{open:F,onOpenChange:p,onSuccess:D}),e.jsx(V,{open:R,onOpenChange:f,onSuccess:C}),e.jsx(Y,{open:_,onOpenChange:u,onSuccess:C})]})}export{Me as PaymentShippingSheet,Me as default};
