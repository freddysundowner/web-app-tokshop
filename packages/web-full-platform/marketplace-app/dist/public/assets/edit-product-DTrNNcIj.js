import{f as H,u as Y,a as J,e as O,r as X,j as e,X as W,q as L,p as Z}from"./index-DOZKoalF.js";import{u as ee,F as se,a as n,b as d,e as o,c as l,d as c,f as q,t as te}from"./form-BJNwnS3h.js";import{u as y}from"./useQuery-48pQeuS3.js";import{u as re}from"./useMutation-BBndlB0x.js";import{C as v,a as w,d as N,c as C,b}from"./card-C6zn3jP-.js";import{B as g}from"./button-bCrgsaso.js";import{I as T}from"./input-CsVTZWQJ.js";import{T as ie}from"./textarea-C334aam0.js";import{S as P,a as F,b as S,c as k,d as p}from"./select-fROaTUpr.js";import{R as ae,a as $}from"./radio-group-CSuKdiEr.js";import{I as oe}from"./image-uploader-C--Io-tW.js";import{L as ne}from"./loader-circle-Bz7fq4IJ.js";import{A as de}from"./arrow-left-BP7H-sSw.js";import{S as le}from"./save-BhnFI72X.js";import"./label-CmdcELDJ.js";import"./index-BdQq_4o_.js";import"./index-DwAU5pHh.js";import"./index-CXm_CZR6.js";import"./index-CxUEmdCc.js";import"./index-AFSU6Owo.js";import"./chevron-down-Bi2HuHPT.js";import"./check-Bj3EYrSG.js";import"./chevron-up-0jCUr4SU.js";import"./index-CYumVO2i.js";import"./circle-D2uhURtr.js";import"./badge-DdltLmN9.js";import"./image-CyAY67GT.js";import"./upload-DYhQNpyI.js";function Ae(){const[,I]=H("/inventory/edit/:id"),[,m]=Y(),{user:t}=J(),{toast:_}=O(),h=I==null?void 0:I.id,a=ee({resolver:te(Z),defaultValues:{name:"",description:"",price:void 0,quantity:void 0,category:"",listingType:"buy_now",weight:"",height:"",width:"",length:"",scale:"oz",shippingProfile:"",images:[],colors:[],sizes:[],featured:!1,tokshow:""}}),{data:r,isLoading:U,isError:z}=y({queryKey:["external-product",h],queryFn:async()=>{if(!h)throw new Error("Product ID required");const s=await fetch(`/api/products/${h}?userId=${t==null?void 0:t.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch product: ${s.status}`);return s.json()},enabled:!!h}),{data:x,isLoading:A}=y({queryKey:["external-categories",t==null?void 0:t.id],queryFn:async()=>{const s=await fetch(`/api/categories?userId=${t==null?void 0:t.id}&status=active&page=1&limit=100`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch categories: ${s.status}`);return s.json()},enabled:!!(t!=null&&t.id)}),{data:B,isLoading:G}=y({queryKey:["external-shipping-profiles",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))throw new Error("User ID required");const s=await fetch(`/api/shipping/profiles/${t.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch shipping profiles: ${s.status}`);return s.json()},enabled:!!(t!=null&&t.id)}),{data:E,isLoading:V}=y({queryKey:["external-shows",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))throw new Error("User ID required");const s=await fetch(`/api/rooms?userid=${t.id}&status=true`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch shows: ${s.status}`);return s.json()},enabled:!!(t!=null&&t.id)});X.useEffect(()=>{var s,i,u,j;r&&x&&a.reset({name:r.name||"",description:r.description||"",price:r.price??void 0,quantity:r.quantity??void 0,category:((s=r.category)==null?void 0:s._id)||"",listingType:"buy_now",weight:typeof r.weight=="string"?r.weight:((i=r.weight)==null?void 0:i.toString())||"",height:r.height||"",width:r.width||"",length:r.length||"",scale:r.scale||"oz",shippingProfile:((u=r.shipping_profile)==null?void 0:u._id)||"",images:r.images||[],colors:r.colors||[],sizes:r.sizes||[],featured:r.featured??!1,tokshow:((j=r.tokshow)==null?void 0:j._id)||r.tokshow||"no-show"})},[r,x,a]);const f=re({mutationFn:async s=>{var j;if(!h)throw new Error("Product ID required");const i=t!=null&&t.admin?`/api/admin/products/${h}`:`/api/products/${h}`,u=await fetch(i,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,shippingProfile:(j=s.shippingProfile)!=null&&j.trim()?s.shippingProfile:null,tokshow:s.tokshow&&s.tokshow!=="no-show"?s.tokshow:null,userId:t==null?void 0:t.id})});if(!u.ok){const R=await u.json();throw new Error(R.message||"Failed to update product")}return u.json()},onSuccess:()=>{L.invalidateQueries({queryKey:["external-products"]}),L.invalidateQueries({queryKey:["external-product",h]}),_({title:"Product Updated",description:"Your product has been updated successfully."}),m("/inventory")},onError:s=>{_({title:"Failed to Update Product",description:s.message,variant:"destructive"})}}),K=s=>{f.mutate(s)};if(!h)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Invalid Product ID"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"No product ID provided."}),e.jsx(g,{onClick:()=>m("/inventory"),className:"mt-4",children:"Back to Inventory"})]})});if(U)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ne,{className:"h-8 w-8 animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading product..."})]})})});if(z||!r)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-destructive",children:"Product Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The product you're trying to edit doesn't exist."}),e.jsx(g,{onClick:()=>m("/inventory"),className:"mt-4",children:"Back to Inventory"})]})});const D=(x==null?void 0:x.categories)||[],M=B||[],Q=(E==null?void 0:E.rooms)||[];return e.jsxs("div",{className:"p-3 sm:p-6 space-y-6","data-testid":"page-edit-product",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(g,{variant:"outline",onClick:()=>m("/inventory"),"data-testid":"button-back-to-inventory",className:"w-full sm:w-auto",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"sm:inline",children:"Back to Inventory"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-foreground","data-testid":"text-page-title",children:"Edit Product"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground","data-testid":"text-page-description",children:["Update product information: ",r.name]})]})]}),e.jsx(se,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(K),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Basic Information"}),e.jsx(C,{children:"Essential product details and description"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(n,{control:a.control,name:"name",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Product Name *"}),e.jsx(l,{children:e.jsx(T,{placeholder:"Enter product name",...s,"data-testid":"input-product-name"})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"description",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Description"}),e.jsx(l,{children:e.jsx(ie,{placeholder:"Enter product description",...s,rows:4,"data-testid":"textarea-product-description"})}),e.jsx(c,{})]})})]})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Pricing & Inventory"}),e.jsx(C,{children:"Set your product price and stock levels"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:a.control,name:"price",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Price ($) *"}),e.jsx(l,{children:e.jsx(T,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...s,onChange:i=>s.onChange(i.target.value),"data-testid":"input-product-price"})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"quantity",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Quantity *"}),e.jsx(l,{children:e.jsx(T,{type:"number",min:"0",placeholder:"0",...s,onChange:i=>s.onChange(i.target.value),"data-testid":"input-product-quantity"})}),e.jsx(c,{})]})})]})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Product Images"}),e.jsx(C,{children:"Upload images of your product (up to 5 images)"})]}),e.jsx(b,{children:e.jsx(n,{control:a.control,name:"images",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:e.jsx(oe,{value:s.value||[],onChange:s.onChange,maxFiles:5,maxFileSize:5*1024*1024,disabled:f.isPending,allowFileStorage:!1})}),e.jsx(c,{})]})})})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-6 lg:sticky lg:top-6 self-start",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(N,{children:"Category & Listing"}),e.jsx(C,{children:"Categorize your product and set listing type"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(n,{control:a.control,name:"category",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Category"}),e.jsxs(P,{onValueChange:s.onChange,value:s.value,disabled:A,"data-testid":"select-product-category",children:[e.jsx(l,{children:e.jsx(F,{children:e.jsx(S,{placeholder:"Select category"})})}),e.jsxs(k,{children:[e.jsx(p,{value:"skip",children:"No Category"}),D.map(i=>e.jsx(p,{value:i._id,children:i.name},i._id))]})]}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"shippingProfile",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Shipping Profile"}),e.jsxs(P,{onValueChange:s.onChange,value:s.value||"",disabled:G,"data-testid":"select-shipping-profile",children:[e.jsx(l,{children:e.jsx(F,{children:e.jsx(S,{placeholder:"Select shipping profile"})})}),e.jsxs(k,{children:[e.jsx(p,{value:"skip",children:"No Shipping Profile"}),M.map(i=>e.jsx(p,{value:i._id,children:i.name},i._id))]})]}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"tokshow",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Assign to Show"}),e.jsxs(P,{onValueChange:s.onChange,value:s.value||"no-show",disabled:V,"data-testid":"select-show",children:[e.jsx(l,{children:e.jsx(F,{children:e.jsx(S,{placeholder:"Select show"})})}),e.jsxs(k,{children:[e.jsx(p,{value:"no-show",children:"No Show"}),Q.map(i=>e.jsx(p,{value:i._id,children:i.title},i._id))]})]}),e.jsx(q,{children:'Assign this product to a live show or select "No Show" to remove it from any show'}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"listingType",render:({field:s})=>e.jsxs(d,{children:[e.jsx(o,{children:"Listing Type *"}),e.jsxs(P,{onValueChange:s.onChange,value:s.value,"data-testid":"select-listing-type",children:[e.jsx(l,{children:e.jsx(F,{children:e.jsx(S,{placeholder:"Select listing type"})})}),e.jsxs(k,{children:[e.jsx(p,{value:"buy_now",children:"Buy Now"}),e.jsx(p,{value:"auction",children:"Auction"}),e.jsx(p,{value:"giveaway",children:"Giveaway"})]})]}),e.jsx(q,{children:"Choose how customers can purchase this product"}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"featured",render:({field:s})=>e.jsxs(d,{className:"space-y-3",children:[e.jsx(o,{children:"Featured Product"}),e.jsx(l,{children:e.jsxs(ae,{onValueChange:i=>s.onChange(i==="true"),value:s.value?"true":"false",className:"flex flex-col space-y-1","data-testid":"radio-group-featured",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"false",id:"featured-false","data-testid":"radio-featured-false"}),e.jsx(o,{htmlFor:"featured-false",className:"text-sm font-normal",children:"No"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"true",id:"featured-true","data-testid":"radio-featured-true"}),e.jsx(o,{htmlFor:"featured-true",className:"text-sm font-normal",children:"Yes"})]})]})}),e.jsx(q,{children:"Mark this product as featured to highlight it"}),e.jsx(c,{})]})})]})]})})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-end gap-3 sm:gap-4 pt-6 border-t",children:[e.jsxs(g,{type:"button",variant:"outline",onClick:()=>m("/inventory"),"data-testid":"button-cancel",className:"w-full sm:w-auto",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(g,{type:"submit",disabled:f.isPending,"data-testid":"button-save-product",className:"w-full sm:w-auto",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),f.isPending?"Updating...":"Update Product"]})]})]})})]})}export{Ae as default};
